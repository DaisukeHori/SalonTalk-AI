# å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è²«æ€§èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

èª¿æŸ»æ—¥: 2025-12-05
èª¿æŸ»å¯¾è±¡: ä¼ç”»æ›¸ãƒ»è¨­è¨ˆæ›¸ãƒ»DBãƒ»UIãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼ˆEdge Functionsï¼‰

## èª¿æŸ»ç›®çš„
å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§ç”¨èªãƒ»ã‚«ãƒ©ãƒ åãƒ»ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸€è²«æ€§ã‚’ç¢ºä¿ã™ã‚‹

---

## èª¿æŸ»ãƒ©ã‚¦ãƒ³ãƒ‰è¨˜éŒ²

### ãƒ©ã‚¦ãƒ³ãƒ‰1-10: DBã‚¹ã‚­ãƒ¼ãƒã¨å‹å®šç¾©ã®æ¯”è¼ƒ

#### ãƒ©ã‚¦ãƒ³ãƒ‰1: salonsãƒ†ãƒ¼ãƒ–ãƒ«
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **sharedå‹**: `packages/shared/src/infrastructure/supabase/types.ts`
- **UIå‹**: `apps/web/src/types/database.ts`
- **çµæœ**: âœ… ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰2: staffsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ ä¸ä¸€è‡´ç™ºè¦‹
- **å•é¡Œ**: UIå‹ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ©ãƒ ã‚ã‚Š
  - `position` - DBã«å­˜åœ¨ã—ãªã„
  - `join_date` - DBã«å­˜åœ¨ã—ãªã„
  - `profile_image_url` - DBã«å­˜åœ¨ã—ãªã„ï¼ˆ`avatar_url`ãŒæ­£è§£ï¼‰
  - `settings` - DBã«å­˜åœ¨ã—ãªã„

#### ãƒ©ã‚¦ãƒ³ãƒ‰3: sessionsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ ä¸ä¸€è‡´ç™ºè¦‹
- **å•é¡Œ**:
  - UIå‹ã«`diarization_status`ãŒã‚ã‚‹ãŒã€DBã‚¹ã‚­ãƒ¼ãƒï¼ˆmigrationï¼‰ã«ã¯å­˜åœ¨ã—ãªã„
  - è¨­è¨ˆæ›¸ãƒ»ä¼ç”»æ›¸ã«ã¯`diarization_status`ã®è¨˜è¼‰ã‚ã‚Š

#### ãƒ©ã‚¦ãƒ³ãƒ‰4: transcriptsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ ä¸ä¸€è‡´ç™ºè¦‹
- **å•é¡Œ**: UIå‹ã«`confidence`ã‚«ãƒ©ãƒ ãŒæ¬ ã‘ã¦ã„ã‚‹

#### ãƒ©ã‚¦ãƒ³ãƒ‰5: speaker_segmentsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰6: session_analysesãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆæ­£è¦åŒ–æ§‹é€ ã§çµ±ä¸€æ¸ˆã¿ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰7: session_reportsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ è¨­è¨ˆæ›¸ã¨å®Ÿè£…ã§å·®ç•°
- **è¨­è¨ˆæ›¸**: `good_points`, `improvement_points`, `action_items`, `transcript_summary`, `ai_feedback`
- **DBå®Ÿè£…**: `summary`, `improvements`, `strengths`, `metrics`, `concern_keywords`

#### ãƒ©ã‚¦ãƒ³ãƒ‰8: success_casesãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ è¨­è¨ˆæ›¸ã«ä¸€éƒ¨ã‚«ãƒ©ãƒ æ¬ ã‘
- **è¨­è¨ˆæ›¸ã«æ¬ ã‘**: `approach_text`, `result`, `is_active`

#### ãƒ©ã‚¦ãƒ³ãƒ‰9: training_scenariosãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆtitle/difficultyã§çµ±ä¸€æ¸ˆã¿ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰10: roleplay_sessionsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆmessages/ended_atã§çµ±ä¸€æ¸ˆã¿ï¼‰

---

### ãƒ©ã‚¦ãƒ³ãƒ‰11-15: Edge Functionsç¢ºèª

#### ãƒ©ã‚¦ãƒ³ãƒ‰11: process-audio
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/process-audio/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`start_time_ms`/`end_time_ms`ã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰12: diarization-callback
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/diarization-callback/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`start_time_ms`/`end_time_ms`ã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰13: analyze-segment
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/analyze-segment/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`start_time_ms`/`end_time_ms`ã¨æ­£è¦åŒ–ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰14: generate-report
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/generate-report/index.ts`
- **çµæœ**: âœ… æ­£ã—ãæ­£è¦åŒ–session_analysesã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰15: roleplay-chat
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/roleplay-chat/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`messages`/`ended_at`ã‚’ä½¿ç”¨

---

### ãƒ©ã‚¦ãƒ³ãƒ‰16-20: è¨­è¨ˆæ›¸ã¨ã®æ•´åˆæ€§

#### ãƒ©ã‚¦ãƒ³ãƒ‰16: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**: session_reportsã®ã‚«ãƒ©ãƒ åãŒDBå®Ÿè£…ã¨ä¸ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰17: APIè¨­è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- **çµæœ**: âš ï¸ é‡å¤§ãªå•é¡Œç™ºè¦‹
- **å•é¡Œ**:
  - process-audioå®Ÿè£…ä¾‹ã§`start_time`/`end_time`ã‚’ä½¿ç”¨ï¼ˆæ­£ã—ãã¯`start_time_ms`/`end_time_ms`ï¼‰
  - diarization-callbackå®Ÿè£…ä¾‹ã§åŒæ§˜ã®å•é¡Œ
  - analyze-segmentå®Ÿè£…ä¾‹ã§`.order('start_time')`ã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰18: RLSè¨­è¨ˆ
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆid = auth.uid()ãƒ‘ã‚¿ãƒ¼ãƒ³ã§çµ±ä¸€æ¸ˆã¿ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰19: çµ±è¨ˆé–¢æ•°è¨­è¨ˆ
- **çµæœ**: âœ… ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰20: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ
- **çµæœ**: âœ… ä¸€è‡´

---

### ãƒ©ã‚¦ãƒ³ãƒ‰21-25: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª

#### ãƒ©ã‚¦ãƒ³ãƒ‰21: StaffTable.tsx
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffTable.tsx`
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**:
  - `role: 'stylist' | 'manager' | 'receptionist'`
  - DBã§ã¯ `'stylist' | 'manager' | 'owner' | 'admin'`
  - `receptionist`ã¯å­˜åœ¨ã—ãªã„ã€`owner`/`admin`ãŒæ¬ ã‘

#### ãƒ©ã‚¦ãƒ³ãƒ‰22: ReportViewer.tsx
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/report/ReportViewer.tsx`
- **çµæœ**: âœ… UIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿ï¼ˆDBç›´æ¥å‚ç…§ãªã—ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰23: RecentSessions.tsx
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/dashboard/RecentSessions.tsx`
- **çµæœ**: âœ… UIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿

#### ãƒ©ã‚¦ãƒ³ãƒ‰24: database.tså‹å®šç¾©
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`
- **çµæœ**: âš ï¸ è¤‡æ•°å•é¡Œç™ºè¦‹ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰2-4å‚ç…§ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰25: ä¸è¶³ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**: `staff_training_stats`ãƒ†ãƒ¼ãƒ–ãƒ«ãŒUIå‹å®šç¾©ã«æ¬ ã‘ã¦ã„ã‚‹

---

### ãƒ©ã‚¦ãƒ³ãƒ‰26-30: ä¼ç”»æ›¸ã¨ã®æ•´åˆæ€§

#### ãƒ©ã‚¦ãƒ³ãƒ‰26: æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**:
  - ã‚³ãƒ¼ãƒ‰ä¾‹ã§`start_time`/`end_time`ã‚’ä½¿ç”¨ï¼ˆline 168-175ï¼‰
  - `role`ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨ï¼ˆæ­£ã—ãã¯`speaker`ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰27: æ©Ÿèƒ½è©³ç´°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md`
- **çµæœ**: âœ… ç”¨èªã¯æ•´åˆï¼ˆãƒˆãƒ¼ã‚¯æ¯”ç‡ç­‰ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰28: diarization_statusã®æ‰±ã„
- **çµæœ**: âš ï¸ ä¸æ•´åˆ
- **è¨­è¨ˆæ›¸/ä¼ç”»æ›¸**: `diarization_status`ã‚ã‚Š
- **DBã‚¹ã‚­ãƒ¼ãƒ**: `diarization_status`ãªã—
- **UIå‹**: `diarization_status`ã‚ã‚Š
- **æ±ºå®šãŒå¿…è¦**: è¿½åŠ ã™ã‚‹ã‹å‰Šé™¤ã™ã‚‹ã‹

#### ãƒ©ã‚¦ãƒ³ãƒ‰29: ç”¨èªçµ±ä¸€ç¢ºèª
- **çµæœ**: âœ… ä¸»è¦ç”¨èªã¯çµ±ä¸€æ¸ˆã¿
  - ãƒˆãƒ¼ã‚¯æ¯”ç‡ï¼ˆå‚¾è´ã‚¹ã‚³ã‚¢ã§ã¯ãªã„ï¼‰
  - title/difficulty
  - messages/ended_at

#### ãƒ©ã‚¦ãƒ³ãƒ‰30: speaker_segments.speakerå€¤
- **çµæœ**: âœ… çµ±ä¸€æ¸ˆã¿
- `'stylist' | 'customer' | 'unknown'`ã§ä¸€è‡´

---

## ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œä¸€è¦§

| # | å•é¡Œ | å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|------|-------------|--------|-----------|
| 1 | UIå‹(database.ts)ã«staffsã®ä¸è¦ã‚«ãƒ©ãƒ  | UI | é«˜ | âœ… ä¿®æ­£æ¸ˆ |
| 2 | UIå‹ã«diarization_statusãŒã‚ã‚‹ãŒDBã«ãªã„ | DBãƒ»UIãƒ»è¨­è¨ˆ | é«˜ | âœ… ä¿®æ­£æ¸ˆ (DBã«è¿½åŠ ) |
| 3 | UIå‹ã«transcripts.confidenceãŒæ¬ ã‘ | UI | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 4 | UIå‹ã«staff_training_statsãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ¬ ã‘ | UI | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 5 | StaffTableã®roleå‹ãŒä¸æ­£ | UI | é«˜ | âœ… ä¿®æ­£æ¸ˆ |
| 6 | APIè¨­è¨ˆæ›¸ã§start_timeä½¿ç”¨ | è¨­è¨ˆ | é«˜ | âœ… ä¿®æ­£æ¸ˆ |
| 7 | ä¼ç”»æ›¸ã§start_time/roleä½¿ç”¨ | ä¼ç”» | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 8 | session_reportsã®ã‚«ãƒ©ãƒ åä¸ä¸€è‡´ | è¨­è¨ˆ | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 9 | success_casesã®ã‚«ãƒ©ãƒ æ¬ ã‘ | è¨­è¨ˆ | ä½ | âœ… ä¿®æ­£æ¸ˆ |
| 10 | notification_logs.read_atãŒUIå‹ã«æ¬ ã‘ | UI | ä½ | âœ… ä¿®æ­£æ¸ˆ |

---

## å•é¡Œè©³ç´°ã¨æ¨å¥¨å¯¾å¿œ

### å•é¡Œ1: UIå‹ã«staffsã®ä¸è¦ã‚«ãƒ©ãƒ 

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`

**ç¾çŠ¶**:
```typescript
staffs: {
  Row: {
    position: string | null;      // DBã«å­˜åœ¨ã—ãªã„
    join_date: string | null;     // DBã«å­˜åœ¨ã—ãªã„
    profile_image_url: string | null;  // avatar_urlãŒæ­£è§£
    settings: Json | null;        // DBã«å­˜åœ¨ã—ãªã„
  }
}
```

**æ¨å¥¨å¯¾å¿œ**:
- `position`, `join_date`, `settings`ã‚’å‰Šé™¤
- `profile_image_url`ã‚’å‰Šé™¤ï¼ˆ`avatar_url`ã®ã¿ä½¿ç”¨ï¼‰

**ç†ç”±**:
- **è¨­è¨ˆ**: DBã‚¹ã‚­ãƒ¼ãƒã«ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **UI**: å­˜åœ¨ã—ãªã„ã‚«ãƒ©ãƒ ã‚’å‚ç…§ã™ã‚‹ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã®åŸå› ã«ãªã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£**: ä¸€è²«æ€§ãŒãªã„ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå›°é›£ã«ãªã‚‹

---

### å•é¡Œ2: diarization_statusã®ä¸æ•´åˆ

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: DBãƒ»UIãƒ»è¨­è¨ˆãƒ»ä¼ç”»
**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**:
- `supabase/migrations/00000000000000_initial_schema.sql`
- `apps/web/src/types/database.ts`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`
- `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`

**ç¾çŠ¶**:
- è¨­è¨ˆæ›¸ãƒ»ä¼ç”»æ›¸: `diarization_status`ã‚ã‚Š
- DBã‚¹ã‚­ãƒ¼ãƒ: ãªã—
- UIå‹: ã‚ã‚Š

**æ¨å¥¨å¯¾å¿œï¼ˆ2ã¤ã®é¸æŠè‚¢ï¼‰**:

**é¸æŠè‚¢Aï¼ˆæ¨å¥¨ï¼‰**: DBã«è¿½åŠ 
```sql
ALTER TABLE sessions ADD COLUMN diarization_status TEXT
  DEFAULT 'pending'
  CHECK (diarization_status IN ('pending', 'processing', 'completed', 'failed'));
```

**é¸æŠè‚¢B**: è¨­è¨ˆæ›¸ãƒ»UIå‹ã‹ã‚‰å‰Šé™¤

**ç†ç”±**:
- **è¨­è¨ˆ**: è©±è€…åˆ†é›¢ã®çŠ¶æ…‹ç®¡ç†ã¯ä¼ç”»æ›¸ã§æ˜ç¤ºã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½è¦ä»¶
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: diarization-callbackãŒçŠ¶æ…‹æ›´æ–°ã‚’è©¦ã¿ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£**: è©±è€…åˆ†é›¢ã®é€²æ—è¡¨ç¤ºã«å¿…è¦

---

### å•é¡Œ3: UIå‹ã«transcripts.confidenceãŒæ¬ ã‘

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`

**æ¨å¥¨å¯¾å¿œ**: `confidence`ã‚’è¿½åŠ 
```typescript
transcripts: {
  Row: {
    confidence: number | null;  // è¿½åŠ 
  }
}
```

**ç†ç”±**:
- **DB**: transcriptsãƒ†ãƒ¼ãƒ–ãƒ«ã«confidenceã‚«ãƒ©ãƒ ãŒå­˜åœ¨
- **UI**: ä¿¡é ¼åº¦ã«åŸºã¥ãè¡¨ç¤ºãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ä½¿ç”¨å¯èƒ½

---

### å•é¡Œ4: staff_training_statsãƒ†ãƒ¼ãƒ–ãƒ«æ¬ ã‘

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`

**æ¨å¥¨å¯¾å¿œ**: ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã‚’è¿½åŠ 
```typescript
staff_training_stats: {
  Row: {
    id: string;
    staff_id: string;
    total_training_count: number;
    total_score_sum: number;
    average_score: number;
    highest_score: number;
    last_training_at: string | null;
    updated_at: string;
  };
  // Insert/Update ã‚‚è¿½åŠ 
}
```

**ç†ç”±**:
- **DB**: ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹
- **UI**: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµ±è¨ˆè¡¨ç¤ºã«å¿…è¦

---

### å•é¡Œ5: StaffTableã®roleå‹ãŒä¸æ­£

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffTable.tsx`

**ç¾çŠ¶**:
```typescript
role: 'stylist' | 'manager' | 'receptionist';  // ä¸æ­£
```

**æ¨å¥¨å¯¾å¿œ**:
```typescript
role: 'stylist' | 'manager' | 'owner' | 'admin';  // æ­£ã—ã„å€¤
```

**ç†ç”±**:
- **DB**: roleã¯`'stylist' | 'manager' | 'owner' | 'admin'`
- **è¨­è¨ˆ**: `receptionist`ã¯å­˜åœ¨ã—ãªã„
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£**: ç®¡ç†è€…ï¼ˆowner/adminï¼‰è¡¨ç¤ºãŒã§ããªã„

---

### å•é¡Œ6-7: è¨­è¨ˆæ›¸ãƒ»ä¼ç”»æ›¸ã§start_timeä½¿ç”¨

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: è¨­è¨ˆãƒ»ä¼ç”»
**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`

**æ¨å¥¨å¯¾å¿œ**:
- `start_time` â†’ `start_time_ms`
- `end_time` â†’ `end_time_ms`
- `role` â†’ `speaker`ï¼ˆspeaker_segmentsã®å ´åˆï¼‰

**ç†ç”±**:
- **DB**: ãƒŸãƒªç§’å˜ä½ã§çµ±ä¸€æ¸ˆã¿
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: å®Ÿè£…ã¯æ­£ã—ã`start_time_ms`ã‚’ä½¿ç”¨
- **è¨­è¨ˆ**: è¨­è¨ˆæ›¸ã¨å®Ÿè£…ã®ä¹–é›¢ã¯æ··ä¹±ã‚’æ‹›ã

---

### å•é¡Œ8: session_reportsã®ã‚«ãƒ©ãƒ åä¸ä¸€è‡´

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: è¨­è¨ˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`

**è¨­è¨ˆæ›¸**:
- `good_points`, `improvement_points`, `action_items`
- `transcript_summary`, `ai_feedback`, `indicator_scores`

**DBå®Ÿè£…**:
- `summary`, `improvements`, `strengths`
- `metrics`, `concern_keywords`, `proposal_timing_ms`

**æ¨å¥¨å¯¾å¿œ**: è¨­è¨ˆæ›¸ã‚’DBå®Ÿè£…ã«åˆã‚ã›ã¦æ›´æ–°

**ç†ç”±**:
- **DB**: å®Ÿè£…ãŒæ—¢ã«å­˜åœ¨
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: generate-reportãŒå®Ÿè£…æ¸ˆã¿ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨

---

## èª¿æŸ»å®Œäº†å¾Œã®æ¨å¥¨äº‹é …

### å„ªå…ˆåº¦: é«˜
1. **UIå‹å®šç¾©ã®ä¿®æ­£** (å•é¡Œ1, 3, 4, 10)
   - staffsã‹ã‚‰ä¸è¦ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤
   - transcripts.confidenceã‚’è¿½åŠ 
   - staff_training_statsã‚’è¿½åŠ 
   - notification_logs.read_atã‚’è¿½åŠ 

2. **StaffTableã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿®æ­£** (å•é¡Œ5)
   - roleå‹ã‚’æ­£ã—ã„å€¤ã«ä¿®æ­£

3. **diarization_statusã®æ±ºå®š** (å•é¡Œ2)
   - DBã«è¿½åŠ ã™ã‚‹ã‹ã€è¨­è¨ˆã‹ã‚‰å‰Šé™¤ã™ã‚‹ã‹æ±ºå®š

### å„ªå…ˆåº¦: ä¸­
4. **è¨­è¨ˆæ›¸ã®æ›´æ–°** (å•é¡Œ6, 8)
   - APIè¨­è¨ˆæ›¸ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’`start_time_ms`/`end_time_ms`ã«ä¿®æ­£
   - session_reportsã®ã‚«ãƒ©ãƒ åã‚’å®Ÿè£…ã«åˆã‚ã›ã¦ä¿®æ­£

5. **ä¼ç”»æ›¸ã®æ›´æ–°** (å•é¡Œ7)
   - ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å®Ÿè£…ã«åˆã‚ã›ã¦ä¿®æ­£

### å„ªå…ˆåº¦: ä½
6. **è¨­è¨ˆæ›¸ã®è£œå®Œ** (å•é¡Œ9)
   - success_casesã«æ¬ ã‘ã¦ã„ã‚‹ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 

---

## çµè«–

30ãƒ©ã‚¦ãƒ³ãƒ‰ã®èª¿æŸ»ã®çµæœã€**10ä»¶ã®ä¸æ•´åˆ**ã‚’ç™ºè¦‹ã—ã€**å…¨ã¦ä¿®æ­£å®Œäº†**ã—ã¾ã—ãŸã€‚

ä¿®æ­£å‰:
- **Edge Functionsï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰**: âœ… æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- **DBã‚¹ã‚­ãƒ¼ãƒ**: âš ï¸ diarization_statusãŒæ¬ ã‘ã¦ã„ãŸ
- **sharedå‹å®šç¾©**: âœ… æ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- **UIå‹å®šç¾©**: âš ï¸ è¤‡æ•°ã®ä¸æ•´åˆã‚ã‚Š
- **è¨­è¨ˆæ›¸**: âš ï¸ ä¸€éƒ¨ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå¤ã„
- **ä¼ç”»æ›¸**: âš ï¸ ä¸€éƒ¨ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå¤ã„

ä¿®æ­£å¾Œï¼ˆ2025-12-05ï¼‰:
- **Edge Functionsï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰**: âœ… æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- **DBã‚¹ã‚­ãƒ¼ãƒ**: âœ… diarization_statusã‚’è¿½åŠ 
- **sharedå‹å®šç¾©**: âœ… diarization_statusã‚’è¿½åŠ 
- **UIå‹å®šç¾©**: âœ… å…¨ã¦ä¿®æ­£å®Œäº†
- **è¨­è¨ˆæ›¸**: âœ… å…¨ã¦ä¿®æ­£å®Œäº†
- **ä¼ç”»æ›¸**: âœ… å…¨ã¦ä¿®æ­£å®Œäº†

**å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆä¼ç”»ãƒ»è¨­è¨ˆãƒ»DBãƒ»UIãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰ã®ä¸€è²«æ€§ãŒç¢ºä¿ã•ã‚Œã¾ã—ãŸã€‚**

---

## 50ãƒ©ã‚¦ãƒ³ãƒ‰èª¿æŸ»ï¼ˆè©³ç´°è¨­è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ï¼‰

èª¿æŸ»æ—¥: 2025-12-05ï¼ˆç¶™ç¶šï¼‰
èª¿æŸ»æ–¹æ³•: å„è©³ç´°è¨­è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆä¼ç”»ãƒ»è¨­è¨ˆãƒ»DBãƒ»UIãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰

---

### ãƒ©ã‚¦ãƒ³ãƒ‰1: ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **ä¼ç”»**: `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/01-ã¯ã˜ã‚ã«.md`, `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **UI**: `apps/web/src/types/database.ts`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/process-audio/index.ts`, `supabase/functions/analyze-conversation/index.ts`

#### ç¢ºèªçµæœ

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è©³ç´° |
|---------|-----------|------|
| ä¼ç”» | âœ… | æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã¯æ­£ç¢º |
| è¨­è¨ˆ | âš ï¸ | ã‚¯ãƒ©ã‚¹è¨­è¨ˆã«DBä¸æ•´åˆã‚ã‚Šï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |
| DB | âœ… | ã‚¹ã‚­ãƒ¼ãƒã¯ä¸€è²«æ€§ã‚ã‚Š |
| UI | âœ… | å‹å®šç¾©ã¯DBã¨ä¸€è‡´ |
| ãƒ¯ãƒ¼ã‚«ãƒ¼ | âœ… | millisecondså˜ä½ã§æ­£ã—ãå®Ÿè£… |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-1: Staff Entityã«ä¸è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 270-277)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  export interface Staff {
    readonly position: string | null;         // DBã«å­˜åœ¨ã—ãªã„
    readonly joinDate: Date | null;           // DBã«å­˜åœ¨ã—ãªã„
    readonly profileImageUrl: string | null;  // avatar_urlãŒæ­£è§£
    readonly settings: StaffSettings;         // DBã«å­˜åœ¨ã—ãªã„
  }
  ```
- **DBå®Ÿè£…**: ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-2: Transcript EntityãŒç§’å˜ä½
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 544-546)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  readonly startTime: number;  // ç§’
  readonly endTime: number;    // ç§’
  ```
- **DBå®Ÿè£…**: `start_time_ms INTEGER` (ãƒŸãƒªç§’)
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-3: SpeakerSegment EntityãŒç§’å˜ä½
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 620-622)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  readonly startTime: number;  // ç§’
  readonly endTime: number;    // ç§’
  ```
- **DBå®Ÿè£…**: `start_time_ms INTEGER` (ãƒŸãƒªç§’)
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰1-2: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **ä¼ç”»**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md`
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **UI**: `apps/web/src/types/database.ts`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/create-session/index.ts`, `supabase/functions/end-session/index.ts`

#### ç¢ºèªçµæœ

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | ä¼ç”» | è¨­è¨ˆ | DB | UI | ãƒ¯ãƒ¼ã‚«ãƒ¼ |
|-------------|------|------|-----|-----|---------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ | âš ï¸ | âœ… | âœ… | âœ… | âœ… |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† | âœ… | âœ… | âœ… | âœ… | âœ… |
| ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ | âœ… | âœ… | âœ… | âœ… | âœ… |
| èªè¨¼ | - | âš ï¸ | âœ… | âœ… | âœ… |
| ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° | âœ… | âœ… | âœ… | âœ… | âœ… |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-4: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã§auth_user_idã‚’ä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md` (line 368-369)
- **è¨­è¨ˆæ›¸**:
  ```sql
  SELECT * FROM staffs WHERE auth_user_id = ?
  ```
- **DBå®Ÿè£…**: `staffs.id = auth.uid()`ï¼ˆidè‡ªä½“ãŒauth.users(id)ã¸ã®å‚ç…§ï¼‰
- **é‡è¦åº¦**: ä½ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ã€å®Ÿè£…ã¯æ­£ã—ã„ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-5: ä¼ç”»æ›¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°è¡¨ãŒ4æŒ‡æ¨™ã®ã¿
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md` (line 21-26)
- **ä¼ç”»æ›¸**: 4æŒ‡æ¨™ï¼ˆãƒˆãƒ¼ã‚¯æ¯”ç‡ã€è³ªå•ã‚¹ã‚³ã‚¢ã€æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã€ææ¡ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰
- **å®Ÿè£…**: 7æŒ‡æ¨™ï¼ˆ+ æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ææ¡ˆå“è³ªã€æˆç´„åˆ¤å®šï¼‰
- **é‡è¦åº¦**: ä½ï¼ˆæœ¬æ–‡ã§7æŒ‡æ¨™ã¯è¨€åŠã•ã‚Œã¦ã„ã‚‹ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®

### ãƒ©ã‚¦ãƒ³ãƒ‰1-3: ç”»é¢è¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **UI**: `apps/web/src/components/staff/StaffForm.tsx`, `apps/web/src/components/staff/StaffTable.tsx`

#### ç¢ºèªçµæœ

| ç”»é¢ | è¨­è¨ˆ | DB | UI | å‚™è€ƒ |
|------|------|-----|-----|------|
| ãƒ­ã‚°ã‚¤ãƒ³ | âœ… | âœ… | - | - |
| ãƒ›ãƒ¼ãƒ  | âœ… | âœ… | âœ… | - |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ | âœ… | âœ… | - | iPadå°‚ç”¨ |
| ãƒ¬ãƒãƒ¼ãƒˆè©³ç´° | âœ… | âœ… | âœ… | - |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | âœ… | âœ… | âœ… | - |
| ã‚¹ã‚¿ãƒƒãƒ•ãƒ•ã‚©ãƒ¼ãƒ  | âš ï¸ | âœ… | âš ï¸ | è¤‡æ•°å•é¡Œ |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-6: StaffFormã®roleå‹ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffForm.tsx` (line 14, 26-30)
- **UIå®Ÿè£…**:
  ```typescript
  role: 'stylist' | 'manager' | 'receptionist';
  const roleOptions = [
    { value: 'stylist', label: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ' },
    { value: 'manager', label: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' },
    { value: 'receptionist', label: 'ãƒ¬ã‚»ãƒ—ã‚·ãƒ§ãƒ³' },
  ];
  ```
- **DB**: `'stylist' | 'manager' | 'owner' | 'admin'`
- **é‡è¦åº¦**: é«˜ï¼ˆDBã«ä¿å­˜ä¸å¯èƒ½ãªå€¤ã‚’å«ã‚€ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-7: StaffFormã«phoneãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹ãŒDBã«ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffForm.tsx` (line 47, 135-155)
- **UIå®Ÿè£…**: `phone` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚ã‚Š
- **DB**: staffsãƒ†ãƒ¼ãƒ–ãƒ«ã« `phone` ã‚«ãƒ©ãƒ ãªã—
- **é‡è¦åº¦**: é«˜ï¼ˆä¿å­˜æ™‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-8: è¨­è¨ˆæ›¸ã®CreateStaffSchemaã§assistantä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md` (line 290)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  role: z.enum(['owner', 'manager', 'stylist', 'assistant'], {...})
  ```
- **DB**: `'owner' | 'manager' | 'stylist' | 'admin'`ï¼ˆ`admin`ãŒæ­£è§£ï¼‰
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-9: è¨­è¨ˆæ›¸ã®CreateStaffSchemaã«position/joinDateãŒã‚ã‚‹ãŒDBã«ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md` (line 293-294)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  position: z.string().max(50, 'å½¹è·ã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),
  joinDate: z.string().date('æœ‰åŠ¹ãªæ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),
  ```
- **DB**: staffsãƒ†ãƒ¼ãƒ–ãƒ«ã«ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ãªã—
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰1-4: APIè©³ç´°ä»•æ§˜ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/*/index.ts`

#### ç¢ºèªçµæœ

| API | è¨­è¨ˆ | DB | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|-----|------|-----|---------|------|
| create-session | âœ… | âœ… | âœ… | - |
| process-audio | âœ… | âœ… | âœ… | - |
| diarization-callback | âœ… | âœ… | âœ… | - |
| analyze-segment | âš ï¸ | âœ… | âœ… | è¨­è¨ˆæ›¸ã‚³ãƒ¼ãƒ‰ã«ãƒã‚° |
| search-cases | âœ… | âœ… | âœ… | - |
| generate-report | âš ï¸ | âœ… | âœ… | è¨­è¨ˆæ›¸ãŒå¤ã„ã‚«ãƒ©ãƒ å |
| roleplay-chat | âš ï¸ | âœ… | âœ… | è¨­è¨ˆæ›¸ãŒå¤ã„ã‚«ãƒ©ãƒ å |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-10: analyze-segmentè¨­è¨ˆã§start_timeä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (line 870-871)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  const duration = segment.end_time - segment.start_time;
  ```
- **DB**: `end_time_ms INTEGER`, `start_time_ms INTEGER`
- **é‡è¦åº¦**: ä¸­ï¼ˆè¨­è¨ˆæ›¸ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ã¿ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-11: generate-reportã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¤ã„ã‚«ãƒ©ãƒ å
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (line 1319-1418)
- **è¨­è¨ˆæ›¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ»INSERT**:
  ```typescript
  goodPoints, improvementPoints, actionItems,
  transcriptSummary, aiFeedback, indicator_scores
  ```
- **DBå®Ÿè£…**:
  ```
  summary, improvements, strengths, metrics,
  concern_keywords, proposal_timing_ms, etc.
  ```
- **é‡è¦åº¦**: é«˜ï¼ˆè¨­è¨ˆæ›¸ã¨å®Ÿè£…ãŒä¹–é›¢ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-12: roleplay-chatã§conversationHistoryä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (line 1559-1560)
- **è¨­è¨ˆæ›¸**: `conversationHistory`
- **DB**: `roleplay_sessions.messages`
- **é‡è¦åº¦**: ä½ï¼ˆAPIå†…éƒ¨è¡¨ç¾ã¨DBè¡¨ç¾ã®é•ã„ã¯è¨±å®¹ç¯„å›²ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®

### ãƒ©ã‚¦ãƒ³ãƒ‰1-5: éŸ³å£°å‡¦ç†ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (process-audio, diarization-callback)
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/process-audio/index.ts`, `supabase/functions/diarization-callback/index.ts`

#### ç¢ºèªçµæœ

| é …ç›® | è¨­è¨ˆ | DB | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|------|------|-----|---------|------|
| æ™‚é–“å˜ä½ | âœ… | âœ… (ms) | âœ… | ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒç§’â†’mså¤‰æ› |
| è©±è€…è­˜åˆ¥ | âœ… | âœ… | âœ… | stylist/customer/unknown |
| ãƒãƒ£ãƒ³ã‚¯å‡¦ç† | âœ… | âœ… | âœ… | chunk_indexã§ç®¡ç† |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

**å•é¡Œãªã—** âœ…

- `process-audio/index.ts`: æ­£ã—ãmså˜ä½ã§ä¿å­˜ï¼ˆline 126-127ï¼‰
- `diarization-callback/index.ts`: æ­£ã—ãmså˜ä½ã§ä¿å­˜ï¼ˆline 85-86, 125-126ï¼‰
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®å…¥åŠ›ï¼ˆç§’ï¼‰â†’ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å¤‰æ›ï¼ˆÃ—1000ï¼‰â†’DBä¿å­˜ï¼ˆmsï¼‰ã®æµã‚ŒãŒæ­£ã—ãå®Ÿè£…

### ãƒ©ã‚¦ãƒ³ãƒ‰1-6: åˆ†æè¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/06-ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/analyze-conversation/index.ts`

#### ç¢ºèªçµæœ

| æŒ‡æ¨™ | è¨­è¨ˆ | DB | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|------|------|-----|---------|------|
| talk_ratio | âœ… | âœ… | âœ… | - |
| question_analysis | âœ… | âœ… | âœ… | - |
| emotion_analysis | âœ… | âœ… | âœ… | - |
| concern_keywords | âœ… | âœ… | âœ… | - |
| proposal_timing | âœ… | âœ… | âœ… | - |
| proposal_quality | âœ… | âœ… | âœ… | - |
| conversion | âœ… | âœ… | âœ… | - |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-13: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¨­è¨ˆæ›¸ã®æ™‚é–“å˜ä½ãŒä¸æ˜ç¢º
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/06-ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°è¨­è¨ˆ.md` (line 49, 348)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  const duration = segment.endTime - segment.startTime;
  ```
  ```typescript
  startTime: number;
  endTime: number;
  ```
- **æ³¨è¨˜**: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ç§’å˜ä½ã‚’ä½¿ç”¨ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãªã—ï¼‰
- **DB**: ãƒŸãƒªç§’å˜ä½ï¼ˆ`start_time_ms`, `end_time_ms`ï¼‰
- **é‡è¦åº¦**: ä½ï¼ˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å†…éƒ¨è¡¨ç¾ã¯ç§’å˜ä½ã§å•é¡Œãªã—ã€å¤‰æ›ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å®Ÿæ–½ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ æ¨å¥¨ï¼‰

---

## ãƒ©ã‚¦ãƒ³ãƒ‰1 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
3. ç”»é¢è¨­è¨ˆ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
4. APIè©³ç´°ä»•æ§˜ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
5. éŸ³å£°å‡¦ç† Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
6. åˆ†æè¨­è¨ˆ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 13ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å†…è¨³ |
|--------|------|------|
| é«˜ | 4 | R1-2, R1-3, R1-6, R1-11 |
| ä¸­ | 5 | R1-1, R1-7, R1-8, R1-9, R1-10 |
| ä½/è»½å¾® | 4 | R1-4, R1-5, R1-12, R1-13 |

### å•é¡Œä¸€è¦§

| ID | å•é¡Œ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|---------|--------|-----------|
| R1-1 | Staff Entityä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-2 | Transcript Entityç§’å˜ä½ | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-3 | SpeakerSegment Entityç§’å˜ä½ | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-4 | ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³auth_user_id | è¨­è¨ˆ | ä½ | ğŸ”´ æœªä¿®æ­£ |
| R1-5 | ä¼ç”»æ›¸4æŒ‡æ¨™ã®ã¿ | ä¼ç”» | ä½ | ğŸŸ¡ è»½å¾® |
| R1-6 | StaffForm roleä¸æ­£ | UI | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-7 | StaffForm phoneä¸è¦ | UI | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-8 | CreateStaffSchema assistant | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-9 | CreateStaffSchema position/joinDate | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-10 | analyze-segment start_time | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-11 | generate-reportå¤ã„ã‚«ãƒ©ãƒ å | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-12 | roleplay-chat conversationHistory | è¨­è¨ˆ | ä½ | ğŸŸ¡ è»½å¾® |
| R1-13 | ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ™‚é–“å˜ä½ä¸æ˜ç¢º | è¨­è¨ˆ | ä½ | ğŸŸ¡ è»½å¾® |

---
