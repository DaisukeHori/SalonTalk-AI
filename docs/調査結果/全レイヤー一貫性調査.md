# å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è²«æ€§èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

èª¿æŸ»æ—¥: 2025-12-05
èª¿æŸ»å¯¾è±¡: ä¼ç”»æ›¸ãƒ»è¨­è¨ˆæ›¸ãƒ»DBãƒ»UIãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼ˆEdge Functionsï¼‰

## èª¿æŸ»ç›®çš„
å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§ç”¨èªãƒ»ã‚«ãƒ©ãƒ åãƒ»ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸€è²«æ€§ã‚’ç¢ºä¿ã™ã‚‹

---

## èª¿æŸ»ãƒ©ã‚¦ãƒ³ãƒ‰è¨˜éŒ²

### ãƒ©ã‚¦ãƒ³ãƒ‰1-10: DBã‚¹ã‚­ãƒ¼ãƒã¨å‹å®šç¾©ã®æ¯”è¼ƒ

#### ãƒ©ã‚¦ãƒ³ãƒ‰1: salonsãƒ†ãƒ¼ãƒ–ãƒ«
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **sharedå‹**: `packages/shared/src/infrastructure/supabase/types.ts`
- **UIå‹**: `apps/web/src/types/database.ts`
- **çµæœ**: âœ… ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰2: staffsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ ä¸ä¸€è‡´ç™ºè¦‹
- **å•é¡Œ**: UIå‹ã«å­˜åœ¨ã—ãªã„ã‚«ãƒ©ãƒ ã‚ã‚Š
  - `position` - DBã«å­˜åœ¨ã—ãªã„
  - `join_date` - DBã«å­˜åœ¨ã—ãªã„
  - `profile_image_url` - DBã«å­˜åœ¨ã—ãªã„ï¼ˆ`avatar_url`ãŒæ­£è§£ï¼‰
  - `settings` - DBã«å­˜åœ¨ã—ãªã„

#### ãƒ©ã‚¦ãƒ³ãƒ‰3: sessionsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ ä¸ä¸€è‡´ç™ºè¦‹
- **å•é¡Œ**:
  - UIå‹ã«`diarization_status`ãŒã‚ã‚‹ãŒã€DBã‚¹ã‚­ãƒ¼ãƒï¼ˆmigrationï¼‰ã«ã¯å­˜åœ¨ã—ãªã„
  - è¨­è¨ˆæ›¸ãƒ»ä¼ç”»æ›¸ã«ã¯`diarization_status`ã®è¨˜è¼‰ã‚ã‚Š

#### ãƒ©ã‚¦ãƒ³ãƒ‰4: transcriptsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ ä¸ä¸€è‡´ç™ºè¦‹
- **å•é¡Œ**: UIå‹ã«`confidence`ã‚«ãƒ©ãƒ ãŒæ¬ ã‘ã¦ã„ã‚‹

#### ãƒ©ã‚¦ãƒ³ãƒ‰5: speaker_segmentsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰6: session_analysesãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆæ­£è¦åŒ–æ§‹é€ ã§çµ±ä¸€æ¸ˆã¿ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰7: session_reportsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ è¨­è¨ˆæ›¸ã¨å®Ÿè£…ã§å·®ç•°
- **è¨­è¨ˆæ›¸**: `good_points`, `improvement_points`, `action_items`, `transcript_summary`, `ai_feedback`
- **DBå®Ÿè£…**: `summary`, `improvements`, `strengths`, `metrics`, `concern_keywords`

#### ãƒ©ã‚¦ãƒ³ãƒ‰8: success_casesãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âš ï¸ è¨­è¨ˆæ›¸ã«ä¸€éƒ¨ã‚«ãƒ©ãƒ æ¬ ã‘
- **è¨­è¨ˆæ›¸ã«æ¬ ã‘**: `approach_text`, `result`, `is_active`

#### ãƒ©ã‚¦ãƒ³ãƒ‰9: training_scenariosãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆtitle/difficultyã§çµ±ä¸€æ¸ˆã¿ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰10: roleplay_sessionsãƒ†ãƒ¼ãƒ–ãƒ«
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆmessages/ended_atã§çµ±ä¸€æ¸ˆã¿ï¼‰

---

### ãƒ©ã‚¦ãƒ³ãƒ‰11-15: Edge Functionsç¢ºèª

#### ãƒ©ã‚¦ãƒ³ãƒ‰11: process-audio
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/process-audio/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`start_time_ms`/`end_time_ms`ã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰12: diarization-callback
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/diarization-callback/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`start_time_ms`/`end_time_ms`ã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰13: analyze-segment
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/analyze-segment/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`start_time_ms`/`end_time_ms`ã¨æ­£è¦åŒ–ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰14: generate-report
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/generate-report/index.ts`
- **çµæœ**: âœ… æ­£ã—ãæ­£è¦åŒ–session_analysesã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰15: roleplay-chat
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/roleplay-chat/index.ts`
- **çµæœ**: âœ… æ­£ã—ã`messages`/`ended_at`ã‚’ä½¿ç”¨

---

### ãƒ©ã‚¦ãƒ³ãƒ‰16-20: è¨­è¨ˆæ›¸ã¨ã®æ•´åˆæ€§

#### ãƒ©ã‚¦ãƒ³ãƒ‰16: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**: session_reportsã®ã‚«ãƒ©ãƒ åãŒDBå®Ÿè£…ã¨ä¸ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰17: APIè¨­è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- **çµæœ**: âš ï¸ é‡å¤§ãªå•é¡Œç™ºè¦‹
- **å•é¡Œ**:
  - process-audioå®Ÿè£…ä¾‹ã§`start_time`/`end_time`ã‚’ä½¿ç”¨ï¼ˆæ­£ã—ãã¯`start_time_ms`/`end_time_ms`ï¼‰
  - diarization-callbackå®Ÿè£…ä¾‹ã§åŒæ§˜ã®å•é¡Œ
  - analyze-segmentå®Ÿè£…ä¾‹ã§`.order('start_time')`ã‚’ä½¿ç”¨

#### ãƒ©ã‚¦ãƒ³ãƒ‰18: RLSè¨­è¨ˆ
- **çµæœ**: âœ… ä¸€è‡´ï¼ˆid = auth.uid()ãƒ‘ã‚¿ãƒ¼ãƒ³ã§çµ±ä¸€æ¸ˆã¿ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰19: çµ±è¨ˆé–¢æ•°è¨­è¨ˆ
- **çµæœ**: âœ… ä¸€è‡´

#### ãƒ©ã‚¦ãƒ³ãƒ‰20: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ
- **çµæœ**: âœ… ä¸€è‡´

---

### ãƒ©ã‚¦ãƒ³ãƒ‰21-25: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª

#### ãƒ©ã‚¦ãƒ³ãƒ‰21: StaffTable.tsx
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffTable.tsx`
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**:
  - `role: 'stylist' | 'manager' | 'receptionist'`
  - DBã§ã¯ `'stylist' | 'manager' | 'owner' | 'admin'`
  - `receptionist`ã¯å­˜åœ¨ã—ãªã„ã€`owner`/`admin`ãŒæ¬ ã‘

#### ãƒ©ã‚¦ãƒ³ãƒ‰22: ReportViewer.tsx
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/report/ReportViewer.tsx`
- **çµæœ**: âœ… UIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿ï¼ˆDBç›´æ¥å‚ç…§ãªã—ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰23: RecentSessions.tsx
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/dashboard/RecentSessions.tsx`
- **çµæœ**: âœ… UIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿

#### ãƒ©ã‚¦ãƒ³ãƒ‰24: database.tså‹å®šç¾©
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`
- **çµæœ**: âš ï¸ è¤‡æ•°å•é¡Œç™ºè¦‹ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰2-4å‚ç…§ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰25: ä¸è¶³ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**: `staff_training_stats`ãƒ†ãƒ¼ãƒ–ãƒ«ãŒUIå‹å®šç¾©ã«æ¬ ã‘ã¦ã„ã‚‹

---

### ãƒ©ã‚¦ãƒ³ãƒ‰26-30: ä¼ç”»æ›¸ã¨ã®æ•´åˆæ€§

#### ãƒ©ã‚¦ãƒ³ãƒ‰26: æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`
- **çµæœ**: âš ï¸ å•é¡Œç™ºè¦‹
- **å•é¡Œ**:
  - ã‚³ãƒ¼ãƒ‰ä¾‹ã§`start_time`/`end_time`ã‚’ä½¿ç”¨ï¼ˆline 168-175ï¼‰
  - `role`ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨ï¼ˆæ­£ã—ãã¯`speaker`ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰27: æ©Ÿèƒ½è©³ç´°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md`
- **çµæœ**: âœ… ç”¨èªã¯æ•´åˆï¼ˆãƒˆãƒ¼ã‚¯æ¯”ç‡ç­‰ï¼‰

#### ãƒ©ã‚¦ãƒ³ãƒ‰28: diarization_statusã®æ‰±ã„
- **çµæœ**: âš ï¸ ä¸æ•´åˆ
- **è¨­è¨ˆæ›¸/ä¼ç”»æ›¸**: `diarization_status`ã‚ã‚Š
- **DBã‚¹ã‚­ãƒ¼ãƒ**: `diarization_status`ãªã—
- **UIå‹**: `diarization_status`ã‚ã‚Š
- **æ±ºå®šãŒå¿…è¦**: è¿½åŠ ã™ã‚‹ã‹å‰Šé™¤ã™ã‚‹ã‹

#### ãƒ©ã‚¦ãƒ³ãƒ‰29: ç”¨èªçµ±ä¸€ç¢ºèª
- **çµæœ**: âœ… ä¸»è¦ç”¨èªã¯çµ±ä¸€æ¸ˆã¿
  - ãƒˆãƒ¼ã‚¯æ¯”ç‡ï¼ˆå‚¾è´ã‚¹ã‚³ã‚¢ã§ã¯ãªã„ï¼‰
  - title/difficulty
  - messages/ended_at

#### ãƒ©ã‚¦ãƒ³ãƒ‰30: speaker_segments.speakerå€¤
- **çµæœ**: âœ… çµ±ä¸€æ¸ˆã¿
- `'stylist' | 'customer' | 'unknown'`ã§ä¸€è‡´

---

## ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œä¸€è¦§

| # | å•é¡Œ | å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|------|-------------|--------|-----------|
| 1 | UIå‹(database.ts)ã«staffsã®ä¸è¦ã‚«ãƒ©ãƒ  | UI | é«˜ | âœ… ä¿®æ­£æ¸ˆ |
| 2 | UIå‹ã«diarization_statusãŒã‚ã‚‹ãŒDBã«ãªã„ | DBãƒ»UIãƒ»è¨­è¨ˆ | é«˜ | âœ… ä¿®æ­£æ¸ˆ (DBã«è¿½åŠ ) |
| 3 | UIå‹ã«transcripts.confidenceãŒæ¬ ã‘ | UI | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 4 | UIå‹ã«staff_training_statsãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ¬ ã‘ | UI | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 5 | StaffTableã®roleå‹ãŒä¸æ­£ | UI | é«˜ | âœ… ä¿®æ­£æ¸ˆ |
| 6 | APIè¨­è¨ˆæ›¸ã§start_timeä½¿ç”¨ | è¨­è¨ˆ | é«˜ | âœ… ä¿®æ­£æ¸ˆ |
| 7 | ä¼ç”»æ›¸ã§start_time/roleä½¿ç”¨ | ä¼ç”» | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 8 | session_reportsã®ã‚«ãƒ©ãƒ åä¸ä¸€è‡´ | è¨­è¨ˆ | ä¸­ | âœ… ä¿®æ­£æ¸ˆ |
| 9 | success_casesã®ã‚«ãƒ©ãƒ æ¬ ã‘ | è¨­è¨ˆ | ä½ | âœ… ä¿®æ­£æ¸ˆ |
| 10 | notification_logs.read_atãŒUIå‹ã«æ¬ ã‘ | UI | ä½ | âœ… ä¿®æ­£æ¸ˆ |

---

## å•é¡Œè©³ç´°ã¨æ¨å¥¨å¯¾å¿œ

### å•é¡Œ1: UIå‹ã«staffsã®ä¸è¦ã‚«ãƒ©ãƒ 

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`

**ç¾çŠ¶**:
```typescript
staffs: {
  Row: {
    position: string | null;      // DBã«å­˜åœ¨ã—ãªã„
    join_date: string | null;     // DBã«å­˜åœ¨ã—ãªã„
    profile_image_url: string | null;  // avatar_urlãŒæ­£è§£
    settings: Json | null;        // DBã«å­˜åœ¨ã—ãªã„
  }
}
```

**æ¨å¥¨å¯¾å¿œ**:
- `position`, `join_date`, `settings`ã‚’å‰Šé™¤
- `profile_image_url`ã‚’å‰Šé™¤ï¼ˆ`avatar_url`ã®ã¿ä½¿ç”¨ï¼‰

**ç†ç”±**:
- **è¨­è¨ˆ**: DBã‚¹ã‚­ãƒ¼ãƒã«ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **UI**: å­˜åœ¨ã—ãªã„ã‚«ãƒ©ãƒ ã‚’å‚ç…§ã™ã‚‹ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã®åŸå› ã«ãªã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£**: ä¸€è²«æ€§ãŒãªã„ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå›°é›£ã«ãªã‚‹

---

### å•é¡Œ2: diarization_statusã®ä¸æ•´åˆ

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: DBãƒ»UIãƒ»è¨­è¨ˆãƒ»ä¼ç”»
**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**:
- `supabase/migrations/00000000000000_initial_schema.sql`
- `apps/web/src/types/database.ts`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`
- `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`

**ç¾çŠ¶**:
- è¨­è¨ˆæ›¸ãƒ»ä¼ç”»æ›¸: `diarization_status`ã‚ã‚Š
- DBã‚¹ã‚­ãƒ¼ãƒ: ãªã—
- UIå‹: ã‚ã‚Š

**æ¨å¥¨å¯¾å¿œï¼ˆ2ã¤ã®é¸æŠè‚¢ï¼‰**:

**é¸æŠè‚¢Aï¼ˆæ¨å¥¨ï¼‰**: DBã«è¿½åŠ 
```sql
ALTER TABLE sessions ADD COLUMN diarization_status TEXT
  DEFAULT 'pending'
  CHECK (diarization_status IN ('pending', 'processing', 'completed', 'failed'));
```

**é¸æŠè‚¢B**: è¨­è¨ˆæ›¸ãƒ»UIå‹ã‹ã‚‰å‰Šé™¤

**ç†ç”±**:
- **è¨­è¨ˆ**: è©±è€…åˆ†é›¢ã®çŠ¶æ…‹ç®¡ç†ã¯ä¼ç”»æ›¸ã§æ˜ç¤ºã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½è¦ä»¶
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: diarization-callbackãŒçŠ¶æ…‹æ›´æ–°ã‚’è©¦ã¿ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£**: è©±è€…åˆ†é›¢ã®é€²æ—è¡¨ç¤ºã«å¿…è¦

---

### å•é¡Œ3: UIå‹ã«transcripts.confidenceãŒæ¬ ã‘

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`

**æ¨å¥¨å¯¾å¿œ**: `confidence`ã‚’è¿½åŠ 
```typescript
transcripts: {
  Row: {
    confidence: number | null;  // è¿½åŠ 
  }
}
```

**ç†ç”±**:
- **DB**: transcriptsãƒ†ãƒ¼ãƒ–ãƒ«ã«confidenceã‚«ãƒ©ãƒ ãŒå­˜åœ¨
- **UI**: ä¿¡é ¼åº¦ã«åŸºã¥ãè¡¨ç¤ºãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ä½¿ç”¨å¯èƒ½

---

### å•é¡Œ4: staff_training_statsãƒ†ãƒ¼ãƒ–ãƒ«æ¬ ã‘

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`

**æ¨å¥¨å¯¾å¿œ**: ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã‚’è¿½åŠ 
```typescript
staff_training_stats: {
  Row: {
    id: string;
    staff_id: string;
    total_training_count: number;
    total_score_sum: number;
    average_score: number;
    highest_score: number;
    last_training_at: string | null;
    updated_at: string;
  };
  // Insert/Update ã‚‚è¿½åŠ 
}
```

**ç†ç”±**:
- **DB**: ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹
- **UI**: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµ±è¨ˆè¡¨ç¤ºã«å¿…è¦

---

### å•é¡Œ5: StaffTableã®roleå‹ãŒä¸æ­£

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: UI
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffTable.tsx`

**ç¾çŠ¶**:
```typescript
role: 'stylist' | 'manager' | 'receptionist';  // ä¸æ­£
```

**æ¨å¥¨å¯¾å¿œ**:
```typescript
role: 'stylist' | 'manager' | 'owner' | 'admin';  // æ­£ã—ã„å€¤
```

**ç†ç”±**:
- **DB**: roleã¯`'stylist' | 'manager' | 'owner' | 'admin'`
- **è¨­è¨ˆ**: `receptionist`ã¯å­˜åœ¨ã—ãªã„
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£**: ç®¡ç†è€…ï¼ˆowner/adminï¼‰è¡¨ç¤ºãŒã§ããªã„

---

### å•é¡Œ6-7: è¨­è¨ˆæ›¸ãƒ»ä¼ç”»æ›¸ã§start_timeä½¿ç”¨

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: è¨­è¨ˆãƒ»ä¼ç”»
**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`

**æ¨å¥¨å¯¾å¿œ**:
- `start_time` â†’ `start_time_ms`
- `end_time` â†’ `end_time_ms`
- `role` â†’ `speaker`ï¼ˆspeaker_segmentsã®å ´åˆï¼‰

**ç†ç”±**:
- **DB**: ãƒŸãƒªç§’å˜ä½ã§çµ±ä¸€æ¸ˆã¿
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: å®Ÿè£…ã¯æ­£ã—ã`start_time_ms`ã‚’ä½¿ç”¨
- **è¨­è¨ˆ**: è¨­è¨ˆæ›¸ã¨å®Ÿè£…ã®ä¹–é›¢ã¯æ··ä¹±ã‚’æ‹›ã

---

### å•é¡Œ8: session_reportsã®ã‚«ãƒ©ãƒ åä¸ä¸€è‡´

**å½±éŸ¿ãƒ¬ã‚¤ãƒ¤ãƒ¼**: è¨­è¨ˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`

**è¨­è¨ˆæ›¸**:
- `good_points`, `improvement_points`, `action_items`
- `transcript_summary`, `ai_feedback`, `indicator_scores`

**DBå®Ÿè£…**:
- `summary`, `improvements`, `strengths`
- `metrics`, `concern_keywords`, `proposal_timing_ms`

**æ¨å¥¨å¯¾å¿œ**: è¨­è¨ˆæ›¸ã‚’DBå®Ÿè£…ã«åˆã‚ã›ã¦æ›´æ–°

**ç†ç”±**:
- **DB**: å®Ÿè£…ãŒæ—¢ã«å­˜åœ¨
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: generate-reportãŒå®Ÿè£…æ¸ˆã¿ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨

---

## èª¿æŸ»å®Œäº†å¾Œã®æ¨å¥¨äº‹é …

### å„ªå…ˆåº¦: é«˜
1. **UIå‹å®šç¾©ã®ä¿®æ­£** (å•é¡Œ1, 3, 4, 10)
   - staffsã‹ã‚‰ä¸è¦ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤
   - transcripts.confidenceã‚’è¿½åŠ 
   - staff_training_statsã‚’è¿½åŠ 
   - notification_logs.read_atã‚’è¿½åŠ 

2. **StaffTableã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿®æ­£** (å•é¡Œ5)
   - roleå‹ã‚’æ­£ã—ã„å€¤ã«ä¿®æ­£

3. **diarization_statusã®æ±ºå®š** (å•é¡Œ2)
   - DBã«è¿½åŠ ã™ã‚‹ã‹ã€è¨­è¨ˆã‹ã‚‰å‰Šé™¤ã™ã‚‹ã‹æ±ºå®š

### å„ªå…ˆåº¦: ä¸­
4. **è¨­è¨ˆæ›¸ã®æ›´æ–°** (å•é¡Œ6, 8)
   - APIè¨­è¨ˆæ›¸ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’`start_time_ms`/`end_time_ms`ã«ä¿®æ­£
   - session_reportsã®ã‚«ãƒ©ãƒ åã‚’å®Ÿè£…ã«åˆã‚ã›ã¦ä¿®æ­£

5. **ä¼ç”»æ›¸ã®æ›´æ–°** (å•é¡Œ7)
   - ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å®Ÿè£…ã«åˆã‚ã›ã¦ä¿®æ­£

### å„ªå…ˆåº¦: ä½
6. **è¨­è¨ˆæ›¸ã®è£œå®Œ** (å•é¡Œ9)
   - success_casesã«æ¬ ã‘ã¦ã„ã‚‹ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 

---

## çµè«–

30ãƒ©ã‚¦ãƒ³ãƒ‰ã®èª¿æŸ»ã®çµæœã€**10ä»¶ã®ä¸æ•´åˆ**ã‚’ç™ºè¦‹ã—ã€**å…¨ã¦ä¿®æ­£å®Œäº†**ã—ã¾ã—ãŸã€‚

ä¿®æ­£å‰:
- **Edge Functionsï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰**: âœ… æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- **DBã‚¹ã‚­ãƒ¼ãƒ**: âš ï¸ diarization_statusãŒæ¬ ã‘ã¦ã„ãŸ
- **sharedå‹å®šç¾©**: âœ… æ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- **UIå‹å®šç¾©**: âš ï¸ è¤‡æ•°ã®ä¸æ•´åˆã‚ã‚Š
- **è¨­è¨ˆæ›¸**: âš ï¸ ä¸€éƒ¨ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå¤ã„
- **ä¼ç”»æ›¸**: âš ï¸ ä¸€éƒ¨ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå¤ã„

ä¿®æ­£å¾Œï¼ˆ2025-12-05ï¼‰:
- **Edge Functionsï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰**: âœ… æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- **DBã‚¹ã‚­ãƒ¼ãƒ**: âœ… diarization_statusã‚’è¿½åŠ 
- **sharedå‹å®šç¾©**: âœ… diarization_statusã‚’è¿½åŠ 
- **UIå‹å®šç¾©**: âœ… å…¨ã¦ä¿®æ­£å®Œäº†
- **è¨­è¨ˆæ›¸**: âœ… å…¨ã¦ä¿®æ­£å®Œäº†
- **ä¼ç”»æ›¸**: âœ… å…¨ã¦ä¿®æ­£å®Œäº†

**å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆä¼ç”»ãƒ»è¨­è¨ˆãƒ»DBãƒ»UIãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰ã®ä¸€è²«æ€§ãŒç¢ºä¿ã•ã‚Œã¾ã—ãŸã€‚**

---

## 50ãƒ©ã‚¦ãƒ³ãƒ‰èª¿æŸ»ï¼ˆè©³ç´°è¨­è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ï¼‰

èª¿æŸ»æ—¥: 2025-12-05ï¼ˆç¶™ç¶šï¼‰
èª¿æŸ»æ–¹æ³•: å„è©³ç´°è¨­è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆä¼ç”»ãƒ»è¨­è¨ˆãƒ»DBãƒ»UIãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰

---

### ãƒ©ã‚¦ãƒ³ãƒ‰1: ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **ä¼ç”»**: `docs/ä¼ç”»æ›¸/04-æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.md`
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/01-ã¯ã˜ã‚ã«.md`, `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **UI**: `apps/web/src/types/database.ts`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/process-audio/index.ts`, `supabase/functions/analyze-conversation/index.ts`

#### ç¢ºèªçµæœ

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è©³ç´° |
|---------|-----------|------|
| ä¼ç”» | âœ… | æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã¯æ­£ç¢º |
| è¨­è¨ˆ | âš ï¸ | ã‚¯ãƒ©ã‚¹è¨­è¨ˆã«DBä¸æ•´åˆã‚ã‚Šï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |
| DB | âœ… | ã‚¹ã‚­ãƒ¼ãƒã¯ä¸€è²«æ€§ã‚ã‚Š |
| UI | âœ… | å‹å®šç¾©ã¯DBã¨ä¸€è‡´ |
| ãƒ¯ãƒ¼ã‚«ãƒ¼ | âœ… | millisecondså˜ä½ã§æ­£ã—ãå®Ÿè£… |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-1: Staff Entityã«ä¸è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 270-277)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  export interface Staff {
    readonly position: string | null;         // DBã«å­˜åœ¨ã—ãªã„
    readonly joinDate: Date | null;           // DBã«å­˜åœ¨ã—ãªã„
    readonly profileImageUrl: string | null;  // avatar_urlãŒæ­£è§£
    readonly settings: StaffSettings;         // DBã«å­˜åœ¨ã—ãªã„
  }
  ```
- **DBå®Ÿè£…**: ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-2: Transcript EntityãŒç§’å˜ä½
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 544-546)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  readonly startTime: number;  // ç§’
  readonly endTime: number;    // ç§’
  ```
- **DBå®Ÿè£…**: `start_time_ms INTEGER` (ãƒŸãƒªç§’)
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-3: SpeakerSegment EntityãŒç§’å˜ä½
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 620-622)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  readonly startTime: number;  // ç§’
  readonly endTime: number;    // ç§’
  ```
- **DBå®Ÿè£…**: `start_time_ms INTEGER` (ãƒŸãƒªç§’)
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰1-2: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **ä¼ç”»**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md`
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **UI**: `apps/web/src/types/database.ts`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/create-session/index.ts`, `supabase/functions/end-session/index.ts`

#### ç¢ºèªçµæœ

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | ä¼ç”» | è¨­è¨ˆ | DB | UI | ãƒ¯ãƒ¼ã‚«ãƒ¼ |
|-------------|------|------|-----|-----|---------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ | âš ï¸ | âœ… | âœ… | âœ… | âœ… |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† | âœ… | âœ… | âœ… | âœ… | âœ… |
| ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ | âœ… | âœ… | âœ… | âœ… | âœ… |
| èªè¨¼ | - | âš ï¸ | âœ… | âœ… | âœ… |
| ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° | âœ… | âœ… | âœ… | âœ… | âœ… |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-4: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã§auth_user_idã‚’ä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md` (line 368-369)
- **è¨­è¨ˆæ›¸**:
  ```sql
  SELECT * FROM staffs WHERE auth_user_id = ?
  ```
- **DBå®Ÿè£…**: `staffs.id = auth.uid()`ï¼ˆidè‡ªä½“ãŒauth.users(id)ã¸ã®å‚ç…§ï¼‰
- **é‡è¦åº¦**: ä½ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ã€å®Ÿè£…ã¯æ­£ã—ã„ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-5: ä¼ç”»æ›¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°è¡¨ãŒ4æŒ‡æ¨™ã®ã¿
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md` (line 21-26)
- **ä¼ç”»æ›¸**: 4æŒ‡æ¨™ï¼ˆãƒˆãƒ¼ã‚¯æ¯”ç‡ã€è³ªå•ã‚¹ã‚³ã‚¢ã€æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã€ææ¡ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰
- **å®Ÿè£…**: 7æŒ‡æ¨™ï¼ˆ+ æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ææ¡ˆå“è³ªã€æˆç´„åˆ¤å®šï¼‰
- **é‡è¦åº¦**: ä½ï¼ˆæœ¬æ–‡ã§7æŒ‡æ¨™ã¯è¨€åŠã•ã‚Œã¦ã„ã‚‹ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®

### ãƒ©ã‚¦ãƒ³ãƒ‰1-3: ç”»é¢è¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **UI**: `apps/web/src/components/staff/StaffForm.tsx`, `apps/web/src/components/staff/StaffTable.tsx`

#### ç¢ºèªçµæœ

| ç”»é¢ | è¨­è¨ˆ | DB | UI | å‚™è€ƒ |
|------|------|-----|-----|------|
| ãƒ­ã‚°ã‚¤ãƒ³ | âœ… | âœ… | - | - |
| ãƒ›ãƒ¼ãƒ  | âœ… | âœ… | âœ… | - |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ | âœ… | âœ… | - | iPadå°‚ç”¨ |
| ãƒ¬ãƒãƒ¼ãƒˆè©³ç´° | âœ… | âœ… | âœ… | - |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | âœ… | âœ… | âœ… | - |
| ã‚¹ã‚¿ãƒƒãƒ•ãƒ•ã‚©ãƒ¼ãƒ  | âš ï¸ | âœ… | âš ï¸ | è¤‡æ•°å•é¡Œ |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-6: StaffFormã®roleå‹ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffForm.tsx` (line 14, 26-30)
- **UIå®Ÿè£…**:
  ```typescript
  role: 'stylist' | 'manager' | 'receptionist';
  const roleOptions = [
    { value: 'stylist', label: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ' },
    { value: 'manager', label: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' },
    { value: 'receptionist', label: 'ãƒ¬ã‚»ãƒ—ã‚·ãƒ§ãƒ³' },
  ];
  ```
- **DB**: `'stylist' | 'manager' | 'owner' | 'admin'`
- **é‡è¦åº¦**: é«˜ï¼ˆDBã«ä¿å­˜ä¸å¯èƒ½ãªå€¤ã‚’å«ã‚€ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-7: StaffFormã«phoneãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹ãŒDBã«ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffForm.tsx` (line 47, 135-155)
- **UIå®Ÿè£…**: `phone` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚ã‚Š
- **DB**: staffsãƒ†ãƒ¼ãƒ–ãƒ«ã« `phone` ã‚«ãƒ©ãƒ ãªã—
- **é‡è¦åº¦**: é«˜ï¼ˆä¿å­˜æ™‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-8: è¨­è¨ˆæ›¸ã®CreateStaffSchemaã§assistantä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md` (line 290)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  role: z.enum(['owner', 'manager', 'stylist', 'assistant'], {...})
  ```
- **DB**: `'owner' | 'manager' | 'stylist' | 'admin'`ï¼ˆ`admin`ãŒæ­£è§£ï¼‰
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-9: è¨­è¨ˆæ›¸ã®CreateStaffSchemaã«position/joinDateãŒã‚ã‚‹ãŒDBã«ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md` (line 293-294)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  position: z.string().max(50, 'å½¹è·ã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),
  joinDate: z.string().date('æœ‰åŠ¹ãªæ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),
  ```
- **DB**: staffsãƒ†ãƒ¼ãƒ–ãƒ«ã«ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ãªã—
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰1-4: APIè©³ç´°ä»•æ§˜ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/*/index.ts`

#### ç¢ºèªçµæœ

| API | è¨­è¨ˆ | DB | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|-----|------|-----|---------|------|
| create-session | âœ… | âœ… | âœ… | - |
| process-audio | âœ… | âœ… | âœ… | - |
| diarization-callback | âœ… | âœ… | âœ… | - |
| analyze-segment | âš ï¸ | âœ… | âœ… | è¨­è¨ˆæ›¸ã‚³ãƒ¼ãƒ‰ã«ãƒã‚° |
| search-cases | âœ… | âœ… | âœ… | - |
| generate-report | âš ï¸ | âœ… | âœ… | è¨­è¨ˆæ›¸ãŒå¤ã„ã‚«ãƒ©ãƒ å |
| roleplay-chat | âš ï¸ | âœ… | âœ… | è¨­è¨ˆæ›¸ãŒå¤ã„ã‚«ãƒ©ãƒ å |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-10: analyze-segmentè¨­è¨ˆã§start_timeä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (line 870-871)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  const duration = segment.end_time - segment.start_time;
  ```
- **DB**: `end_time_ms INTEGER`, `start_time_ms INTEGER`
- **é‡è¦åº¦**: ä¸­ï¼ˆè¨­è¨ˆæ›¸ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ã¿ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-11: generate-reportã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¤ã„ã‚«ãƒ©ãƒ å
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (line 1319-1418)
- **è¨­è¨ˆæ›¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ»INSERT**:
  ```typescript
  goodPoints, improvementPoints, actionItems,
  transcriptSummary, aiFeedback, indicator_scores
  ```
- **DBå®Ÿè£…**:
  ```
  summary, improvements, strengths, metrics,
  concern_keywords, proposal_timing_ms, etc.
  ```
- **é‡è¦åº¦**: é«˜ï¼ˆè¨­è¨ˆæ›¸ã¨å®Ÿè£…ãŒä¹–é›¢ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR1-12: roleplay-chatã§conversationHistoryä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (line 1559-1560)
- **è¨­è¨ˆæ›¸**: `conversationHistory`
- **DB**: `roleplay_sessions.messages`
- **é‡è¦åº¦**: ä½ï¼ˆAPIå†…éƒ¨è¡¨ç¾ã¨DBè¡¨ç¾ã®é•ã„ã¯è¨±å®¹ç¯„å›²ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®

### ãƒ©ã‚¦ãƒ³ãƒ‰1-5: éŸ³å£°å‡¦ç†ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md` (process-audio, diarization-callback)
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/process-audio/index.ts`, `supabase/functions/diarization-callback/index.ts`

#### ç¢ºèªçµæœ

| é …ç›® | è¨­è¨ˆ | DB | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|------|------|-----|---------|------|
| æ™‚é–“å˜ä½ | âœ… | âœ… (ms) | âœ… | ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒç§’â†’mså¤‰æ› |
| è©±è€…è­˜åˆ¥ | âœ… | âœ… | âœ… | stylist/customer/unknown |
| ãƒãƒ£ãƒ³ã‚¯å‡¦ç† | âœ… | âœ… | âœ… | chunk_indexã§ç®¡ç† |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

**å•é¡Œãªã—** âœ…

- `process-audio/index.ts`: æ­£ã—ãmså˜ä½ã§ä¿å­˜ï¼ˆline 126-127ï¼‰
- `diarization-callback/index.ts`: æ­£ã—ãmså˜ä½ã§ä¿å­˜ï¼ˆline 85-86, 125-126ï¼‰
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®å…¥åŠ›ï¼ˆç§’ï¼‰â†’ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å¤‰æ›ï¼ˆÃ—1000ï¼‰â†’DBä¿å­˜ï¼ˆmsï¼‰ã®æµã‚ŒãŒæ­£ã—ãå®Ÿè£…

### ãƒ©ã‚¦ãƒ³ãƒ‰1-6: åˆ†æè¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/06-ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/analyze-conversation/index.ts`

#### ç¢ºèªçµæœ

| æŒ‡æ¨™ | è¨­è¨ˆ | DB | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|------|------|-----|---------|------|
| talk_ratio | âœ… | âœ… | âœ… | - |
| question_analysis | âœ… | âœ… | âœ… | - |
| emotion_analysis | âœ… | âœ… | âœ… | - |
| concern_keywords | âœ… | âœ… | âœ… | - |
| proposal_timing | âœ… | âœ… | âœ… | - |
| proposal_quality | âœ… | âœ… | âœ… | - |
| conversion | âœ… | âœ… | âœ… | - |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR1-13: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¨­è¨ˆæ›¸ã®æ™‚é–“å˜ä½ãŒä¸æ˜ç¢º
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/06-ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°è¨­è¨ˆ.md` (line 49, 348)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  const duration = segment.endTime - segment.startTime;
  ```
  ```typescript
  startTime: number;
  endTime: number;
  ```
- **æ³¨è¨˜**: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ç§’å˜ä½ã‚’ä½¿ç”¨ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãªã—ï¼‰
- **DB**: ãƒŸãƒªç§’å˜ä½ï¼ˆ`start_time_ms`, `end_time_ms`ï¼‰
- **é‡è¦åº¦**: ä½ï¼ˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å†…éƒ¨è¡¨ç¾ã¯ç§’å˜ä½ã§å•é¡Œãªã—ã€å¤‰æ›ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å®Ÿæ–½ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ æ¨å¥¨ï¼‰

---

## ãƒ©ã‚¦ãƒ³ãƒ‰1 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
3. ç”»é¢è¨­è¨ˆ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
4. APIè©³ç´°ä»•æ§˜ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
5. éŸ³å£°å‡¦ç† Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
6. åˆ†æè¨­è¨ˆ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 13ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å†…è¨³ |
|--------|------|------|
| é«˜ | 4 | R1-2, R1-3, R1-6, R1-11 |
| ä¸­ | 5 | R1-1, R1-7, R1-8, R1-9, R1-10 |
| ä½/è»½å¾® | 4 | R1-4, R1-5, R1-12, R1-13 |

### å•é¡Œä¸€è¦§

| ID | å•é¡Œ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|---------|--------|-----------|
| R1-1 | Staff Entityä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-2 | Transcript Entityç§’å˜ä½ | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-3 | SpeakerSegment Entityç§’å˜ä½ | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-4 | ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³auth_user_id | è¨­è¨ˆ | ä½ | ğŸ”´ æœªä¿®æ­£ |
| R1-5 | ä¼ç”»æ›¸4æŒ‡æ¨™ã®ã¿ | ä¼ç”» | ä½ | ğŸŸ¡ è»½å¾® |
| R1-6 | StaffForm roleä¸æ­£ | UI | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-7 | StaffForm phoneä¸è¦ | UI | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-8 | CreateStaffSchema assistant | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-9 | CreateStaffSchema position/joinDate | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-10 | analyze-segment start_time | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R1-11 | generate-reportå¤ã„ã‚«ãƒ©ãƒ å | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R1-12 | roleplay-chat conversationHistory | è¨­è¨ˆ | ä½ | ğŸŸ¡ è»½å¾® |
| R1-13 | ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ™‚é–“å˜ä½ä¸æ˜ç¢º | è¨­è¨ˆ | ä½ | ğŸŸ¡ è»½å¾® |

### ãƒ©ã‚¦ãƒ³ãƒ‰1 æ¨å¥¨å¯¾å¿œä¸€è¦§

#### R1-1: Staff Entityä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// å‰Šé™¤ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- readonly position: string | null;
- readonly joinDate: Date | null;
- readonly profileImageUrl: string | null;  // avatar_urlã«çµ±ä¸€
- readonly settings: StaffSettings;

// æ­£ã—ã„å®šç¾©
export interface Staff {
  readonly id: string;
  readonly salonId: string;
  readonly name: string;
  readonly email: string;
  readonly role: 'stylist' | 'manager' | 'owner' | 'admin';
  readonly avatarUrl: string | null;
  readonly isActive: boolean;
  readonly createdAt: Date;
  readonly updatedAt: Date;
}
```

#### R1-2: Transcript Entityç§’å˜ä½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
readonly startTime: number;  // ç§’
readonly endTime: number;    // ç§’

// ä¿®æ­£å¾Œ
readonly startTimeMs: number;  // ãƒŸãƒªç§’ï¼ˆDBã¨ä¸€è‡´ï¼‰
readonly endTimeMs: number;    // ãƒŸãƒªç§’ï¼ˆDBã¨ä¸€è‡´ï¼‰
```

#### R1-3: SpeakerSegment Entityç§’å˜ä½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
readonly startTime: number;  // ç§’
readonly endTime: number;    // ç§’

// ä¿®æ­£å¾Œ
readonly startTimeMs: number;  // ãƒŸãƒªç§’ï¼ˆDBã¨ä¸€è‡´ï¼‰
readonly endTimeMs: number;    // ãƒŸãƒªç§’ï¼ˆDBã¨ä¸€è‡´ï¼‰
```

#### R1-4: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³auth_user_id
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md`
**æ¨å¥¨å¯¾å¿œ**:
```sql
-- ä¿®æ­£å‰
SELECT * FROM staffs WHERE auth_user_id = ?

-- ä¿®æ­£å¾Œï¼ˆRLSã«ä¾å­˜ï¼‰
SELECT * FROM staffs WHERE id = auth.uid()
-- æ³¨: staffs.id ã¯ auth.users(id) ã¸ã®ç›´æ¥å‚ç…§
```

#### R1-5: ä¼ç”»æ›¸4æŒ‡æ¨™ã®ã¿
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md`
**æ¨å¥¨å¯¾å¿œ**: 7æŒ‡æ¨™ã®è¡¨ã«æ›´æ–°ï¼ˆä»»æ„ï¼‰
```markdown
| æŒ‡æ¨™ | èª¬æ˜ |
|------|------|
| ãƒˆãƒ¼ã‚¯æ¯”ç‡ | ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ/é¡§å®¢ã®ç™ºè©±æ¯”ç‡ |
| è³ªå•ã‚¹ã‚³ã‚¢ | åŠ¹æœçš„ãªè³ªå•ã®é »åº¦ã¨è³ª |
| æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ | ä¼šè©±ã®æ„Ÿæƒ…ãƒˆãƒ¼ãƒ³åˆ†æ |
| æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ | é¡§å®¢ã®æ‚©ã¿ãƒ»ãƒ‹ãƒ¼ã‚ºã®æŠ½å‡º |
| ææ¡ˆã‚¿ã‚¤ãƒŸãƒ³ã‚° | é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®ææ¡ˆ |
| ææ¡ˆå“è³ª | ææ¡ˆå†…å®¹ã®é©åˆ‡ã• |
| æˆç´„åˆ¤å®š | æˆç´„ã«ã¤ãªãŒã‚‹ä¼šè©±ãƒ‘ã‚¿ãƒ¼ãƒ³ |
```

#### R1-6: StaffForm roleä¸æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffForm.tsx`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
role: 'stylist' | 'manager' | 'receptionist';
const roleOptions = [
  { value: 'stylist', label: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ' },
  { value: 'manager', label: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' },
  { value: 'receptionist', label: 'ãƒ¬ã‚»ãƒ—ã‚·ãƒ§ãƒ³' },
];

// ä¿®æ­£å¾Œ
role: 'stylist' | 'manager' | 'owner' | 'admin';
const roleOptions = [
  { value: 'stylist', label: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ' },
  { value: 'manager', label: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' },
  { value: 'owner', label: 'ã‚ªãƒ¼ãƒŠãƒ¼' },
  { value: 'admin', label: 'ç®¡ç†è€…' },
];
```

#### R1-7: StaffForm phoneä¸è¦
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffForm.tsx`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// phoneãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤
// StaffFormDataã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å‰Šé™¤
// ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰é›»è©±ç•ªå·å…¥åŠ›æ¬„ã‚’å‰Šé™¤
// é€ä¿¡å‡¦ç†ã‹ã‚‰phoneé–¢é€£ã®ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
```

#### R1-8: CreateStaffSchema assistant
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
role: z.enum(['owner', 'manager', 'stylist', 'assistant'], {...})

// ä¿®æ­£å¾Œ
role: z.enum(['owner', 'manager', 'stylist', 'admin'], {
  required_error: 'å½¹å‰²ã‚’é¸æŠã—ã¦ãã ã•ã„',
})
```

#### R1-9: CreateStaffSchema position/joinDate
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// å‰Šé™¤ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- position: z.string().max(50, 'å½¹è·ã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),
- joinDate: z.string().date('æœ‰åŠ¹ãªæ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),

// ã“ã‚Œã‚‰ã¯DBã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ãªã„ãŸã‚å‰Šé™¤
```

#### R1-10: analyze-segment start_time
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
const duration = segment.end_time - segment.start_time;

// ä¿®æ­£å¾Œ
const durationMs = segment.end_time_ms - segment.start_time_ms;
// ã¾ãŸã¯
const durationSec = (segment.end_time_ms - segment.start_time_ms) / 1000;
```

#### R1-11: generate-reportå¤ã„ã‚«ãƒ©ãƒ å
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹/INSERT
goodPoints, improvementPoints, actionItems,
transcriptSummary, aiFeedback, indicator_scores

// ä¿®æ­£å¾Œï¼ˆDBå®Ÿè£…ã«åˆã‚ã›ã‚‹ï¼‰
summary, improvements, strengths, metrics,
concern_keywords, proposal_timing_ms

// session_reportsãƒ†ãƒ¼ãƒ–ãƒ«ã®æ­£ã—ã„ã‚«ãƒ©ãƒ :
// - summary: TEXT
// - improvements: JSONB
// - strengths: JSONB
// - metrics: JSONB
// - concern_keywords: TEXT[]
// - proposal_timing_ms: INTEGER
```

#### R1-12: roleplay-chat conversationHistory
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
**æ¨å¥¨å¯¾å¿œ**: è»½å¾®ãªãŸã‚å¯¾å¿œä»»æ„
```typescript
// è¨­è¨ˆæ›¸å†…ã®å¤‰æ•°åã‚’DBã¨æƒãˆã‚‹å ´åˆ
// conversationHistory â†’ messages
// ãŸã ã—APIå†…éƒ¨è¡¨ç¾ã¨DBè¡¨ç¾ã®é•ã„ã¯è¨±å®¹ç¯„å›²
```

#### R1-13: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ™‚é–“å˜ä½ä¸æ˜ç¢º
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/06-ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**: ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼ˆä»»æ„ï¼‰
```typescript
interface ConversationSegment {
  startTime: number;  // ç§’å˜ä½ï¼ˆDBã¯ãƒŸãƒªç§’ã€å¤‰æ›ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å®Ÿæ–½ï¼‰
  endTime: number;    // ç§’å˜ä½ï¼ˆDBã¯ãƒŸãƒªç§’ã€å¤‰æ›ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å®Ÿæ–½ï¼‰
  speaker: 'stylist' | 'customer';
  text: string;
}
```

---

## ãƒ©ã‚¦ãƒ³ãƒ‰2: çŠ¶æ…‹é·ç§»ãƒ»å¤–éƒ¨é€£æºãƒ»ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

èª¿æŸ»æ—¥æ™‚: 2025-12-05

### ãƒ©ã‚¦ãƒ³ãƒ‰2-1: çŠ¶æ…‹é·ç§»è¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/05-çŠ¶æ…‹é·ç§»è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç¢ºèªçµæœ

| é …ç›® | è¨­è¨ˆ | DB | å‚™è€ƒ |
|------|------|-----|------|
| ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ | âš ï¸ | âœ… | è¨­è¨ˆæ›¸ã®çŠ¶æ…‹åãŒDBã¨ä¸ä¸€è‡´ |
| è©±è€…åˆ†é›¢çŠ¶æ…‹ | âœ… | âœ… | ä¸€è‡´ |
| èªè¨¼çŠ¶æ…‹ | âœ… | - | UIã®ã¿ï¼ˆDBãªã—ï¼‰ |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR2-1: ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹åã®ä¸ä¸€è‡´
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/05-çŠ¶æ…‹é·ç§»è¨­è¨ˆ.md` (line 39, 47, 58)
- **è¨­è¨ˆæ›¸**: `RECORDING`, `PROCESSING`, `COMPLETED`, `FAILED`
- **DB**: `'recording' | 'processing' | 'analyzing' | 'completed' | 'error'`
- **å•é¡Œç‚¹**:
  - `FAILED` â†’ DB ã§ã¯ `'error'`
  - `analyzing` çŠ¶æ…‹ãŒè¨­è¨ˆæ›¸ã«ãªã„
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰2-2: å¤–éƒ¨é€£æºè¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/09-å¤–éƒ¨é€£æºè©³ç´°è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/generate-report/index.ts`

#### ç¢ºèªçµæœ

| å¤–éƒ¨API | è¨­è¨ˆ | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|---------|------|---------|------|
| Claude API | âœ… | âœ… | ä¸€è‡´ |
| OpenAI Embedding | âœ… | - | æœªå®Ÿè£…ã ãŒè¨­è¨ˆã‚ã‚Š |
| pyannote Server | âœ… | âœ… | ä¸€è‡´ |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR2-2: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒå¤ã„ã‚«ãƒ©ãƒ åã‚’ä½¿ç”¨
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/09-å¤–éƒ¨é€£æºè©³ç´°è¨­è¨ˆ.md` (line 289-296)
- **è¨­è¨ˆæ›¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›å½¢å¼**:
  ```json
  {
    "goodPoints": ["..."],
    "improvementPoints": ["..."],
    "actionItems": ["..."],
    "transcriptSummary": "...",
    "aiFeedback": "..."
  }
  ```
- **DBå®Ÿè£…**:
  ```
  summary, improvements, strengths, metrics, concern_keywords
  ```
- **é‡è¦åº¦**: é«˜ï¼ˆR1-11ã¨åŒæ§˜ã®å•é¡Œï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰2-3: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸€è²«æ€§ç¢ºèªï¼ˆè¿½åŠ ï¼‰

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **UI**: `apps/web/src/components/staff/StaffCard.tsx`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR2-3: StaffCard roleå‹ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffCard.tsx` (line 14, 24-34)
- **UIå®Ÿè£…**:
  ```typescript
  role: 'stylist' | 'manager' | 'receptionist';

  const roleLabels = {
    stylist: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
    manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
    receptionist: 'ãƒ¬ã‚»ãƒ—ã‚·ãƒ§ãƒ³',
  };
  ```
- **DB**: `'stylist' | 'manager' | 'owner' | 'admin'`
- **é‡è¦åº¦**: é«˜ï¼ˆR1-6ã¨åŒæ§˜ã®å•é¡ŒãŒåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚å­˜åœ¨ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR2-4: StaffCard phone/joinedAtãŒDBã«å­˜åœ¨ã—ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffCard.tsx` (line 13, 20)
- **UIå®Ÿè£…**:
  ```typescript
  phone?: string;      // DBã«å­˜åœ¨ã—ãªã„
  joinedAt: Date;      // DBã«å­˜åœ¨ã—ãªã„
  ```
- **DB staffsãƒ†ãƒ¼ãƒ–ãƒ«**: ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰2-4: ãƒ†ã‚¹ãƒˆä»•æ§˜ã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/11-ãƒ†ã‚¹ãƒˆä»•æ§˜.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç¢ºèªçµæœ

| ãƒ†ã‚¹ãƒˆç¨®åˆ¥ | è¨­è¨ˆ | å‚™è€ƒ |
|-----------|------|------|
| å˜ä½“ãƒ†ã‚¹ãƒˆ | âš ï¸ | æ™‚é–“å˜ä½ã®è¡¨è¨˜ä¸ä¸€è‡´ |
| çµåˆãƒ†ã‚¹ãƒˆ | âœ… | å•é¡Œãªã— |
| E2Eãƒ†ã‚¹ãƒˆ | âœ… | å•é¡Œãªã— |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR2-5: ãƒ†ã‚¹ãƒˆä»•æ§˜ã®æ™‚é–“å˜ä½ãŒç§’
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/11-ãƒ†ã‚¹ãƒˆä»•æ§˜.md` (line 17-18, 39-42)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  { speaker: 'stylist', startTime: 0, endTime: 40 },
  ```
- **æ³¨è¨˜**: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®åˆ†æé–¢æ•°ãŒç§’å˜ä½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯å•é¡Œãªã—
- **é‡è¦åº¦**: ä½ï¼ˆR1-13ã¨é–¢é€£ã€ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®

### ãƒ©ã‚¦ãƒ³ãƒ‰2-5: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/10-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è©³ç´°.md`
- **ãƒ¯ãƒ¼ã‚«ãƒ¼**: `supabase/functions/_shared/response.ts`

#### ç¢ºèªçµæœ

| é …ç›® | è¨­è¨ˆ | ãƒ¯ãƒ¼ã‚«ãƒ¼ | å‚™è€ƒ |
|------|------|---------|------|
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³» | âœ… | âœ… | ä¸€è‡´ |
| HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | âœ… | âœ… | ä¸€è‡´ |
| ãƒªãƒˆãƒ©ã‚¤è¨­è¨ˆ | âœ… | âœ… | ä¸€è‡´ |

**å•é¡Œãªã—** âœ…

### ãƒ©ã‚¦ãƒ³ãƒ‰2-6: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸€è²«æ€§ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **UI**: `apps/web/src/components/dashboard/StaffRanking.tsx`
- **UI**: `apps/web/src/components/dashboard/RecentSessions.tsx`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç¢ºèªçµæœ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | DBä¸€è²«æ€§ | å‚™è€ƒ |
|---------------|---------|------|
| StaffRanking | âœ… | é›†è¨ˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºï¼ˆDBç›´æ¥å‚ç…§ãªã—ï¼‰ |
| RecentSessions | âœ… | UIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿ |

**å•é¡Œãªã—** âœ…

---

## ãƒ©ã‚¦ãƒ³ãƒ‰2 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. çŠ¶æ…‹é·ç§»è¨­è¨ˆ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
2. å¤–éƒ¨é€£æºè¨­è¨ˆ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
3. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆè¿½åŠ ï¼‰ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
4. ãƒ†ã‚¹ãƒˆä»•æ§˜ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
6. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ Ã— å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 5ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å†…è¨³ |
|--------|------|------|
| é«˜ | 2 | R2-2, R2-3 |
| ä¸­ | 2 | R2-1, R2-4 |
| ä½/è»½å¾® | 1 | R2-5 |

### å•é¡Œä¸€è¦§

| ID | å•é¡Œ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|---------|--------|-----------|
| R2-1 | ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹åä¸ä¸€è‡´ (FAILED vs error) | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R2-2 | ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤ã„ã‚«ãƒ©ãƒ å | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R2-3 | StaffCard roleå‹ä¸æ­£ | UI | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R2-4 | StaffCard phone/joinedAtä¸è¦ | UI | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R2-5 | ãƒ†ã‚¹ãƒˆä»•æ§˜ã®æ™‚é–“å˜ä½ãŒç§’ | è¨­è¨ˆ | ä½ | ğŸŸ¡ è»½å¾® |

### ãƒ©ã‚¦ãƒ³ãƒ‰2 æ¨å¥¨å¯¾å¿œä¸€è¦§

#### R2-1: ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹åä¸ä¸€è‡´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/05-çŠ¶æ…‹é·ç§»è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```
# çŠ¶æ…‹åã®ä¿®æ­£
- FAILED â†’ error
- è¿½åŠ : analyzing çŠ¶æ…‹

# çŠ¶æ…‹é·ç§»è¡¨ã®æ›´æ–°
| ç¾çŠ¶æ…‹ | ã‚¤ãƒ™ãƒ³ãƒˆ | æ¬¡çŠ¶æ…‹ |
| PROCESSING | analyze_start | ANALYZING |
| ANALYZING | analyze_complete | PROCESSING |
| ANALYZING | analyze_error | ERROR |
```

#### R2-2: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤ã„ã‚«ãƒ©ãƒ å
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/09-å¤–éƒ¨é€£æºè©³ç´°è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```json
// ä¿®æ­£å‰
{
  "goodPoints": ["..."],
  "improvementPoints": ["..."],
  "actionItems": ["..."],
  "transcriptSummary": "...",
  "aiFeedback": "..."
}

// ä¿®æ­£å¾Œ
{
  "summary": "...",
  "strengths": ["..."],
  "improvements": ["..."],
  "metrics": {...},
  "concern_keywords": ["..."]
}
```

#### R2-3: StaffCard roleå‹ä¸æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffCard.tsx`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
role: 'stylist' | 'manager' | 'receptionist';

const roleLabels = {
  stylist: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
  manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
  receptionist: 'ãƒ¬ã‚»ãƒ—ã‚·ãƒ§ãƒ³',
};

// ä¿®æ­£å¾Œ
role: 'stylist' | 'manager' | 'owner' | 'admin';

const roleLabels = {
  stylist: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
  manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
  owner: 'ã‚ªãƒ¼ãƒŠãƒ¼',
  admin: 'ç®¡ç†è€…',
};

const roleColors = {
  stylist: 'bg-indigo-100 text-indigo-700',
  manager: 'bg-purple-100 text-purple-700',
  owner: 'bg-amber-100 text-amber-700',
  admin: 'bg-gray-100 text-gray-700',
};
```

#### R2-4: StaffCard phone/joinedAtä¸è¦
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/components/staff/StaffCard.tsx`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// å‰Šé™¤ã™ã¹ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- phone?: string;
- joinedAt: Date;

// å¯¾å¿œã™ã‚‹UIéƒ¨åˆ†ã‚‚å‰Šé™¤
- é›»è©±ç•ªå·è¡¨ç¤ºéƒ¨åˆ† (line 118-123)
- å…¥ç¤¾æ—¥è¡¨ç¤ºéƒ¨åˆ† (line 124-127)
```

#### R2-5: ãƒ†ã‚¹ãƒˆä»•æ§˜ã®æ™‚é–“å˜ä½ãŒç§’
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/11-ãƒ†ã‚¹ãƒˆä»•æ§˜.md`
**æ¨å¥¨å¯¾å¿œ**: ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼ˆä»»æ„ï¼‰
```typescript
// å˜ä½“ãƒ†ã‚¹ãƒˆã§ã¯ç§’å˜ä½ã‚’ä½¿ç”¨
// æ³¨: åˆ†æé–¢æ•°ã¯å†…éƒ¨ã§ç§’å˜ä½ã€DBã¸ã®ä¿å­˜æ™‚ã«mså¤‰æ›
const segments = [
  { speaker: 'stylist', startTime: 0, endTime: 40 },  // ç§’å˜ä½
];
```

---

## ãƒ©ã‚¦ãƒ³ãƒ‰3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆãƒ»Edge Functionsæ¤œè¨¼

èª¿æŸ»æ—¥æ™‚: 2025-12-05

### ãƒ©ã‚¦ãƒ³ãƒ‰3-1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆã®æ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç¢ºèªçµæœ

**âœ… å…¨ã¦ä¸€è‡´ - è¨­è¨ˆæ›¸ã¯2025-12-05ã«æ›´æ–°æ¸ˆã¿**

| ãƒ†ãƒ¼ãƒ–ãƒ« | è¨­è¨ˆ | DB | å‚™è€ƒ |
|---------|------|-----|------|
| salons | âœ… | âœ… | plan_typeå«ã‚€ |
| staffs | âœ… | âœ… | id=auth.users(id)æ§‹é€  |
| sessions | âœ… | âœ… | diarization_statuså«ã‚€ |
| transcripts | âœ… | âœ… | start_time_ms/end_time_ms |
| speaker_segments | âœ… | âœ… | start_time_ms/end_time_ms |
| session_analyses | âœ… | âœ… | æ­£è¦åŒ–ã‚¹ã‚­ãƒ¼ãƒ |
| session_reports | âœ… | âœ… | summary/strengths/improvements |
| success_cases | âœ… | âœ… | approach_text/result/is_active |
| training_scenarios | âœ… | âœ… | title/difficulty |
| roleplay_sessions | âœ… | âœ… | messages/ended_at |

**å•é¡Œãªã—** âœ…

### ãƒ©ã‚¦ãƒ³ãƒ‰3-2: Edge Functionså®Ÿè£…æ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `supabase/functions/create-session/index.ts`
- `supabase/functions/generate-report/index.ts`
- `supabase/functions/roleplay-chat/index.ts`

#### ç¢ºèªçµæœ

| Edge Function | å®Ÿè£… | DBä¸€è‡´ | å‚™è€ƒ |
|--------------|------|--------|------|
| create-session | âœ… | âœ… | status='recording'æ­£ã—ãä½¿ç”¨ |
| generate-report | âœ… | âœ… | summary/strengths/improvementsæ­£ã—ãä½¿ç”¨ |
| roleplay-chat | âœ… | âœ… | messagesæ­£ã—ãä½¿ç”¨ |
| process-audio | âœ… | âœ… | start_time_msæ­£ã—ãä½¿ç”¨ |
| diarization-callback | âœ… | âœ… | start_time_msæ­£ã—ãä½¿ç”¨ |

**å•é¡Œãªã—** âœ…

### ãƒ©ã‚¦ãƒ³ãƒ‰3-3: ä»˜éŒ²ãƒ»ç’°å¢ƒå¤‰æ•°ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/12-ä»˜éŒ².md`
- **å®Ÿè£…**: `supabase/functions/*/index.ts`

#### ç¢ºèªçµæœ

| ç’°å¢ƒå¤‰æ•° | è¨­è¨ˆ | å®Ÿè£… | å‚™è€ƒ |
|---------|------|------|------|
| SUPABASE_URL | âœ… | âœ… | å…¨Functionsã§ä½¿ç”¨ |
| SUPABASE_ANON_KEY | âœ… | âœ… | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèªè¨¼ |
| SUPABASE_SERVICE_ROLE_KEY | âœ… | âœ… | Adminæ“ä½œ |
| ANTHROPIC_API_KEY | âœ… | âœ… | Claude API |
| OPENAI_API_KEY | âœ… | - | æœªå®Ÿè£…ï¼ˆEmbeddingç”¨ï¼‰ |
| PYANNOTE_SERVER_URL | âœ… | âœ… | è©±è€…åˆ†é›¢ |
| PYANNOTE_API_KEY | âœ… | âœ… | è©±è€…åˆ†é›¢èªè¨¼ |
| PYANNOTE_CALLBACK_SECRET | âœ… | âœ… | Callbackèªè¨¼ |

**å•é¡Œãªã—** âœ…

---

## ãƒ©ã‚¦ãƒ³ãƒ‰3 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆæ›¸ Ã— DBå®Ÿè£…
2. Edge Functions Ã— DBå®Ÿè£…
3. ä»˜éŒ²ãƒ»ç’°å¢ƒå¤‰æ•° Ã— å®Ÿè£…

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 0ä»¶

**è‰¯å¥½ãªçŠ¶æ…‹** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆæ›¸ã¨Edge Functionsã®å®Ÿè£…ã¯å®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚

---

## å•é¡Œã®çµ±åˆãƒ»é‡è¤‡æ•´ç†

### é‡è¤‡å•é¡Œã®çµ±åˆ

ä»¥ä¸‹ã®å•é¡Œã¯åŒä¸€ã¾ãŸã¯é¡ä¼¼ã®ãŸã‚ã€çµ±åˆã—ã¦å¯¾å¿œã™ã‚‹ã“ã¨ã‚’æ¨å¥¨:

#### UI roleå‹ä¸æ­£ï¼ˆR1-6 + R2-3 çµ±åˆï¼‰
**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `apps/web/src/components/staff/StaffForm.tsx`
- `apps/web/src/components/staff/StaffCard.tsx`

**å…±é€šã®å•é¡Œ**:
- `'stylist' | 'manager' | 'receptionist'` ã‚’ä½¿ç”¨
- æ­£ã—ãã¯ `'stylist' | 'manager' | 'owner' | 'admin'`

**çµ±åˆæ¨å¥¨å¯¾å¿œ**:
1. å…±é€šã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. å…¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…±é€šå‹ã‚’ä½¿ç”¨
```typescript
// apps/web/src/types/staff.ts
export type StaffRole = 'stylist' | 'manager' | 'owner' | 'admin';

export const roleLabels: Record<StaffRole, string> = {
  stylist: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
  manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
  owner: 'ã‚ªãƒ¼ãƒŠãƒ¼',
  admin: 'ç®¡ç†è€…',
};
```

#### ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå¤ã„ã‚«ãƒ©ãƒ åï¼ˆR1-11 + R2-2 çµ±åˆï¼‰
**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/09-å¤–éƒ¨é€£æºè©³ç´°è¨­è¨ˆ.md`

**å…±é€šã®å•é¡Œ**:
- `goodPoints`, `improvementPoints`, `actionItems` ç­‰ã®å¤ã„åç§°
- æ­£ã—ãã¯ `summary`, `strengths`, `improvements`, `metrics`

**çµ±åˆæ¨å¥¨å¯¾å¿œ**:
ä¸¡æ–¹ã®è¨­è¨ˆæ›¸ã§ä»¥ä¸‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã«çµ±ä¸€:
```typescript
interface SessionReportResponse {
  summary: string;
  overall_score: number;
  strengths: string[];
  improvements: string[];
  metrics: Record<string, IndicatorScore>;
  concern_keywords: string[];
}
```

---

## ãƒ©ã‚¦ãƒ³ãƒ‰4: ã‚¯ãƒ©ã‚¹è¨­è¨ˆæ›¸è©³ç´°èª¿æŸ»

èª¿æŸ»æ—¥æ™‚: 2025-12-05

### ãƒ©ã‚¦ãƒ³ãƒ‰4-1: Salonã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 189-217)
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR4-1: Planå‹ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 189-217)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  const planFeatures: Record<Plan, PlanFeatures> = {
    standard: {...},
    professional: {...},  // âŒ
    enterprise: {...},
  };
  ```
- **DB**: `'free' | 'standard' | 'premium' | 'enterprise'`
- **å•é¡Œç‚¹**:
  - 'professional' â†’ DB ã§ã¯ 'premium'
  - 'free' ãŒè¨­è¨ˆæ›¸ã«ãªã„
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰4-2: Staffã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 362-367)
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR4-2: Staff role 'assistant'ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 362-367)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  const rolePermissions = {
    owner: [...],
    manager: [...],
    stylist: [...],
    assistant: [...],  // âŒ
  };
  ```
- **DB**: `'owner' | 'manager' | 'stylist' | 'admin'`
- **é‡è¦åº¦**: ä¸­ï¼ˆR1-8ã¨åŒé¡ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰4-3: Sessionã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 478-482)
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR4-3: Session status 'failed'ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 478-482)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  fail(session: Session): Partial<Session> {
    return {
      status: 'failed',  // âŒ
    };
  }
  ```
- **DB**: `'recording' | 'processing' | 'analyzing' | 'completed' | 'error'`
- **é‡è¦åº¦**: ä¸­ï¼ˆR2-1ã¨åŒé¡ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰4-4: SpeakerSegmentã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 616-625)
- **DB**: `supabase/migrations/00000000000000_initial_schema.sql`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR4-4: SpeakerSegment chunk_indexæ¬ è½
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md` (line 616-625)
- **è¨­è¨ˆæ›¸**:
  ```typescript
  export interface SpeakerSegment {
    readonly id: SpeakerSegmentId;
    readonly sessionId: SessionId;
    readonly speaker: Speaker;
    readonly startTime: number;  // âŒ startTimeMs
    readonly endTime: number;    // âŒ endTimeMs
    readonly text: string | null;
    readonly confidence: number | null;
    readonly createdAt: Date;
    // âŒ chunk_index ãŒæ¬ è½
  }
  ```
- **DB**: `chunk_index INTEGER NOT NULL` ãŒå­˜åœ¨
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰4-5: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ç¢ºèª

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- **è¨­è¨ˆ**: `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md` (line 368-369)
- **DB**: RLSãƒãƒªã‚·ãƒ¼

#### ç¢ºèªçµæœ

**æ—¢çŸ¥ã®å•é¡Œï¼ˆR1-4ï¼‰ã®ã¿**: `auth_user_id` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç®‡æ‰€

**å•é¡Œãªã—**: ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹é·ç§»ã¯æ­£ã—ã `'recording' â†’ 'processing' â†’ 'completed'` ã‚’ä½¿ç”¨

---

## ãƒ©ã‚¦ãƒ³ãƒ‰4 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. Salonã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ Ã— DB
2. Staffã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ Ã— DB
3. Sessionã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ Ã— DB
4. SpeakerSegmentã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ Ã— DB
5. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ Ã— DB
6. ã‚¯ãƒ©ã‚¹è¨­è¨ˆå…¨ä½“ Ã— DB

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 4ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å†…è¨³ |
|--------|------|------|
| é«˜ | 1 | R4-1 |
| ä¸­ | 3 | R4-2, R4-3, R4-4 |

### å•é¡Œä¸€è¦§

| ID | å•é¡Œ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|---------|--------|-----------|
| R4-1 | Planå‹ professionalâ†’premium, freeæ¬ è½ | è¨­è¨ˆ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R4-2 | Staff role assistantâ†’admin | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R4-3 | Session status failedâ†’error | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |
| R4-4 | SpeakerSegment chunk_indexæ¬ è½ | è¨­è¨ˆ | ä¸­ | ğŸ”´ æœªä¿®æ­£ |

### ãƒ©ã‚¦ãƒ³ãƒ‰4 æ¨å¥¨å¯¾å¿œä¸€è¦§

#### R4-1: Planå‹ä¸æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
type Plan = 'standard' | 'professional' | 'enterprise';

// ä¿®æ­£å¾Œ
type Plan = 'free' | 'standard' | 'premium' | 'enterprise';

const planFeatures: Record<Plan, PlanFeatures> = {
  free: {
    aiAnalysis: true,
    realtimeAssist: false,
    report: true,
    training: false,
    apiAccess: false,
    maxSessions: 30,
    maxStaff: 3,
  },
  standard: {...},
  premium: {...},  // æ—§professional
  enterprise: {...},
};
```

#### R4-2: Staff role assistantâ†’admin
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
const rolePermissions = {
  assistant: [...],  // âŒ
};

// ä¿®æ­£å¾Œ
const rolePermissions = {
  admin: [...],  // âœ…
};
```

#### R4-3: Session status failedâ†’error
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å‰
fail(session: Session): Partial<Session> {
  return { status: 'failed' };  // âŒ
}

// ä¿®æ­£å¾Œ
fail(session: Session): Partial<Session> {
  return { status: 'error' };  // âœ…
}
```

#### R4-4: SpeakerSegment chunk_indexæ¬ è½
**ãƒ•ã‚¡ã‚¤ãƒ«**: `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
export interface SpeakerSegment {
  readonly id: SpeakerSegmentId;
  readonly sessionId: SessionId;
  readonly chunkIndex: number;  // è¿½åŠ 
  readonly speaker: Speaker;
  readonly startTimeMs: number;  // ç§’â†’ãƒŸãƒªç§’
  readonly endTimeMs: number;    // ç§’â†’ãƒŸãƒªç§’
  readonly text: string | null;
  readonly confidence: number | null;
  readonly createdAt: Date;
}
```

---

## ç´¯ç©å•é¡Œçµ±è¨ˆ

### ãƒ©ã‚¦ãƒ³ãƒ‰1-4 åˆè¨ˆ

| é‡è¦åº¦ | ãƒ©ã‚¦ãƒ³ãƒ‰1 | ãƒ©ã‚¦ãƒ³ãƒ‰2 | ãƒ©ã‚¦ãƒ³ãƒ‰3 | ãƒ©ã‚¦ãƒ³ãƒ‰4 | åˆè¨ˆ |
|--------|----------|----------|----------|----------|------|
| é«˜ | 4 | 2 | 0 | 1 | 7 |
| ä¸­ | 5 | 2 | 0 | 3 | 10 |
| ä½/è»½å¾® | 4 | 1 | 0 | 0 | 5 |
| **åˆè¨ˆ** | 13 | 5 | 0 | 4 | **22** |

### é¡ä¼¼å•é¡Œã®çµ±åˆå¾Œ

é‡è¤‡ã‚’çµ±åˆã™ã‚‹ã¨ã€å®Ÿè³ªçš„ãªå•é¡Œæ•°:
- **UI roleå‹ä¸æ­£**: R1-6 + R2-3 â†’ 1ä»¶
- **è¨­è¨ˆæ›¸ roleå‹ä¸æ­£**: R1-8 + R4-2 â†’ 1ä»¶
- **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚«ãƒ©ãƒ å**: R1-11 + R2-2 â†’ 1ä»¶
- **Session statuså**: R2-1 + R4-3 â†’ 1ä»¶
- **æ™‚é–“å˜ä½ä¸ä¸€è‡´**: R1-2 + R1-3 + R2-5 â†’ 1ä»¶

**çµ±åˆå¾Œå®Ÿè³ªå•é¡Œæ•°: ç´„15ä»¶**

---

## ãƒ©ã‚¦ãƒ³ãƒ‰5: è¿½åŠ Edge Functionsèª¿æŸ»

èª¿æŸ»æ—¥æ™‚: 2025-12-05

### ãƒ©ã‚¦ãƒ³ãƒ‰5-1: analyze-segmentæ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `supabase/functions/analyze-segment/index.ts`

#### ç¢ºèªçµæœ

| é …ç›® | å®Ÿè£… | DBä¸€è‡´ | å‚™è€ƒ |
|------|------|--------|------|
| TranscriptSegment.start_time_ms | âœ… | âœ… | ãƒŸãƒªç§’ä½¿ç”¨ |
| SpeakerSegment.chunk_index | âœ… | âœ… | chunk_indexå«ã‚€ |
| indicator_typeå€¤ | âœ… | âœ… | talk_ratioç­‰æ­£ã—ã„ |
| session_analysesã¸ã®INSERT | âœ… | âœ… | æ­£ã—ã„ã‚«ãƒ©ãƒ å |

**å•é¡Œãªã—** âœ…

### ãƒ©ã‚¦ãƒ³ãƒ‰5-2: end-sessionæ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `supabase/functions/end-session/index.ts`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR5-1: sessions.total_duration_msã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/end-session/index.ts` (line 58)
- **ãƒ¯ãƒ¼ã‚«ãƒ¼å®Ÿè£…**:
  ```typescript
  .update({
    status: 'processing',
    ended_at: endedAt.toISOString(),
    total_duration_ms: totalDurationMs,  // âŒ ã“ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
    updated_at: endedAt.toISOString(),
  })
  ```
- **DB sessions ãƒ†ãƒ¼ãƒ–ãƒ«**: `total_duration_ms` ã‚«ãƒ©ãƒ ãªã—
- **é‡è¦åº¦**: é«˜ï¼ˆãƒã‚°ï¼šæ›´æ–°ãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ï¼‰
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰5-3: search-success-casesæ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `supabase/functions/search-success-cases/index.ts`

#### ç¢ºèªçµæœ

| é …ç›® | å®Ÿè£… | DBä¸€è‡´ | å‚™è€ƒ |
|------|------|--------|------|
| RPC search_success_cases | âœ… | âœ… | æ­£ã—ãä½¿ç”¨ |
| concern_keywords | âœ… | âœ… | æ­£ã—ã„ã‚«ãƒ©ãƒ å |
| approach_text | âœ… | âœ… | æ­£ã—ã„ã‚«ãƒ©ãƒ å |

**å•é¡Œãªã—** âœ…

### ãƒ©ã‚¦ãƒ³ãƒ‰5-4: start-roleplayæ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `supabase/functions/start-roleplay/index.ts`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR5-2: training_scenarios.categoryã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã—ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/start-roleplay/index.ts` (line 31, 135)
- **ãƒ¯ãƒ¼ã‚«ãƒ¼å®Ÿè£…**:
  ```typescript
  interface TrainingScenario {
    category: string;  // âŒ DBã«å­˜åœ¨ã—ãªã„
  }

  category: scenarioData.category || 'general',
  ```
- **DB training_scenarios ãƒ†ãƒ¼ãƒ–ãƒ«**: `category` ã‚«ãƒ©ãƒ ãªã—
- **å½±éŸ¿**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤'general'ã§å‹•ä½œã™ã‚‹ãŸã‚æ©Ÿèƒ½ä¸Šã®å•é¡Œã¯ãªã„ãŒã€è¨­è¨ˆãŒä¸ä¸€è‡´
- **é‡è¦åº¦**: ä½
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ è»½å¾®

---

## ãƒ©ã‚¦ãƒ³ãƒ‰5 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. analyze-segment Ã— DB
2. end-session Ã— DB
3. search-success-cases Ã— DB
4. start-roleplay Ã— DB

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 2ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å†…è¨³ |
|--------|------|------|
| é«˜ | 1 | R5-1 |
| ä½/è»½å¾® | 1 | R5-2 |

### å•é¡Œä¸€è¦§

| ID | å•é¡Œ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|---------|--------|-----------|
| R5-1 | end-session total_duration_msä¸å­˜åœ¨ | ãƒ¯ãƒ¼ã‚«ãƒ¼ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R5-2 | start-roleplay categoryä¸å­˜åœ¨ | ãƒ¯ãƒ¼ã‚«ãƒ¼ | ä½ | ğŸŸ¡ è»½å¾® |

### ãƒ©ã‚¦ãƒ³ãƒ‰5 æ¨å¥¨å¯¾å¿œä¸€è¦§

#### R5-1: end-session total_duration_msä¸å­˜åœ¨ï¼ˆé‡è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/end-session/index.ts`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤ï¼ˆæ¨å¥¨ï¼‰
.update({
  status: 'processing',
  ended_at: endedAt.toISOString(),
  // total_duration_ms ã‚’å‰Šé™¤
  updated_at: endedAt.toISOString(),
})

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: DBã«ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
// ALTER TABLE sessions ADD COLUMN total_duration_ms INTEGER;
```

#### R5-2: start-roleplay categoryä¸å­˜åœ¨
**ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/functions/start-roleplay/index.ts`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰categoryã‚’å‰Šé™¤ï¼ˆAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯å«ã‚ãªã„ï¼‰
interface TrainingScenario {
  id: string;
  title: string;
  description: string;
  difficulty: string;
  // category: string;  // å‰Šé™¤
  estimatedMinutes: number;
  objectives: string[];
  customerPersona: CustomerPersona;
  initialMessage?: string;
}

// ã¾ãŸã¯ã€DBã«ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯:
// ALTER TABLE training_scenarios ADD COLUMN category TEXT DEFAULT 'general';
```

---

## ç´¯ç©å•é¡Œçµ±è¨ˆï¼ˆæ›´æ–°ï¼‰

### ãƒ©ã‚¦ãƒ³ãƒ‰1-5 åˆè¨ˆ

| é‡è¦åº¦ | R1 | R2 | R3 | R4 | R5 | åˆè¨ˆ |
|--------|-----|-----|-----|-----|-----|------|
| é«˜ | 4 | 2 | 0 | 1 | 1 | 8 |
| ä¸­ | 5 | 2 | 0 | 3 | 0 | 10 |
| ä½/è»½å¾® | 4 | 1 | 0 | 0 | 1 | 6 |
| **åˆè¨ˆ** | 13 | 5 | 0 | 4 | 2 | **24** |

---

## ãƒ©ã‚¦ãƒ³ãƒ‰6: sharedå‹å®šç¾©ãƒ»hooksèª¿æŸ»

èª¿æŸ»æ—¥æ™‚: 2025-12-05

### ãƒ©ã‚¦ãƒ³ãƒ‰6-1: database.tså‹å®šç¾©æ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `apps/web/src/types/database.ts`
- `supabase/migrations/00000000000000_initial_schema.sql`

#### ç¢ºèªçµæœ

| ãƒ†ãƒ¼ãƒ–ãƒ« | å‹å®šç¾© | DBä¸€è‡´ | å‚™è€ƒ |
|---------|--------|--------|------|
| salons | âœ… | âœ… | æ­£ã—ã„ |
| staffs | âœ… | âœ… | roleå‹æ­£ã—ã„ |
| sessions | âš ï¸ | âš ï¸ | total_duration_mså•é¡Œ |
| speaker_segments | âœ… | âœ… | chunk_indexå«ã‚€ |
| transcripts | âœ… | âœ… | start_time_ms/end_time_msæ­£ã—ã„ |
| session_analyses | âœ… | âœ… | indicator_typeæ­£ã—ã„ |
| session_reports | âœ… | âœ… | æ­£ã—ã„ã‚«ãƒ©ãƒ å |
| success_cases | âœ… | âœ… | approach_text/resultæ­£ã—ã„ |
| training_scenarios | âœ… | âœ… | categoryæ¬ è½ã ãŒDBåŒæ§˜ |
| roleplay_sessions | âœ… | âœ… | messagesæ­£ã—ã„ |

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR6-1: database.ts sessions.total_duration_msãŒDBã«ãªã„
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts` (line 95, 108, 121)
- **å‹å®šç¾©**: `total_duration_ms: number | null;`
- **DB**: ã“ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **é–¢é€£**: R5-1ã¨åŒã˜å•é¡Œï¼ˆå‹å®šç¾©å´ï¼‰
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰6-2: useStaff hookæ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `apps/web/src/hooks/useStaff.ts`
- `supabase/migrations/00000000000000_initial_schema.sql`

#### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

##### å•é¡ŒR6-2: useStaff StaffMember roleå‹ãŒä¸æ­£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/hooks/useStaff.ts` (line 14, 25)
- **UIå®Ÿè£…**:
  ```typescript
  interface StaffMember {
    role: 'stylist' | 'manager' | 'receptionist';  // âŒ
  }

  interface StaffFilters {
    role?: 'stylist' | 'manager' | 'receptionist';  // âŒ
  }
  ```
- **DB**: `'stylist' | 'manager' | 'owner' | 'admin'`
- **é–¢é€£**: R1-6, R2-3ã¨åŒé¡ã®å•é¡Œï¼ˆ3ç®‡æ‰€ç›®ï¼‰
- **é‡è¦åº¦**: é«˜
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

##### å•é¡ŒR6-3: useStaff StaffMemberä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/hooks/useStaff.ts` (line 13, 20)
- **UIå®Ÿè£…**:
  ```typescript
  interface StaffMember {
    phone?: string;     // âŒ DBã«ãªã„
    joinedAt: Date;     // âŒ DBã«ãªã„
  }
  ```
- **DB staffs ãƒ†ãƒ¼ãƒ–ãƒ«**: ã“ã‚Œã‚‰ã®ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„
- **é–¢é€£**: R1-7, R2-4ã¨åŒé¡ã®å•é¡Œ
- **é‡è¦åº¦**: ä¸­
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”´ æœªä¿®æ­£

### ãƒ©ã‚¦ãƒ³ãƒ‰6-3: useAuth hookæ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `apps/web/src/hooks/useAuth.ts`

#### ç¢ºèªçµæœ

| é …ç›® | å®Ÿè£… | DBä¸€è‡´ | å‚™è€ƒ |
|------|------|--------|------|
| staffs.idã§ã®ã‚¯ã‚¨ãƒª | âœ… | âœ… | `.eq('id', authUser.id)`æ­£ã—ã„ |
| roleå‹ | âš ï¸ | - | stringã§ç·©ã„å‹å®šç¾© |
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‚ç…§ | âœ… | âœ… | æ­£ã—ã„ã‚«ãƒ©ãƒ åä½¿ç”¨ |

**ç‰¹ã«å•é¡Œãªã—** âœ…

### ãƒ©ã‚¦ãƒ³ãƒ‰6-4: packages/sharedå‹å®šç¾©æ¤œè¨¼

#### ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
- `packages/shared/src/types/index.ts`

#### ç¢ºèªçµæœ

| APIå‹ | å®šç¾© | å‚™è€ƒ |
|-------|------|------|
| EndSessionResponse | âš ï¸ | totalDurationMså«ã‚€ï¼ˆR5-1é–¢é€£ï¼‰ |
| TranscriptionChunk | âœ… | startTimeMs/endTimeMsæ­£ã—ã„ |
| DiarizationSegment | âœ… | startTimeMs/endTimeMsæ­£ã—ã„ |
| AnalyzeConversationRequest | âœ… | speakerå‹æ­£ã—ã„ |

---

## ãƒ©ã‚¦ãƒ³ãƒ‰6 èª¿æŸ»å®Œäº†ã‚µãƒãƒªãƒ¼

### èª¿æŸ»æ—¥æ™‚
2025-12-05

### èª¿æŸ»ç¯„å›²
1. database.tså‹å®šç¾© Ã— DB
2. useStaff hook Ã— DB
3. useAuth hook Ã— DB
4. packages/sharedå‹å®šç¾© Ã— DB

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•°: 3ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å†…è¨³ |
|--------|------|------|
| é«˜ | 2 | R6-1, R6-2 |
| ä¸­ | 1 | R6-3 |

### å•é¡Œä¸€è¦§

| ID | å•é¡Œ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ | é‡è¦åº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|---------|--------|-----------|
| R6-1 | database.ts sessions.total_duration_msä¸å­˜åœ¨ | UIå‹ | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R6-2 | useStaff roleå‹ä¸æ­£ | UI hook | é«˜ | ğŸ”´ æœªä¿®æ­£ |
| R6-3 | useStaff phone/joinedAtä¸è¦ | UI hook | ä¸­ | ğŸ”´ æœªä¿®æ­£ |

### ãƒ©ã‚¦ãƒ³ãƒ‰6 æ¨å¥¨å¯¾å¿œä¸€è¦§

#### R6-1: database.ts sessions.total_duration_msä¸å­˜åœ¨
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/types/database.ts`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: å‹å®šç¾©ã‹ã‚‰å‰Šé™¤
sessions: {
  Row: {
    // total_duration_ms: number | null;  // å‰Šé™¤
  };
}

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: DBã«ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆR5-1ã¨åˆã‚ã›ã¦å¯¾å¿œï¼‰
// ALTER TABLE sessions ADD COLUMN total_duration_ms INTEGER;
```

#### R6-2: useStaff roleå‹ä¸æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/hooks/useStaff.ts`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
// å…±é€šå‹å®šç¾©ã‚’ä½œæˆã—ã¦ä½¿ç”¨
import { StaffRole } from '@/types/database';

interface StaffMember {
  role: 'stylist' | 'manager' | 'owner' | 'admin';  // âœ…
}

interface StaffFilters {
  role?: 'stylist' | 'manager' | 'owner' | 'admin';  // âœ…
}
```

#### R6-3: useStaff phone/joinedAtä¸è¦
**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/hooks/useStaff.ts`
**æ¨å¥¨å¯¾å¿œ**:
```typescript
interface StaffMember {
  // phone?: string;  // å‰Šé™¤
  // joinedAt: Date;  // å‰Šé™¤
  createdAt: Date;   // DBã®created_atã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
}
```

---

## ç´¯ç©å•é¡Œçµ±è¨ˆï¼ˆæ›´æ–°ï¼‰

### ãƒ©ã‚¦ãƒ³ãƒ‰1-6 åˆè¨ˆ

| é‡è¦åº¦ | R1 | R2 | R3 | R4 | R5 | R6 | åˆè¨ˆ |
|--------|-----|-----|-----|-----|-----|-----|------|
| é«˜ | 4 | 2 | 0 | 1 | 1 | 2 | 10 |
| ä¸­ | 5 | 2 | 0 | 3 | 0 | 1 | 11 |
| ä½/è»½å¾® | 4 | 1 | 0 | 0 | 1 | 0 | 6 |
| **åˆè¨ˆ** | 13 | 5 | 0 | 4 | 2 | 3 | **27** |

### é¡ä¼¼å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆæ›´æ–°ï¼‰

| ã‚°ãƒ«ãƒ¼ãƒ— | å•é¡ŒID | å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«æ•° |
|---------|--------|--------------|
| roleå‹ä¸æ­£ | R1-6, R2-3, R1-8, R4-2, R6-2 | 4 |
| phone/joinedAtä¸è¦ | R1-7, R2-4, R1-9, R6-3 | 3 |
| total_duration_msä¸å­˜åœ¨ | R5-1, R6-1 | 2 |
| ãƒ¬ãƒãƒ¼ãƒˆã‚«ãƒ©ãƒ å | R1-11, R2-2 | 2 |
| Session statuså | R2-1, R4-3 | 2 |
| æ™‚é–“å˜ä½ | R1-2, R1-3, R2-5 | 3 |

---

# æœ€çµ‚èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

## èª¿æŸ»å®Œäº†

èª¿æŸ»æ—¥æ™‚: 2025-12-05
èª¿æŸ»ãƒ©ã‚¦ãƒ³ãƒ‰: 6ãƒ©ã‚¦ãƒ³ãƒ‰

## ç™ºè¦‹å•é¡Œç·æ•°: 27ä»¶

| é‡è¦åº¦ | ä»¶æ•° | å‰²åˆ |
|--------|------|------|
| é«˜ | 10 | 37% |
| ä¸­ | 11 | 41% |
| ä½/è»½å¾® | 6 | 22% |

## çµ±åˆå¾Œãƒ¦ãƒ‹ãƒ¼ã‚¯å•é¡Œæ•°: 15ä»¶

é¡ä¼¼ãƒ»é‡è¤‡å•é¡Œã‚’çµ±åˆã™ã‚‹ã¨ã€å®Ÿè³ªçš„ã«å¯¾å¿œã™ã¹ãå•é¡Œã¯15ä»¶ã§ã™ã€‚

---

## å…¨å•é¡Œä¸€è¦§ã¨æ¨å¥¨å¯¾å¿œ

### ğŸ”´ é«˜é‡è¦åº¦å•é¡Œï¼ˆ10ä»¶â†’çµ±åˆå¾Œ6ä»¶ï¼‰

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—1: Staff roleå‹ä¸æ­£ï¼ˆ5å•é¡Œâ†’1å¯¾å¿œï¼‰
**å•é¡ŒID**: R1-6, R2-3, R1-8, R4-2, R6-2

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `apps/web/src/components/staff/StaffForm.tsx`
- `apps/web/src/components/staff/StaffCard.tsx`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
- `apps/web/src/hooks/useStaff.ts`

**å•é¡Œå†…å®¹**:
- 'receptionist' ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€DBã¯ 'owner'/'admin' ã‚’ä½¿ç”¨
- 'assistant' ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€DBã¯ 'admin' ã‚’ä½¿ç”¨

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// 1. å…±é€šå‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
// apps/web/src/types/staff.ts
export type StaffRole = 'stylist' | 'manager' | 'owner' | 'admin';

export const roleLabels: Record<StaffRole, string> = {
  stylist: 'ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ',
  manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
  owner: 'ã‚ªãƒ¼ãƒŠãƒ¼',
  admin: 'ç®¡ç†è€…',
};

export const roleColors: Record<StaffRole, string> = {
  stylist: 'bg-indigo-100 text-indigo-700',
  manager: 'bg-purple-100 text-purple-700',
  owner: 'bg-amber-100 text-amber-700',
  admin: 'bg-gray-100 text-gray-700',
};

// 2. å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ã“ã®å…±é€šå‹ã‚’ä½¿ç”¨
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—2: sessions.total_duration_msä¸å­˜åœ¨ï¼ˆ2å•é¡Œâ†’1å¯¾å¿œï¼‰
**å•é¡ŒID**: R5-1, R6-1

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `supabase/functions/end-session/index.ts`
- `apps/web/src/types/database.ts`

**å•é¡Œå†…å®¹**:
- ãƒ¯ãƒ¼ã‚«ãƒ¼ã¨å‹å®šç¾©ã« `total_duration_ms` ãŒã‚ã‚‹ãŒã€DBã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ãªã„
- æ›´æ–°ãŒå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ï¼ˆé‡å¤§ãªãƒã‚°ï¼‰

**æ¨å¥¨å¯¾å¿œ**:
```sql
-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: DBã«ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆæ¨å¥¨ï¼‰
ALTER TABLE sessions ADD COLUMN total_duration_ms INTEGER;

-- ã¾ãŸã¯

-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: å‹å®šç¾©ã¨ãƒ¯ãƒ¼ã‚«ãƒ¼ã‹ã‚‰å‰Šé™¤
-- end-session/index.ts ã‹ã‚‰ total_duration_ms ã‚’å‰Šé™¤
-- database.ts ã‹ã‚‰ total_duration_ms ã‚’å‰Šé™¤
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—3: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã§å¤ã„ã‚«ãƒ©ãƒ åä½¿ç”¨ï¼ˆ2å•é¡Œâ†’1å¯¾å¿œï¼‰
**å•é¡ŒID**: R1-11, R2-2

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/03-APIè©³ç´°ä»•æ§˜.md`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/09-å¤–éƒ¨é€£æºè©³ç´°è¨­è¨ˆ.md`

**å•é¡Œå†…å®¹**:
- `goodPoints`, `improvementPoints`, `actionItems` ã‚’ä½¿ç”¨
- æ­£ã—ãã¯ `summary`, `strengths`, `improvements`, `metrics`

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¸¡è¨­è¨ˆæ›¸ã§ä»¥ä¸‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã«çµ±ä¸€
interface SessionReportResponse {
  summary: string;
  overall_score: number;
  strengths: string[];
  improvements: string[];
  metrics: Record<string, IndicatorScore>;
  concern_keywords: string[];
  proposal_timing_ms: number | null;
  is_converted: boolean | null;
}
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—4: Planå‹ãŒä¸æ­£
**å•é¡ŒID**: R4-1

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`

**å•é¡Œå†…å®¹**:
- 'professional' ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€DBã¯ 'premium'
- 'free' ãƒ—ãƒ©ãƒ³ãŒè¨­è¨ˆæ›¸ã«ãªã„

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ä¿®æ­£å¾Œ
type Plan = 'free' | 'standard' | 'premium' | 'enterprise';

const planFeatures: Record<Plan, PlanFeatures> = {
  free: {
    aiAnalysis: true,
    realtimeAssist: false,
    report: true,
    training: false,
    apiAccess: false,
    maxSessions: 30,
    maxStaff: 3,
  },
  standard: {...},
  premium: {...},  // æ—§professional
  enterprise: {...},
};
```

---

### ğŸŸ  ä¸­é‡è¦åº¦å•é¡Œï¼ˆ11ä»¶â†’çµ±åˆå¾Œ5ä»¶ï¼‰

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—5: phone/joinedAt/positionãŒDBã«å­˜åœ¨ã—ãªã„ï¼ˆ4å•é¡Œâ†’1å¯¾å¿œï¼‰
**å•é¡ŒID**: R1-7, R2-4, R1-9, R6-3

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `apps/web/src/components/staff/StaffForm.tsx`
- `apps/web/src/components/staff/StaffCard.tsx`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/08-ç”»é¢é …ç›®è©³ç´°å®šç¾©.md`
- `apps/web/src/hooks/useStaff.ts`

**å•é¡Œå†…å®¹**:
- `phone`, `joinedAt`, `position` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒUIã«ã‚ã‚‹ãŒã€DBã«ã¯å­˜åœ¨ã—ãªã„

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤
// - phone?: string;      // å‰Šé™¤
// - joinedAt: Date;      // å‰Šé™¤ï¼ˆcreated_atã‚’ä½¿ç”¨ï¼‰
// - position: string;    // å‰Šé™¤

// å…¥ç¤¾æ—¥ãŒå¿…è¦ãªå ´åˆã¯DBã«ã‚«ãƒ©ãƒ è¿½åŠ ã‚’æ¤œè¨:
// ALTER TABLE staffs ADD COLUMN join_date DATE;
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—6: Session statusåã®ä¸ä¸€è‡´ï¼ˆ2å•é¡Œâ†’1å¯¾å¿œï¼‰
**å•é¡ŒID**: R2-1, R4-3

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/05-çŠ¶æ…‹é·ç§»è¨­è¨ˆ.md`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`

**å•é¡Œå†…å®¹**:
- 'FAILED' / 'failed' ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€DBã¯ 'error'
- 'analyzing' çŠ¶æ…‹ãŒè¨­è¨ˆæ›¸ã«ãªã„

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// è¨­è¨ˆæ›¸ã‚’ä¿®æ­£
type SessionStatus = 'recording' | 'processing' | 'analyzing' | 'completed' | 'error';

// fail()ãƒ¡ã‚½ãƒƒãƒ‰ã®æˆ»ã‚Šå€¤
fail(session: Session): Partial<Session> {
  return { status: 'error' };  // 'failed' â†’ 'error'
}
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—7: SpeakerSegment chunk_indexæ¬ è½
**å•é¡ŒID**: R4-4

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`

**å•é¡Œå†…å®¹**:
- SpeakerSegmentã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã« `chunk_index` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªã„

**æ¨å¥¨å¯¾å¿œ**:
```typescript
export interface SpeakerSegment {
  readonly id: SpeakerSegmentId;
  readonly sessionId: SessionId;
  readonly chunkIndex: number;  // è¿½åŠ 
  readonly speaker: Speaker;
  readonly startTimeMs: number;
  readonly endTimeMs: number;
  readonly text: string | null;
  readonly confidence: number | null;
  readonly createdAt: Date;
}
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—8: Staff Entityä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
**å•é¡ŒID**: R1-1

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`

**å•é¡Œå†…å®¹**:
- `position`, `joinDate`, `profileImageUrl`, `settings` ãŒDBã«ãªã„
- `authUserId` ã¯ä¸è¦ï¼ˆstaffs.id = auth.users(id)æ§‹é€ ï¼‰

**æ¨å¥¨å¯¾å¿œ**:
```typescript
export interface Staff {
  readonly id: string;            // = auth.users(id)
  readonly salonId: string;
  readonly name: string;
  readonly email: string;
  readonly role: StaffRole;
  readonly avatarUrl: string | null;  // profileImageUrl â†’ avatarUrl
  readonly isActive: boolean;
  readonly createdAt: Date;
  readonly updatedAt: Date;
  // ä»¥ä¸‹å‰Šé™¤: authUserId, position, joinDate, settings
}
```

---

### ğŸŸ¡ ä½é‡è¦åº¦/è»½å¾®å•é¡Œï¼ˆ6ä»¶â†’çµ±åˆå¾Œ4ä»¶ï¼‰

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—9: æ™‚é–“å˜ä½ã®ä¸ä¸€è‡´ï¼ˆ3å•é¡Œâ†’1å¯¾å¿œï¼‰
**å•é¡ŒID**: R1-2, R1-3, R2-5

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/02-ã‚¯ãƒ©ã‚¹è¨­è¨ˆ.md`
- `docs/è©³ç´°è¨­è¨ˆæ›¸/11-ãƒ†ã‚¹ãƒˆä»•æ§˜.md`

**å•é¡Œå†…å®¹**:
- è¨­è¨ˆæ›¸ã§ç§’å˜ä½ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€DBã¯ãƒŸãƒªç§’

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// è¨­è¨ˆæ›¸ã‚’ä¿®æ­£ï¼ˆã¾ãŸã¯ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼‰
interface Transcript {
  startTimeMs: number;  // ãƒŸãƒªç§’ï¼ˆDBã¨ä¸€è‡´ï¼‰
  endTimeMs: number;    // ãƒŸãƒªç§’ï¼ˆDBã¨ä¸€è‡´ï¼‰
}

// ãƒ†ã‚¹ãƒˆä»•æ§˜ã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
// æ³¨: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ç§’å˜ä½ã€DBã¯ãƒŸãƒªç§’ã€‚å¤‰æ›ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å®Ÿæ–½
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—10: auth_user_idã®å‚ç…§æ–¹æ³•
**å•é¡ŒID**: R1-4

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/è©³ç´°è¨­è¨ˆæ›¸/04-ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³è©³ç´°.md`

**å•é¡Œå†…å®¹**:
- `WHERE auth_user_id = ?` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€RLSã§ã¯ `id = auth.uid()` ã‚’ä½¿ç”¨

**æ¨å¥¨å¯¾å¿œ**:
```sql
-- ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã‚’ä¿®æ­£
-- ä¿®æ­£å‰: SELECT * FROM staffs WHERE auth_user_id = ?
-- ä¿®æ­£å¾Œ: SELECT * FROM staffs WHERE id = auth.uid()
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—11: ä¼ç”»æ›¸4æŒ‡æ¨™ã®ã¿
**å•é¡ŒID**: R1-5

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `docs/ä¼ç”»æ›¸/05-æ©Ÿèƒ½è©³ç´°.md`

**å•é¡Œå†…å®¹**:
- ä¼ç”»æ›¸ã«4æŒ‡æ¨™ã—ã‹è¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ï¼ˆå®Ÿè£…ã¯7æŒ‡æ¨™ï¼‰

**æ¨å¥¨å¯¾å¿œ**: ä»»æ„
```markdown
| æŒ‡æ¨™ | èª¬æ˜ |
|------|------|
| ãƒˆãƒ¼ã‚¯æ¯”ç‡ | ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆ/é¡§å®¢ã®ç™ºè©±æ¯”ç‡ |
| è³ªå•ã‚¹ã‚³ã‚¢ | åŠ¹æœçš„ãªè³ªå•ã®é »åº¦ã¨è³ª |
| æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ | ä¼šè©±ã®æ„Ÿæƒ…ãƒˆãƒ¼ãƒ³åˆ†æ |
| æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ | é¡§å®¢ã®æ‚©ã¿ãƒ»ãƒ‹ãƒ¼ã‚ºã®æŠ½å‡º |
| ææ¡ˆã‚¿ã‚¤ãƒŸãƒ³ã‚° | é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®ææ¡ˆ |
| ææ¡ˆå“è³ª | ææ¡ˆå†…å®¹ã®é©åˆ‡ã• |
| æˆç´„åˆ¤å®š | æˆç´„ã«ã¤ãªãŒã‚‹ä¼šè©±ãƒ‘ã‚¿ãƒ¼ãƒ³ |
```

---

#### å•é¡Œã‚°ãƒ«ãƒ¼ãƒ—12: training_scenarios.categoryä¸å­˜åœ¨
**å•é¡ŒID**: R5-2

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `supabase/functions/start-roleplay/index.ts`

**å•é¡Œå†…å®¹**:
- `category` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€DBã«å­˜åœ¨ã—ãªã„

**æ¨å¥¨å¯¾å¿œ**:
```typescript
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰categoryã‚’å‰Šé™¤
// ã¾ãŸã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤'general'ã®ã¾ã¾æ”¾ç½®ï¼ˆæ©Ÿèƒ½ä¸Šå•é¡Œãªã—ï¼‰
```

---

## å¯¾å¿œå„ªå…ˆåº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| å„ªå…ˆåº¦ | å•é¡Œã‚°ãƒ«ãƒ¼ãƒ— | ç†ç”± |
|--------|-------------|------|
| **æœ€å„ªå…ˆ** | sessions.total_duration_ms | ãƒã‚°ï¼šDBæ›´æ–°å¤±æ•—ã®å¯èƒ½æ€§ |
| é«˜ | Staff roleå‹çµ±ä¸€ | è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿ã€å‹å®‰å…¨æ€§ |
| é«˜ | ãƒ¬ãƒãƒ¼ãƒˆã‚«ãƒ©ãƒ åçµ±ä¸€ | API/DBä¸ä¸€è‡´ |
| ä¸­ | phone/joinedAtå‰Šé™¤ | ä¸è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ··ä¹±é˜²æ­¢ |
| ä¸­ | Session statusåçµ±ä¸€ | è¨­è¨ˆæ›¸ã®æ­£ç¢ºæ€§ |
| ä¸­ | SpeakerSegmentä¿®æ­£ | è¨­è¨ˆæ›¸ã®å®Œå…¨æ€§ |
| ä½ | æ™‚é–“å˜ä½ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå“è³ª |
| ä½ | ä¼ç”»æ›¸æ›´æ–° | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå“è³ª |

---

## æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

### Phase 1: ç·Šæ€¥å¯¾å¿œï¼ˆãƒã‚°ä¿®æ­£ï¼‰
1. `sessions.total_duration_ms` ã®å¯¾å¿œã‚’æ±ºå®š
   - DBã«ã‚«ãƒ©ãƒ è¿½åŠ  ã¾ãŸã¯ ãƒ¯ãƒ¼ã‚«ãƒ¼/å‹å®šç¾©ã‹ã‚‰å‰Šé™¤

### Phase 2: å‹çµ±ä¸€ï¼ˆ2-3æ™‚é–“ï¼‰
1. `apps/web/src/types/staff.ts` ã‚’ä½œæˆ
2. StaffRoleå‹ã‚’å®šç¾©ã—ã€å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ç”¨
3. phone/joinedAt/positionãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤

### Phase 3: è¨­è¨ˆæ›¸æ›´æ–°ï¼ˆ1-2æ™‚é–“ï¼‰
1. ã‚¯ãƒ©ã‚¹è¨­è¨ˆæ›¸ã®ä¿®æ­£
   - Staff Entity
   - Session status
   - SpeakerSegment
   - Planå‹
2. APIè©³ç´°ä»•æ§˜æ›¸ã®ä¿®æ­£
3. çŠ¶æ…‹é·ç§»è¨­è¨ˆã®ä¿®æ­£

### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ï¼ˆä»»æ„ï¼‰
1. ä¼ç”»æ›¸ã®æ›´æ–°
2. ãƒ†ã‚¹ãƒˆä»•æ§˜ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 

---
