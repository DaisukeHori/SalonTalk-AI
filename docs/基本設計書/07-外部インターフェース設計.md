## 7. å¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

### 7.1 å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ä¸€è¦§

| ã‚·ã‚¹ãƒ†ãƒ å | é€£æºæ–¹å¼ | ç”¨é€” | èªè¨¼æ–¹å¼ | SLA |
|-----------|---------|------|---------|-----|
| Anthropic Claude API | REST API | AIåˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤ | API Key | 99.5% |
| OpenAI API | REST API | Embeddingç”Ÿæˆ | API Key | 99.9% |
| pyannote Server | REST API | è©±è€…åˆ†é›¢ | API Key (ã‚«ã‚¹ã‚¿ãƒ ) | - |
| Apple Push Notification | APNs | ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ | Certificate | 99.9% |
| Stripe APIï¼ˆå°†æ¥ï¼‰ | REST API + Webhook | æ±ºæ¸ˆå‡¦ç† | API Key | 99.9% |

### 7.1.2 å†…éƒ¨APIï¼ˆEdge Functionsï¼‰ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°

> ğŸ†• **è¿½åŠ ï¼ˆ2025-12-09ï¼‰**: APIãƒ‘ã‚¹æ•´åˆæ€§ã«é–¢ã™ã‚‹æ³¨æ„äº‹é …

**å®Ÿè£…ãƒ‘ã‚¹ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¡¨è¨˜ã®å¯¾å¿œ**:

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¡¨è¨˜ | å®Ÿéš›ã®Supabase Edge Functionsãƒ‘ã‚¹ |
|-----------------|----------------------------------|
| `/api/sessions/*` | `/functions/v1/create-session`, `/functions/v1/end-session` |
| `/api/devices/*` | `/functions/v1/register-device`, `/functions/v1/activate-device`, etc. |

**ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°æˆ¦ç•¥**:

ç¾æ™‚ç‚¹ã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆiPad/Webï¼‰ã‹ã‚‰ç›´æ¥ Supabase Edge Functions ã‚’å‘¼ã³å‡ºã™æ§‹æˆã§ã™ã€‚

```
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ Supabase Edge Functions (/functions/v1/xxx)
```

å°†æ¥çš„ã«ä»¥ä¸‹ã®é¸æŠè‚¢ã‚’æ¤œè¨:

1. **ç¾è¡Œç¶­æŒ**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ `/functions/v1/xxx` ã‚’ç›´æ¥å‘¼ã³å‡ºã—
   - ãƒ¡ãƒªãƒƒãƒˆ: ã‚·ãƒ³ãƒ—ãƒ«ã€è¿½åŠ ã‚¤ãƒ³ãƒ•ãƒ©ä¸è¦
   - ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: Supabaseã¸ã®ä¾å­˜

2. **API Gateway/BFFå°å…¥**: `/api/*` ã‚’ä¸­é–“å±¤ã§ãƒãƒƒãƒ”ãƒ³ã‚°
   - ãƒ¡ãƒªãƒƒãƒˆ: æŠ½è±¡åŒ–ã€å°†æ¥ã®ç§»è¡ŒãŒå®¹æ˜“
   - ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: è¿½åŠ ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚³ã‚¹ãƒˆãƒ»é…å»¶

3. **Vercel API Routes**: Next.jsã®API Routesã§ä¸­ç¶™
   - ãƒ¡ãƒªãƒƒãƒˆ: æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©æ´»ç”¨
   - ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: Webå°‚ç”¨ï¼ˆiPadã‚¢ãƒ—ãƒªã¯åˆ¥é€”å¯¾å¿œå¿…è¦ï¼‰

**ç¾æ™‚ç‚¹ã§ã®æ–¹é‡**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³1ã‚’æ¡ç”¨ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯Supabase URLã‚’ç›´æ¥ä½¿ç”¨

### 7.2 APIé€£æºä»•æ§˜

#### 7.2.1 Anthropic Claude API

**åŸºæœ¬æƒ…å ±**:

| é …ç›® | å€¤ |
|------|-----|
| ãƒ™ãƒ¼ã‚¹URL | https://api.anthropic.com |
| APIãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 2023-06-01 |
| ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« | claude-sonnet-4-5-20250929 |
| èªè¨¼æ–¹å¼ | x-api-key ãƒ˜ãƒƒãƒ€ãƒ¼ |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 60ç§’ |
| ãƒªãƒˆãƒ©ã‚¤ | 3å›ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰ |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼**:

```typescript
// POST https://api.anthropic.com/v1/messages

interface ClaudeRequest {
  model: string;                    // "claude-sonnet-4-5-20250929"
  max_tokens: number;               // æœ€å¤§4096
  messages: {
    role: 'user' | 'assistant';
    content: string;
  }[];
  system?: string;                  // ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  temperature?: number;             // 0-1ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ï¼‰
  top_p?: number;                   // 0-1
  stop_sequences?: string[];
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**:

```typescript
interface ClaudeResponse {
  id: string;                       // "msg_01..."
  type: 'message';
  role: 'assistant';
  content: {
    type: 'text';
    text: string;
  }[];
  model: string;
  stop_reason: 'end_turn' | 'max_tokens' | 'stop_sequence';
  usage: {
    input_tokens: number;
    output_tokens: number;
  };
}
```

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:

| HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | å¯¾å¿œ |
|--------------|-----------|------|
| 400 | bad_request | ãƒ­ã‚°è¨˜éŒ²ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ |
| 401 | authentication_error | ã‚¢ãƒ©ãƒ¼ãƒˆã€API Keyç¢ºèª |
| 403 | permission_error | ã‚¢ãƒ©ãƒ¼ãƒˆã€æ¨©é™ç¢ºèª |
| 429 | rate_limit_error | æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ãƒªãƒˆãƒ©ã‚¤ |
| 500 | api_error | ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§3å›ï¼‰ |
| 503 | overloaded_error | ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§3å›ï¼‰ |

**ä½¿ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ï¼ˆ7æŒ‡æ¨™åˆ†æï¼‰**:

```typescript
const analysisPrompt = `
ã‚ãªãŸã¯ç¾å®¹å®¤ã®æ¥å®¢ä¼šè©±ã‚’åˆ†æã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®ä¼šè©±ã‚’åˆ†æã—ã€JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§çµæœã‚’è¿”ã—ã¦ãã ã•ã„ã€‚

## ä¼šè©±ãƒ‡ãƒ¼ã‚¿
${JSON.stringify(transcriptWithSpeakers)}

## åˆ†æé …ç›®
1. æ„Ÿæƒ…åˆ†æï¼ˆemotion_analysisï¼‰
   - ãƒã‚¸ãƒ†ã‚£ãƒ–/ãƒã‚¬ãƒ†ã‚£ãƒ–ã®åˆ¤å®š
   - æ„Ÿæƒ…ã‚’ç¤ºã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®æŠ½å‡º
   
2. æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºï¼ˆconcern_keywordsï¼‰
   - é«ªã®æ‚©ã¿ã«é–¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¹¾ç‡¥ã€åºƒãŒã‚Šã€ãƒ‘ã‚µã¤ãã€ãƒ€ãƒ¡ãƒ¼ã‚¸ã€ã†ã­ã‚Šã€è–„æ¯›ã€ç™½é«ªï¼‰
   - æ¤œå‡ºã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°
   
3. ææ¡ˆå“è³ªï¼ˆproposal_qualityï¼‰
   - å•†å“ææ¡ˆãŒã‚ã£ãŸã‹
   - ãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆï¼ˆåŠ¹æœãƒ»ãƒ¡ãƒªãƒƒãƒˆï¼‰ã‚’ä¼ãˆã¦ã„ã‚‹ã‹
   - ã‚¹ãƒšãƒƒã‚¯ï¼ˆæˆåˆ†ãƒ»æ©Ÿèƒ½ï¼‰ã ã‘ã§ãªã„ã‹
   
4. æˆç´„åˆ¤å®šï¼ˆconversionï¼‰
   - è³¼å…¥æ„æ€ã®è¡¨æ˜ãŒã‚ã£ãŸã‹
   - è³¼å…¥ã—ãŸå•†å“å

## å‡ºåŠ›å½¢å¼
{
  "emotion_analysis": {
    "positive_ratio": number (0-100),
    "keywords": string[],
    "overall": "positive" | "neutral" | "negative"
  },
  "concern_keywords": {
    "detected": boolean,
    "keywords": string[],
    "detected_at": number[] // ç§’
  },
  "proposal_quality": {
    "has_proposal": boolean,
    "benefit_ratio": number (0-100),
    "details": string[]
  },
  "conversion": {
    "converted": boolean,
    "product_name": string | null
  }
}
`;
```

---

#### 7.2.2 OpenAI Embedding API

**åŸºæœ¬æƒ…å ±**:

| é …ç›® | å€¤ |
|------|-----|
| ãƒ™ãƒ¼ã‚¹URL | https://api.openai.com |
| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | /v1/embeddings |
| ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« | text-embedding-3-small |
| æ¬¡å…ƒæ•° | 1536 |
| èªè¨¼æ–¹å¼ | Bearer ãƒˆãƒ¼ã‚¯ãƒ³ |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 30ç§’ |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼**:

```typescript
// POST https://api.openai.com/v1/embeddings

interface EmbeddingRequest {
  model: string;                    // "text-embedding-3-small"
  input: string | string[];         // ãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯ãƒ†ã‚­ã‚¹ãƒˆé…åˆ—
  encoding_format?: 'float' | 'base64';
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**:

```typescript
interface EmbeddingResponse {
  object: 'list';
  data: {
    object: 'embedding';
    index: number;
    embedding: number[];           // 1536æ¬¡å…ƒ
  }[];
  model: string;
  usage: {
    prompt_tokens: number;
    total_tokens: number;
  };
}
```

**ä½¿ç”¨ä¾‹**:

```typescript
async function createEmbedding(text: string): Promise<number[]> {
  const response = await fetch('https://api.openai.com/v1/embeddings', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${OPENAI_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      model: 'text-embedding-3-small',
      input: text,
    }),
  });
  
  const data: EmbeddingResponse = await response.json();
  return data.data[0].embedding;
}
```

---

#### 7.2.3 pyannote Server API

**åŸºæœ¬æƒ…å ±**:

| é …ç›® | å€¤ |
|------|-----|
| ãƒ™ãƒ¼ã‚¹URL | http://{server}:{port} |
| èªè¨¼æ–¹å¼ | X-API-Key ãƒ˜ãƒƒãƒ€ãƒ¼ |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 300ç§’ï¼ˆ5åˆ†ï¼‰ |
| éåŒæœŸå‡¦ç† | Callbackæ–¹å¼ |

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§**:

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| POST | /diarize/{session_id} | è©±è€…åˆ†é›¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| GET | /status/{session_id} | å‡¦ç†çŠ¶æ…‹ç¢ºèª |
| GET | /health | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ |

**POST /diarize/{session_id}**:

ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆmultipart/form-dataï¼‰:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| audio | File | â—‹ | WAVãƒ•ã‚¡ã‚¤ãƒ« |
| callback_url | string | â—‹ | ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URL |
| num_speakers | integer | Ã— | è©±è€…æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2ï¼‰ |

ãƒ¬ã‚¹ãƒãƒ³ã‚¹:

```typescript
interface DiarizeResponse {
  status: 'processing';
  session_id: string;
  estimated_time: number;  // äºˆæƒ³å‡¦ç†æ™‚é–“ï¼ˆç§’ï¼‰
}
```

**Callbackå½¢å¼**:

```typescript
// POST {callback_url}

interface DiarizationCallback {
  session_id: string;
  status: 'completed' | 'failed';
  segments?: {
    speaker: 'SPEAKER_00' | 'SPEAKER_01';
    start: number;        // é–‹å§‹æ™‚é–“ï¼ˆç§’ï¼‰
    end: number;          // çµ‚äº†æ™‚é–“ï¼ˆç§’ï¼‰
  }[];
  error?: string;
}
```

---

#### 7.2.4 ğŸ†• å†…éƒ¨API: ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ï¼ˆ2025-12-09è¿½åŠ ï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§**:

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | èªè¨¼ |
|---------|------|------|------|
| GET | /api/devices | ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§å–å¾— | Bearer |
| POST | /api/devices | ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ² | Bearer (owner/manager) |
| GET | /api/devices/:id | ãƒ‡ãƒã‚¤ã‚¹è©³ç´°å–å¾— | Bearer |
| PATCH | /api/devices/:id | ãƒ‡ãƒã‚¤ã‚¹æ›´æ–° | Bearer (owner/manager) |
| DELETE | /api/devices/:id | ãƒ‡ãƒã‚¤ã‚¹å‰Šé™¤ | Bearer (owner) |
| POST | /api/devices/:id/activation-code | ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ç™ºè¡Œ | Bearer (owner/manager) |
| POST | /api/devices/activate | ãƒ‡ãƒã‚¤ã‚¹ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ | ãªã—ï¼ˆã‚³ãƒ¼ãƒ‰ã§èªè¨¼ï¼‰ |
| POST | /api/devices/authenticate | ãƒ‡ãƒã‚¤ã‚¹èªè¨¼ï¼ˆèµ·å‹•æ™‚ï¼‰ | ãªã—ï¼ˆãƒ‡ãƒã‚¤ã‚¹IDã§èªè¨¼ï¼‰ |

**POST /api/devices**ï¼ˆãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
interface CreateDeviceRequest {
  device_name: string;      // ãƒ‡ãƒã‚¤ã‚¹è¡¨ç¤ºå
  seat_number?: number;     // ã‚»ãƒƒãƒˆé¢ç•ªå·ï¼ˆä»»æ„ï¼‰
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface CreateDeviceResponse {
  device_id: string;
  device_name: string;
  status: 'pending';
  activation_code: string;  // 6æ¡ã‚³ãƒ¼ãƒ‰
  expires_at: string;       // ISO8601
}
```

**POST /api/devices/activate**ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
interface ActivateDeviceRequest {
  activation_code: string;    // 6æ¡ã‚³ãƒ¼ãƒ‰
  device_identifier: string;  // ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ID
  metadata?: {
    os_version?: string;
    app_version?: string;
    model?: string;
  };
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface ActivateDeviceResponse {
  success: boolean;
  device_id: string;
  salon_id: string;
  device_name: string;
  message: string;
}
```

**POST /api/devices/authenticate**ï¼ˆãƒ‡ãƒã‚¤ã‚¹èªè¨¼ï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
interface AuthenticateDeviceRequest {
  device_identifier: string;  // ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ID
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface AuthenticateDeviceResponse {
  is_valid: boolean;
  device_id: string | null;
  salon_id: string | null;
  device_name: string | null;
  seat_number: number | null;
}
```

---

#### 7.2.5 ğŸ†• å†…éƒ¨API: ã‚¹ã‚¿ãƒƒãƒ•å£°ç´‹ï¼ˆ2025-12-09è¿½åŠ ï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§**:

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | èªè¨¼ |
|---------|------|------|------|
| POST | /api/staffs/voice-register | å£°ç´‹ç™»éŒ²ãƒ»æ›´æ–° | Bearer |
| GET | /api/staffs/:id/voice-status | å£°ç´‹ç™»éŒ²çŠ¶æ…‹å–å¾— | Bearer |
| DELETE | /api/staffs/:id/voice | å£°ç´‹å‰Šé™¤ | Bearer |
| POST | /api/sessions/:id/identify-staff | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ãƒƒãƒ•è­˜åˆ¥ | Bearer (device) |
| POST | /api/sessions/:id/confirm-staff | ã‚¹ã‚¿ãƒƒãƒ•æ‰‹å‹•ç¢ºèª | Bearer (device) |

**POST /api/staffs/voice-register**ï¼ˆå£°ç´‹ç™»éŒ²ï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆmultipart/form-dataï¼‰
// - audio: WAVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ30ç§’ä»¥ä¸Šï¼‰
// - is_additional: booleanï¼ˆè¿½åŠ ã‚µãƒ³ãƒ—ãƒ«ã‹ã©ã†ã‹ï¼‰

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface VoiceRegisterResponse {
  success: boolean;
  sample_count: number;     // ç´¯è¨ˆã‚µãƒ³ãƒ—ãƒ«æ•°
  quality_score: number;    // å“è³ªã‚¹ã‚³ã‚¢ (0-100)
  message: string;
}
```

**POST /api/sessions/:id/identify-staff**ï¼ˆã‚¹ã‚¿ãƒƒãƒ•è‡ªå‹•è­˜åˆ¥ï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
interface IdentifyStaffRequest {
  speaker_embeddings: {
    label: string;              // "SPEAKER_00" | "SPEAKER_01"
    embedding: number[];        // 512æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«
    duration_ms: number;        // ç™ºè©±æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
  }[];
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface IdentifyStaffResponse {
  identified: boolean;
  stylist_id: string | null;
  stylist_name: string | null;
  confidence: number;           // é¡ä¼¼åº¦ (0-1)
  confidence_level: 'high' | 'medium' | 'low' | 'none';
  requires_confirmation: boolean; // ä½ä¿¡é ¼åº¦æ™‚true
}
```

**POST /api/sessions/:id/confirm-staff**ï¼ˆã‚¹ã‚¿ãƒƒãƒ•æ‰‹å‹•ç¢ºèªï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
interface ConfirmStaffRequest {
  stylist_id: string;           // ç¢ºèª/ä¿®æ­£ã•ã‚ŒãŸã‚¹ã‚¿ãƒƒãƒ•ID
  learn_from_audio?: boolean;   // å£°ç´‹å­¦ç¿’ã«ä½¿ç”¨ã™ã‚‹ã‹
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface ConfirmStaffResponse {
  success: boolean;
  message: string;
}
```

---

#### 7.2.6 ğŸ†• pyannote Server: åŸ‹ã‚è¾¼ã¿æŠ½å‡ºAPIï¼ˆ2025-12-09è¿½åŠ ï¼‰

**POST /extract-embedding**ï¼ˆå£°ç´‹åŸ‹ã‚è¾¼ã¿æŠ½å‡ºï¼‰:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆmultipart/form-dataï¼‰
// - audio: WAVãƒ•ã‚¡ã‚¤ãƒ«

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface ExtractEmbeddingResponse {
  embedding: number[];        // 512æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«
  duration_ms: number;        // éŸ³å£°é•·ï¼ˆãƒŸãƒªç§’ï¼‰
  quality_score: number;      // å“è³ªã‚¹ã‚³ã‚¢ (0-100)
}
```

**POST /diarizeï¼ˆæ‹¡å¼µï¼‰**:

```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆmultipart/form-dataï¼‰
// - audio: WAVãƒ•ã‚¡ã‚¤ãƒ«
// - callback_url: string
// - num_speakers: integer
// - extract_embeddings: booleanï¼ˆğŸ†• è©±è€…ã”ã¨ã®åŸ‹ã‚è¾¼ã¿æŠ½å‡ºï¼‰

// Callbackå½¢å¼ï¼ˆæ‹¡å¼µï¼‰
interface DiarizationCallbackExtended {
  session_id: string;
  status: 'completed' | 'failed';
  segments?: {
    speaker: 'SPEAKER_00' | 'SPEAKER_01';
    start: number;
    end: number;
  }[];
  speaker_embeddings?: {      // ğŸ†• extract_embeddings=trueæ™‚
    label: string;
    embedding: number[];
    duration_ms: number;
  }[];
  error?: string;
}
```

---

### 7.3 ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

#### 7.3.1 éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

| é …ç›® | ä»•æ§˜ |
|------|------|
| ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | WAV (PCM) |
| ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ | 16000 Hz |
| ãƒ“ãƒƒãƒˆæ·±åº¦ | 16bit |
| ãƒãƒ£ãƒ³ãƒãƒ« | ãƒ¢ãƒãƒ©ãƒ« |
| æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º | 10MB/ãƒãƒ£ãƒ³ã‚¯ |
| ãƒãƒ£ãƒ³ã‚¯é•· | 60ç§’ |

#### 7.3.2 ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

**PDFï¼ˆãƒ¬ãƒãƒ¼ãƒˆï¼‰**:

| é …ç›® | ä»•æ§˜ |
|------|------|
| ã‚µã‚¤ã‚º | A4 |
| å‘ã | ç¸¦ |
| ãƒ•ã‚©ãƒ³ãƒˆ | Noto Sans JP |
| æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | UTF-8 |

**CSVï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰**:

| é …ç›® | ä»•æ§˜ |
|------|------|
| æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | UTF-8 (BOMä»˜ã) |
| åŒºåˆ‡ã‚Šæ–‡å­— | ã‚«ãƒ³ãƒ |
| æ”¹è¡Œã‚³ãƒ¼ãƒ‰ | CRLF |
| ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ | ã‚ã‚Š |

---
