## 11. 移行設計

### 11.1 移行方針

本システムは新規開発のため、既存システムからのデータ移行は基本的に発生しない。ただし、以下の移行作業が必要となる。

| 移行種別 | 内容 | 対象 | 方式 |
|---------|------|------|------|
| 初期データ投入 | マスタデータ | プラン、シナリオ | SQL |
| デモデータ投入 | サンプルデータ | デモ店舗、スタッフ | SQL |
| 将来POS連携 | 顧客データ | POSシステム | API連携 |

### 11.2 初期データ投入

#### 11.2.1 初期データ一覧

| データ種別 | 件数 | 投入方法 | 投入タイミング |
|-----------|------|---------|--------------|
| プランマスタ | 3件 | SQL | 初期デプロイ時 |
| 悩みキーワードマスタ | 30件 | SQL | 初期デプロイ時 |
| トレーニングシナリオ | 10件 | SQL | 初期デプロイ時 |
| デモ店舗 | 1件 | SQL | 初期デプロイ時 |
| デモスタッフ | 5件 | SQL | 初期デプロイ時 |
| サンプル成功事例 | 20件 | SQL | 初期デプロイ時 |

#### 11.2.2 初期データSQL

```sql
-- ================================================
-- 初期データ投入スクリプト
-- ================================================

-- 1. プランマスタ
INSERT INTO plans (id, name, price_monthly, features, max_sessions, max_staff) VALUES
('plan_standard', 'スタンダード', 9800, 
  '{"ai_analysis": true, "realtime_assist": true, "report": true, "training": false, "api_access": false}',
  100, 10),
('plan_professional', 'プロフェッショナル', 19800,
  '{"ai_analysis": true, "realtime_assist": true, "report": true, "training": true, "api_access": false}',
  500, 30),
('plan_enterprise', 'エンタープライズ', 49800,
  '{"ai_analysis": true, "realtime_assist": true, "report": true, "training": true, "api_access": true}',
  -1, -1);  -- -1 = 無制限

-- 2. 悩みキーワードマスタ
INSERT INTO concern_keywords (category, keyword, priority) VALUES
('乾燥', '乾燥', 1),
('乾燥', 'パサパサ', 1),
('乾燥', 'パサつき', 1),
('乾燥', '潤いがない', 2),
('広がり', '広がる', 1),
('広がり', '広がり', 1),
('広がり', 'まとまらない', 2),
('広がり', 'ボワッとする', 2),
('ダメージ', 'ダメージ', 1),
('ダメージ', '傷んでる', 1),
('ダメージ', '枝毛', 2),
('ダメージ', '切れ毛', 2),
('うねり', 'うねり', 1),
('うねり', 'くせ毛', 1),
('うねり', 'ハネる', 2),
('薄毛', '薄毛', 1),
('薄毛', 'ボリュームがない', 1),
('薄毛', 'ぺたんこ', 2),
('薄毛', '抜け毛', 2),
('白髪', '白髪', 1),
('白髪', '白髪染め', 1),
('白髪', 'グレイヘア', 2),
('頭皮', '頭皮', 1),
('頭皮', 'かゆい', 2),
('頭皮', 'フケ', 2),
('頭皮', 'べたつき', 2),
('カラー', '色落ち', 1),
('カラー', '退色', 2),
('パーマ', 'パーマがとれる', 1),
('パーマ', 'カールが弱い', 2);

-- 3. トレーニングシナリオ
INSERT INTO training_scenarios (id, name, level, description, category, initial_prompt, evaluation_criteria) VALUES
('scenario_001', '初めてのお客様対応', 'beginner', '新規のお客様への基本的なカウンセリング', 'カウンセリング',
  'あなたは30代女性のお客様です。初めてこの美容室に来ました。髪の毛が最近パサついて困っています。',
  '{"greeting": 0.2, "listening": 0.3, "question": 0.3, "proposal": 0.2}'),
('scenario_002', '悩みの深堀り', 'beginner', 'お客様の悩みを詳しく聞き出す', 'カウンセリング',
  'あなたは40代女性のお客様です。髪の広がりが気になっていますが、具体的に何が原因かわかっていません。',
  '{"listening": 0.3, "question": 0.4, "empathy": 0.3}'),
('scenario_003', '店販商品の提案（初級）', 'intermediate', 'シャンプーの提案練習', '店販提案',
  'あなたは30代女性のお客様です。乾燥が気になると話しています。商品を勧められたら興味を示してください。',
  '{"timing": 0.2, "benefit": 0.4, "closing": 0.2, "objection_handling": 0.2}'),
('scenario_004', '店販商品の提案（中級）', 'intermediate', 'トリートメントの提案練習', '店販提案',
  'あなたは40代女性のお客様です。ダメージが気になっています。商品提案に対して「高い」と言ってください。',
  '{"timing": 0.2, "benefit": 0.3, "objection_handling": 0.3, "closing": 0.2}'),
('scenario_005', '断られた時の対応', 'intermediate', '商品提案を断られた時の対応', '店販提案',
  'あなたは30代女性のお客様です。商品を勧められたら「今日はいいです」と断ってください。',
  '{"acceptance": 0.3, "alternative": 0.3, "relationship": 0.4}'),
('scenario_006', '難しいお客様対応', 'advanced', '要望の多いお客様への対応', '接客',
  'あなたは50代女性のお客様です。細かい要望が多く、「前回と違う」「イメージと違う」と言いがちです。',
  '{"patience": 0.3, "clarification": 0.3, "solution": 0.2, "satisfaction": 0.2}'),
('scenario_007', 'クレーム対応', 'advanced', 'クレームへの適切な対応', '接客',
  'あなたは40代女性のお客様です。前回のカラーが思ったより暗かったと不満を持っています。',
  '{"apology": 0.3, "listening": 0.3, "solution": 0.2, "follow_up": 0.2}'),
('scenario_008', '高単価商品の提案', 'advanced', '高価格帯商品の提案練習', '店販提案',
  'あなたは30代女性のお客様です。髪のケアに興味がありますが、5000円以上の商品には慎重です。',
  '{"value": 0.4, "benefit": 0.3, "trust": 0.3}'),
('scenario_009', '複数商品の提案', 'advanced', 'シャンプー＋トリートメントのセット提案', '店販提案',
  'あなたは40代女性のお客様です。乾燥とダメージの両方が気になっています。',
  '{"needs_analysis": 0.3, "combination": 0.3, "value": 0.2, "closing": 0.2}'),
('scenario_010', 'リピート促進', 'advanced', '次回予約の促進', '接客',
  'あなたは30代女性のお客様です。施術には満足していますが、次回予約は考えていません。',
  '{"satisfaction_confirm": 0.2, "benefit": 0.3, "urgency": 0.2, "booking": 0.3}');

-- 4. デモ店舗・スタッフ（開発・デモ用）
INSERT INTO salons (id, name, address, phone, plan, seats_count, settings) VALUES
('demo-salon-001', 'デモサロン 渋谷店', '東京都渋谷区神南1-1-1', '03-1234-5678', 'professional', 8,
  '{"notification": {"enablePush": true, "concernDetectionAlert": true}, "analysis": {"idealTalkRatio": 40}}');

-- 5. サンプル成功事例
INSERT INTO success_cases (salon_id, concern_keywords, customer_profile, successful_talk, key_tactics, sold_product, conversion_rate, is_public) VALUES
('demo-salon-001', 
  ARRAY['乾燥', 'パサつき'],
  '{"ageGroup": "30s", "gender": "female", "visitFrequency": "monthly"}',
  '「乾燥が気になるんですね。実は同じお悩みだったお客様が、このシャンプーに変えてから朝のスタイリング時間が5分短くなったとおっしゃってました。」',
  ARRAY['共感から入る', '具体的な効果を伝える', '他のお客様の声を活用'],
  '保湿シャンプー',
  0.35,
  true),
('demo-salon-001',
  ARRAY['広がり', 'まとまらない'],
  '{"ageGroup": "40s", "gender": "female", "visitFrequency": "bimonthly"}',
  '「湿気の時期は特に大変ですよね。このオイルは少量で済むので、コスパも良いんです。1本で3ヶ月くらいもちますよ。」',
  ARRAY['季節の悩みに共感', 'コストパフォーマンスを強調', '使用量の具体例'],
  'ヘアオイル',
  0.28,
  true);

-- 6. 成功事例のEmbedding生成（Edge Functionで実行）
-- create-embedding Edge Functionを呼び出して生成
```

### 11.3 段階的リリース計画

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           段階的リリース計画                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Phase 0: 開発・テスト環境                                                   │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  期間: 開発期間中                                                            │
│  対象: 開発チーム                                                            │
│  環境: Staging                                                              │
│  目的: 機能検証、バグ修正                                                    │
│                                                                             │
│  Phase 1: 社内パイロット                                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  期間: 2週間                                                                 │
│  対象: Revol社内スタッフ（5名）                                              │
│  環境: Production（制限付き）                                                │
│  目的: 実環境での動作確認、UXフィードバック収集                               │
│  成功基準:                                                                   │
│    ● システムエラー率 < 1%                                                  │
│    ● セッション完了率 > 95%                                                 │
│    ● ユーザー満足度 > 3.5/5                                                 │
│                                                                             │
│  Phase 2: 限定リリース                                                       │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  期間: 1ヶ月                                                                 │
│  対象: パイロット店舗（2店舗、20名）                                         │
│  環境: Production                                                           │
│  目的: 実店舗での検証、運用課題の洗い出し                                    │
│  成功基準:                                                                   │
│    ● 店販売上向上 > 10%                                                     │
│    ● スタッフ利用率 > 80%                                                   │
│    ● 重大障害 = 0                                                           │
│                                                                             │
│  Phase 3: 一般リリース                                                       │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  期間: 以降継続                                                              │
│  対象: 全顧客                                                                │
│  環境: Production                                                           │
│  目的: 本格運用開始                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---
