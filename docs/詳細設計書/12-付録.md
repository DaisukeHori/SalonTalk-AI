## 12. 付録

### 12.1 コーディング規約

#### 12.1.1 TypeScript

- **命名規則**
  - 変数・関数: camelCase
  - 型・インターフェース・クラス: PascalCase
  - 定数: UPPER_SNAKE_CASE
  - ファイル名: kebab-case（コンポーネントはPascalCase）

- **インポート順序**
  1. React / React Native
  2. 外部ライブラリ
  3. 内部モジュール（絶対パス）
  4. 相対パスインポート
  5. 型インポート

#### 12.1.2 SQL

- **命名規則**
  - テーブル名: snake_case（複数形）
  - カラム名: snake_case
  - インデックス名: idx_{table}_{columns}
  - 制約名: {table}_{constraint_type}_{description}

#### 12.1.3 Repository層の命名規則変換

DB（snake_case）とTypeScript（camelCase）間の変換は、Repository層で行う。

```typescript
// DB → Entity変換例（toEntity関数）
function toEntity(row: SuccessCaseRow): SuccessCase {
  return {
    id: createSuccessCaseId(row.id),
    salonId: createSalonId(row.salon_id),           // snake_case → camelCase
    sessionId: row.session_id ? createSessionId(row.session_id) : null,
    stylistId: row.stylist_id ? createStaffId(row.stylist_id) : null,
    concernKeywords: row.concern_keywords,          // snake_case → camelCase
    customerProfile: row.customer_profile,
    approachText: row.approach_text,
    successfulTalk: row.successful_talk,
    keyTactics: row.key_tactics,
    result: row.result,
    soldProduct: row.sold_product,
    conversionRate: row.conversion_rate,
    embedding: row.embedding,
    isActive: row.is_active,                        // snake_case → camelCase
    isPublic: row.is_public,
    createdAt: new Date(row.created_at),
    updatedAt: new Date(row.updated_at),
  };
}

// Entity → DB変換例（create関数）
async create(data: CreateSuccessCaseParams): Promise<SuccessCase> {
  const insertData = {
    salon_id: data.salonId,                         // camelCase → snake_case
    session_id: data.sessionId,
    stylist_id: data.stylistId,
    concern_keywords: data.concernKeywords,
    customer_profile: data.customerProfile,
    approach_text: data.approachText,               // camelCase → snake_case
    // ...
  };
  // ...
}
```

**変換ルール:**
| DB (snake_case) | TypeScript (camelCase) |
|-----------------|------------------------|
| salon_id | salonId |
| session_id | sessionId |
| stylist_id | stylistId |
| concern_keywords | concernKeywords |
| approach_text | approachText |
| successful_talk | successfulTalk |
| key_tactics | keyTactics |
| sold_product | soldProduct |
| conversion_rate | conversionRate |
| is_active | isActive |
| is_public | isPublic |
| created_at | createdAt |
| updated_at | updatedAt |
| generated_at | generatedAt |
| started_at | startedAt |
| ended_at | endedAt |
| overall_score | overallScore |
| total_duration_ms | totalDurationMs |

**責務の分離:**
- **UI/API層**: camelCaseのみ使用
- **Repository層**: snake_case ↔ camelCase変換を担当
- **DB層**: snake_caseのみ使用

### 12.2 環境変数一覧

| 変数名 | 説明 | 必須 | 例 |
|--------|------|------|-----|
| SUPABASE_URL | Supabase プロジェクトURL | ○ | https://xxx.supabase.co |
| SUPABASE_ANON_KEY | Supabase 匿名キー | ○ | eyJ... |
| SUPABASE_SERVICE_ROLE_KEY | Supabase サービスロールキー | ○ | eyJ... |
| ANTHROPIC_API_KEY | Claude API キー | ○ | sk-ant-... |
| OPENAI_API_KEY | OpenAI API キー | ○ | sk-... |
| PYANNOTE_SERVER_URL | pyannote サーバーURL | ○ | http://... |
| PYANNOTE_API_KEY | pyannote API キー | ○ | ... |
| PYANNOTE_CALLBACK_SECRET | Callback認証シークレット | ○ | ... |

### 12.3 依存ライブラリ一覧

#### フロントエンド（React Native / Next.js）

| ライブラリ | バージョン | 用途 |
|-----------|-----------|------|
| react | 18.x | UIフレームワーク |
| react-native | 0.73.x | モバイルアプリ |
| expo | ~50.x | React Native開発環境 |
| next | 14.x | Webフレームワーク |
| @supabase/supabase-js | 2.x | Supabaseクライアント |
| zustand | 4.x | 状態管理 |
| swr | 2.x | データフェッチング |
| zod | 3.x | バリデーション |
| recharts | 2.x | グラフ描画 |

#### バックエンド（Edge Functions）

| ライブラリ | バージョン | 用途 |
|-----------|-----------|------|
| @anthropic-ai/sdk | 0.x | Claude API |
| deno std | 0.177+ | Deno標準ライブラリ |

---
