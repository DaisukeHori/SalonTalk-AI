## 12. 付録

### 12.1 コーディング規約

#### 12.1.1 TypeScript

- **命名規則**
  - 変数・関数: camelCase
  - 型・インターフェース・クラス: PascalCase
  - 定数: UPPER_SNAKE_CASE
  - ファイル名: kebab-case（コンポーネントはPascalCase）

- **インポート順序**
  1. React / React Native
  2. 外部ライブラリ
  3. 内部モジュール（絶対パス）
  4. 相対パスインポート
  5. 型インポート

#### 12.1.2 SQL

- **命名規則**
  - テーブル名: snake_case（複数形）
  - カラム名: snake_case
  - インデックス名: idx_{table}_{columns}
  - 制約名: {table}_{constraint_type}_{description}

#### 12.1.3 型定義の単一ソース原則

**方針: Supabase生成型を単一ソースとして使用（snake_case統一）**

```
┌─────────────────────────────────────────────────────────────────┐
│                    型定義の流れ                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  DBスキーマ (PostgreSQL)                                        │
│       │                                                         │
│       ▼  supabase gen types typescript                         │
│  ┌─────────────────────────────────────────┐                   │
│  │  apps/web/src/types/database.ts         │  ← 自動生成       │
│  │  (snake_case)                           │                   │
│  └─────────────────────────────────────────┘                   │
│       │                                                         │
│       ▼  import                                                 │
│  ┌─────────────────────────────────────────┐                   │
│  │  Repository / Edge Functions / UI       │  ← そのまま使用   │
│  │  (snake_case)                           │                   │
│  └─────────────────────────────────────────┘                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**理由:**
1. **型安全性**: DBスキーマから自動生成されるため、変換ミスがない
2. **保守性**: カラム追加時に型定義の手動更新が不要
3. **一貫性**: 全レイヤーで同じフィールド名を使用
4. **シンプル**: 変換ロジックが不要

**使用方法:**

```typescript
// 型のインポート
import type { Database } from '@/types/database';

// テーブル型の取得
type SuccessCase = Database['public']['Tables']['success_cases']['Row'];
type SuccessCaseInsert = Database['public']['Tables']['success_cases']['Insert'];
type SuccessCaseUpdate = Database['public']['Tables']['success_cases']['Update'];

// 使用例
const successCase: SuccessCase = {
  id: 'uuid',
  salon_id: 'uuid',           // snake_case
  session_id: null,
  concern_keywords: [],       // snake_case
  approach_text: 'text',      // snake_case
  result: 'text',
  is_active: true,            // snake_case
  is_public: false,
  created_at: '2025-01-01',   // snake_case
  updated_at: '2025-01-01',
  // ...
};
```

**型生成コマンド:**

```bash
# ローカルDBから型生成
supabase gen types typescript --local > apps/web/src/types/database.ts

# リモートDBから型生成
supabase gen types typescript --project-id <project-id> > apps/web/src/types/database.ts
```

**共有パッケージでの使用:**

```typescript
// packages/shared/src/types/index.ts
export type { Database } from '../../../apps/web/src/types/database';

// エイリアス定義（利便性向上）
export type Tables = Database['public']['Tables'];
export type SuccessCase = Tables['success_cases']['Row'];
export type Session = Tables['sessions']['Row'];
export type Staff = Tables['staffs']['Row'];
// ...
```

**注意事項:**
- TypeScriptコードでは snake_case を許容する
- DBスキーマ変更時は必ず型を再生成する
- 手動での型定義追加は原則禁止（RPC関数の戻り値等は例外）

### 12.2 環境変数一覧

| 変数名 | 説明 | 必須 | 例 |
|--------|------|------|-----|
| SUPABASE_URL | Supabase プロジェクトURL | ○ | https://xxx.supabase.co |
| SUPABASE_ANON_KEY | Supabase 匿名キー | ○ | eyJ... |
| SUPABASE_SERVICE_ROLE_KEY | Supabase サービスロールキー | ○ | eyJ... |
| ANTHROPIC_API_KEY | Claude API キー | ○ | sk-ant-... |
| OPENAI_API_KEY | OpenAI API キー | ○ | sk-... |
| PYANNOTE_SERVER_URL | pyannote サーバーURL | ○ | http://... |
| PYANNOTE_API_KEY | pyannote API キー | ○ | ... |
| PYANNOTE_CALLBACK_SECRET | Callback認証シークレット | ○ | ... |

### 12.3 依存ライブラリ一覧

#### フロントエンド（React Native / Next.js）

| ライブラリ | バージョン | 用途 |
|-----------|-----------|------|
| react | 18.x | UIフレームワーク |
| react-native | 0.73.x | モバイルアプリ |
| expo | ~50.x | React Native開発環境 |
| next | 14.x | Webフレームワーク |
| @supabase/supabase-js | 2.x | Supabaseクライアント |
| zustand | 4.x | 状態管理 |
| swr | 2.x | データフェッチング |
| zod | 3.x | バリデーション |
| recharts | 2.x | グラフ描画 |

#### バックエンド（Edge Functions）

| ライブラリ | バージョン | 用途 |
|-----------|-----------|------|
| @anthropic-ai/sdk | 0.x | Claude API |
| deno std | 0.177+ | Deno標準ライブラリ |

---
