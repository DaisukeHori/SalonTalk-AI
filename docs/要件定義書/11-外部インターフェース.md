## 11. 外部インターフェース

### 11.1 外部サービス一覧

| サービス | 用途 | 接続方式 |
|---------|------|---------|
| Supabase | BaaS（DB、Auth、Realtime） | REST API / WebSocket |
| Anthropic Claude | AI分析 | REST API |
| OpenAI | Embedding生成 | REST API |
| pyannote Server | 話者分離 | REST API（自己ホスト） |
| Apple Push Notification | プッシュ通知 | APNs |
| Stripe | 決済（将来） | REST API / Webhook |

### 11.2 インターフェース仕様

#### 11.2.1 Anthropic Claude API

**用途**: セッション分析、レポート生成、ロールプレイ

**接続情報**:
| 項目 | 値 |
|------|-----|
| エンドポイント | https://api.anthropic.com/v1/messages |
| 認証 | x-api-key ヘッダー |
| モデル | claude-sonnet-4-5-20250929 |

**リクエスト例**:
```typescript
const response = await anthropic.messages.create({
  model: "claude-sonnet-4-5-20250929",
  max_tokens: 4096,
  messages: [{
    role: "user",
    content: analysisPrompt
  }]
});
```

**エラーハンドリング**:
| HTTPステータス | 対応 |
|---------------|------|
| 429 | リトライ（指数バックオフ） |
| 500-503 | リトライ（最大3回） |
| 400 | ログ記録、ユーザー通知 |

#### 11.2.2 OpenAI Embedding API

**用途**: 成功事例のベクトル埋め込み生成

**接続情報**:
| 項目 | 値 |
|------|-----|
| エンドポイント | https://api.openai.com/v1/embeddings |
| 認証 | Bearer トークン |
| モデル | text-embedding-3-small |
| 次元数 | 1536 |

**リクエスト例**:
```typescript
const response = await openai.embeddings.create({
  model: "text-embedding-3-small",
  input: sceneDescription
});
const embedding = response.data[0].embedding;
```

#### 11.2.3 pyannote Server API

**用途**: 話者分離処理

**接続情報**:
| 項目 | 値 |
|------|-----|
| エンドポイント | http://{pyannote-server}/diarize/{session_id} |
| 認証 | API Key（カスタムヘッダー） |
| プロトコル | HTTP（内部ネットワーク） |

**リクエスト**:
- Method: POST
- Content-Type: multipart/form-data
- Body: audio (WAVファイル)

**レスポンス**:
```json
{
  "status": "processing",
  "session_id": "uuid",
  "callback_url": "https://..."
}
```

### 11.3 外部データ連携（将来計画）

#### 11.3.1 POSシステム連携

**対象システム**: サロンアンサー、Bionly等

**連携データ**:
- お客様情報（年代、来店履歴）
- 購買履歴
- 予約情報

**連携方式**: REST API / CSVインポート

#### 11.3.2 予約システム連携

**対象システム**: ホットペッパービューティー、各種予約システム

**連携データ**:
- 予約情報
- お客様属性

---
