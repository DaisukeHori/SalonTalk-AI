## 12. 運用・保守要件

### 12.1 運用体制

| 役割 | 担当 | 責務 |
|------|------|------|
| システム運用 | PM + AI | 監視、障害対応、デプロイ |
| カスタマーサポート | 専任（Phase 2〜） | 問い合わせ対応、オンボーディング |
| 開発保守 | PM + AI | バグ修正、機能追加 |

### 12.2 監視要件

#### 12.2.1 監視項目

| 項目 | 閾値 | アラート先 |
|------|------|-----------|
| APIレスポンスタイム | 平均 > 3秒 | Slack |
| エラー率 | > 1% | Slack + メール |
| CPU使用率（pyannote） | > 80% | Slack |
| ディスク使用率 | > 80% | Slack |
| セッション異常終了 | > 5%/日 | Slack |

#### 12.2.2 監視ツール

| ツール | 用途 |
|--------|------|
| Supabase Dashboard | DB監視、ログ確認 |
| Vercel Analytics | Webパフォーマンス |
| Sentry | エラートラッキング |
| UptimeRobot | 死活監視 |

### 12.3 バックアップ・リカバリ

#### 12.3.1 バックアップ方針

| 対象 | 方式 | 頻度 | 保持期間 |
|------|------|------|---------|
| PostgreSQL | Supabase自動バックアップ | 日次 | 7日 |
| PostgreSQL（追加） | pg_dump | 週次 | 30日 |
| ファイルストレージ | Supabase Storage | リアルタイム | - |
| 設定ファイル | Git | 変更時 | 無期限 |

#### 12.3.2 リカバリ手順

**RTO**: 4時間以内
**RPO**: 1時間以内

1. Supabaseの自動バックアップからリストア
2. 必要に応じて手動バックアップから差分適用
3. アプリケーション再デプロイ
4. 動作確認

### 12.4 デプロイメント

#### 12.4.1 デプロイ方式

| コンポーネント | デプロイ方式 |
|--------------|------------|
| Webアプリ | Vercel自動デプロイ（GitHub連携） |
| Edge Functions | Supabase CLI |
| iPadアプリ | App Store Connect |
| pyannote Server | Docker + SSH |

#### 12.4.2 デプロイフロー

```
開発 → PR作成 → レビュー → マージ（main）
                              ↓
                   ┌──────────┴──────────┐
                   ▼                     ▼
             Vercel自動デプロイ     Supabase自動デプロイ
             (Preview → Production)  (Edge Functions)
```

### 12.5 SLA

| 項目 | 目標 |
|------|------|
| 稼働率 | 99.5% |
| 計画メンテナンス | 月4時間以内（深夜実施） |
| 障害復旧時間 | 4時間以内 |
| サポート応答時間 | 24時間以内（営業日） |

---
