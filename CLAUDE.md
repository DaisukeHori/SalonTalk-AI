# SalonTalk AI - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

> **âš ï¸ é‡è¦: è©³ç´°è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦**
>
> ã“ã®CLAUDE.mdã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ã¨é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚
> **å®Ÿè£…ã§è¿·ã£ãŸå ´åˆã‚„è©³ç´°ãªä»•æ§˜ãŒå¿…è¦ãªå ´åˆã¯ã€å¿…ãšä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š**
>
> | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ‘ã‚¹ | å‚ç…§ã™ã¹ãå ´é¢ |
> |-------------|------|---------------|
> | **ä¼ç”»æ›¸** | `docs/ä¼ç”»æ›¸/` | ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã€å¸‚å ´åˆ†æã€è²¡å‹™è¨ˆç”»ã€ç«¶åˆåˆ†æ |
> | **è¦ä»¶å®šç¾©æ›¸** | `docs/è¦ä»¶å®šç¾©æ›¸/` | æ©Ÿèƒ½è¦ä»¶(FR-xxx)ã€éæ©Ÿèƒ½è¦ä»¶ã€å—ã‘å…¥ã‚ŒåŸºæº–ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ |
> | **åŸºæœ¬è¨­è¨ˆæ›¸** | `docs/åŸºæœ¬è¨­è¨ˆæ›¸/` | ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ç”»é¢è¨­è¨ˆã€APIè¨­è¨ˆã€ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ |
> | **è©³ç´°è¨­è¨ˆæ›¸** | `docs/è©³ç´°è¨­è¨ˆæ›¸/` | ã‚¯ãƒ©ã‚¹è¨­è¨ˆã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€DBç‰©ç†è¨­è¨ˆã€ãƒ†ã‚¹ãƒˆä»•æ§˜ |
>
> **å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç« ã”ã¨ã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ã€‚å„ãƒ•ã‚©ãƒ«ãƒ€ã® `README.md` ã‹ã‚‰ç›®æ¬¡ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**
>
> ---
>
> **ğŸ“Œ è¨­è¨ˆæ›¸ã®æ­£æœ¬ã«ã¤ã„ã¦ï¼ˆ2025-12-05æ›´æ–°ï¼‰**
>
> - **æ­£æœ¬**: `docs/ä¼ç”»æ›¸/`, `docs/è¦ä»¶å®šç¾©æ›¸/`, `docs/åŸºæœ¬è¨­è¨ˆæ›¸/`, `docs/è©³ç´°è¨­è¨ˆæ›¸/` ã®åˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«
> - **å»ƒæ­¢**: `SalonTalk-AI-*-v1.0.md` ã®ä¸€ä½“åŒ–ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤æ¸ˆã¿ï¼ˆå†…å®¹ãŒåŒä¸€ã®ãŸã‚ï¼‰
> - **æ›´æ–°ãƒ«ãƒ¼ãƒ«**: è¨­è¨ˆæ›¸ã®æ›´æ–°ã¯å¿…ãšåˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦è¡Œã†ã“ã¨
> - **ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ**: `docs/design-review-report.md` ã«è¨­è¨ˆæ›¸é–“ã®æ•´åˆæ€§å•é¡Œã‚’è¨˜è¼‰

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**SalonTalk AI**ã¯ã€ç¾å®¹å®¤ã«ãŠã‘ã‚‹æ¥å®¢ä¼šè©±ã‚’AIãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åˆ†æã—ã€ãƒˆãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒªã‚¹ãƒˆã®ã€Œå£²ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¯è¦–åŒ–ãƒ»å…±æœ‰ã™ã‚‹ã“ã¨ã§ã€åº—èˆ—å…¨ä½“ã®å£²ä¸Šå‘ä¸Šã¨äººæè‚²æˆã®åŠ¹ç‡åŒ–ã‚’å®Ÿç¾ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ãƒŸãƒƒã‚·ãƒ§ãƒ³
ã€Œå£²ã‚Œã‚‹ç¾å®¹å¸«ã®æš—é»™çŸ¥ã‚’ç§‘å­¦ã—ã€å†ç¾å¯èƒ½ãªã‚¹ã‚­ãƒ«ã«å¤‰æ›ã™ã‚‹ã€

### è§£æ±ºã™ã‚‹èª²é¡Œ
- ã‚¹ã‚¿ãƒƒãƒ•é–“å£²ä¸Šæ ¼å·®ï¼ˆãƒˆãƒƒãƒ—:å¹³å‡ = 3.3:1 â†’ 2:1ä»¥ä¸‹ã¸ï¼‰
- æ–°äººæ—©æœŸé›¢è·ï¼ˆ3å¹´æœªæº€36.7%é›¢è· â†’ 30%å‰Šæ¸›ï¼‰
- åº—è²©è‹¦æ‰‹æ„è­˜ï¼ˆ70%ãŒè‹¦æ‰‹ â†’ è³¼å…¥ç‡20%å‘ä¸Šï¼‰

### æœŸå¾…åŠ¹æœ
- åº—è²©å£²ä¸Šå‘ä¸Š: +20ã€œ36%
- è‚²æˆæœŸé–“çŸ­ç¸®: 50%
- é›¢è·ç‡ä½ä¸‹: -30%

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| é ˜åŸŸ | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| iPadã‚¢ãƒ—ãƒª | React Native + Expo (~50.x) | æ–½è¡“è€…å‘ã‘UI |
| Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | Next.js 14 + TypeScript | ç®¡ç†è€…å‘ã‘UI |
| çŠ¶æ…‹ç®¡ç† | Zustand 4.x | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ |
| ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ | SWR 2.x | ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿åŒæœŸ |
| UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | Tailwind CSS, NativeWind | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| ã‚°ãƒ©ãƒ• | Recharts 2.x | åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | Zod 3.x | ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| é ˜åŸŸ | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| BaaS | Supabase | PostgreSQL + Auth + Realtime + Storage + Edge Functions |
| ãƒ™ã‚¯ãƒˆãƒ«DB | pgvector (Supabase) | æˆåŠŸäº‹ä¾‹ã®é¡ä¼¼æ¤œç´¢ |
| è©±è€…åˆ†é›¢ã‚µãƒ¼ãƒãƒ¼ | FastAPI + pyannote.audio 3.x | è©±è€…åˆ†é›¢å‡¦ç† |
| ã‚­ãƒ¥ãƒ¼å‡¦ç† | Supabase pg_net / Edge Functions | éåŒæœŸå‡¦ç† |

### AI/ML

| é ˜åŸŸ | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| æ–‡å­—èµ·ã“ã— | Apple SpeechAnalyzer (iOS 26+) | ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹éŸ³å£°èªè­˜ |
| è©±è€…åˆ†é›¢ | pyannote.audio 3.1 | ç¾å®¹å¸«/ãŠå®¢æ§˜ã®ç™ºè©±åˆ†é›¢ |
| AIåˆ†æ | Claude Sonnet 4.5 | 7æŒ‡æ¨™ãƒˆãƒ¼ã‚¯åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ |
| åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ | OpenAI text-embedding-3-small | ãƒ™ã‚¯ãƒˆãƒ«åŒ– |

### ã‚¤ãƒ³ãƒ•ãƒ©

| é ˜åŸŸ | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | Vercel | Next.js Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ |
| ãƒ¢ãƒã‚¤ãƒ«é…ä¿¡ | Expo EAS | iPadã‚¢ãƒ—ãƒªé…ä¿¡ |
| GPUå‡¦ç† | VAST.ai / RunPod | pyannoteè©±è€…åˆ†é›¢ |
| ç›£è¦– | Sentry, Supabase Logs | ã‚¨ãƒ©ãƒ¼è¿½è·¡ãƒ»ãƒ­ã‚° |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
salontalk-ai/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ mobile/                     # React Native iPadã‚¢ãƒ—ãƒª
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/                # Expo Routerç”»é¢å®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ components/         # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ session/        # ã‚»ãƒƒã‚·ãƒ§ãƒ³é–¢é€£
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ analysis/       # åˆ†æè¡¨ç¤º
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ common/         # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/              # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”‚   â”œâ”€â”€ services/           # APIãƒ»å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
â”‚   â”‚   â”‚   â”œâ”€â”€ stores/             # ZustandçŠ¶æ…‹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”‚   â””â”€â”€ types/              # å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ app.json
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â””â”€â”€ web/                        # Next.js Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app/                # App Router
â”‚       â”‚   â”‚   â”œâ”€â”€ (auth)/         # èªè¨¼ãƒ«ãƒ¼ãƒˆ
â”‚       â”‚   â”‚   â”œâ”€â”€ (dashboard)/    # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚       â”‚   â”‚   â””â”€â”€ api/            # API Routes
â”‚       â”‚   â”œâ”€â”€ components/         # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ hooks/              # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚       â”‚   â”œâ”€â”€ lib/                # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®š
â”‚       â”‚   â””â”€â”€ types/              # å‹å®šç¾©
â”‚       â”œâ”€â”€ next.config.js
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/                     # å…±æœ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ domain/             # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
â”‚       â”‚   â”‚   â”œâ”€â”€ entities/       # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚       â”‚   â”‚   â”œâ”€â”€ valueObjects/   # å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚       â”‚   â”‚   â””â”€â”€ services/       # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚       â”‚   â”œâ”€â”€ types/              # å…±æœ‰å‹å®šç¾©
â”‚       â”‚   â”œâ”€â”€ constants/          # å®šæ•°
â”‚       â”‚   â””â”€â”€ utils/              # å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ pyannote/                   # è©±è€…åˆ†é›¢ã‚µãƒ¼ãƒãƒ¼
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ main.py             # FastAPIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ routes/             # APIãƒ«ãƒ¼ãƒˆ
â”‚       â”‚   â”œâ”€â”€ services/           # è©±è€…åˆ†é›¢ã‚µãƒ¼ãƒ“ã‚¹
â”‚       â”‚   â””â”€â”€ models/             # Pydanticãƒ¢ãƒ‡ãƒ«
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â”œâ”€â”€ requirements.txt
â”‚       â””â”€â”€ pyproject.toml
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ functions/                  # Edge Functions
â”‚   â”‚   â”œâ”€â”€ create-session/         # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
â”‚   â”‚   â”œâ”€â”€ end-session/            # ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
â”‚   â”‚   â”œâ”€â”€ process-transcription/  # æ–‡å­—èµ·ã“ã—å‡¦ç†
â”‚   â”‚   â”œâ”€â”€ analyze-conversation/   # ä¼šè©±åˆ†æ
â”‚   â”‚   â”œâ”€â”€ generate-report/        # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ search-success-cases/   # æˆåŠŸäº‹ä¾‹æ¤œç´¢
â”‚   â”‚   â””â”€â”€ _shared/                # å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ migrations/                 # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ seed/                       # åˆæœŸãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ config.toml
â”‚
â”œâ”€â”€ docs/                           # è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆâ€»å®Ÿè£…æ™‚ã¯å¿…ãšå‚ç…§ï¼‰
â”‚   â”œâ”€â”€ ä¼ç”»æ›¸/                     # ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ãƒ»è²¡å‹™è¨ˆç”»ï¼ˆç« ã”ã¨ã«åˆ†å‰²ï¼‰
â”‚   â”œâ”€â”€ è¦ä»¶å®šç¾©æ›¸/                 # æ©Ÿèƒ½è¦ä»¶ãƒ»éæ©Ÿèƒ½è¦ä»¶ï¼ˆç« ã”ã¨ã«åˆ†å‰²ï¼‰
â”‚   â”œâ”€â”€ åŸºæœ¬è¨­è¨ˆæ›¸/                 # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ç”»é¢è¨­è¨ˆï¼ˆç« ã”ã¨ã«åˆ†å‰²ï¼‰
â”‚   â””â”€â”€ è©³ç´°è¨­è¨ˆæ›¸/                 # ã‚¯ãƒ©ã‚¹è¨­è¨ˆãƒ»ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆç« ã”ã¨ã«åˆ†å‰²ï¼‰
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/                  # CI/CD
â”‚
â”œâ”€â”€ CLAUDE.md                       # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package.json                    # ãƒ«ãƒ¼ãƒˆpackage.jsonï¼ˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ turbo.json                      # Turborepoè¨­å®š
```

---

## ä¸»è¦æ©Ÿèƒ½ã¨å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

### 1. éŸ³å£°å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
iPadãƒã‚¤ã‚¯ â†’ SpeechAnalyzer(æ–‡å­—èµ·ã“ã—) â†’ 1åˆ†ãƒãƒ£ãƒ³ã‚¯é€ä¿¡ â†’ pyannote(è©±è€…åˆ†é›¢) â†’ DBä¿å­˜
```

#### å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ
- **Apple SpeechAnalyzer**: `@react-native-ai/apple`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨
- **éŸ³å£°ãƒãƒ£ãƒ³ã‚¯**: 60ç§’å˜ä½ã§WAVå½¢å¼
- **è©±è€…åˆ†é›¢**: pyannoteã‚µãƒ¼ãƒãƒ¼ã¸éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ éåŒæœŸå‡¦ç† â†’ Webhookã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **è©±è€…æ¨å®š**: ç™ºè©±æ™‚é–“ãŒé•·ã„æ–¹ã‚’ç¾å®¹å¸«ã¨æ¨å®š

### 2. AIåˆ†æï¼ˆ7æŒ‡æ¨™ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼‰

| æŒ‡æ¨™ | é‡ã¿ | èª¬æ˜ | ç†æƒ³å€¤ |
|------|------|------|--------|
| ãƒˆãƒ¼ã‚¯æ¯”ç‡ | 25% | ç¾å®¹å¸«ã¨ãŠå®¢æ§˜ã®ç™ºè©±æ¯”ç‡ | 40:60 |
| è³ªå•ã®è³ª | 20% | ã‚ªãƒ¼ãƒ—ãƒ³è³ªå•ã®å‰²åˆ | 60%ä»¥ä¸Š |
| æ„Ÿæƒ…åˆ†æ | 15% | ãƒã‚¸ãƒ†ã‚£ãƒ–æ„Ÿæƒ…ã®ç¶­æŒ | 70%ä»¥ä¸Š |
| æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡º | 15% | é«ªã®æ‚©ã¿ã®æŠŠæ¡ | 2å€‹ä»¥ä¸Š |
| ææ¡ˆã‚¿ã‚¤ãƒŸãƒ³ã‚° | 10% | æ‚©ã¿æ¤œå‡ºã‹ã‚‰ææ¡ˆã¾ã§ã®æ™‚é–“ | 3åˆ†ä»¥å†… |
| ææ¡ˆã®è³ª | 10% | æ‚©ã¿ã«å¯¾å¿œã—ãŸææ¡ˆã‹ | 80%ãƒãƒƒãƒ |
| æˆç´„æœ‰ç„¡ | 5% | åº—è²©è³¼å…¥ã®æœ‰ç„¡ | æˆç´„ |

#### Claudeåˆ†æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹
```typescript
const ANALYSIS_SYSTEM_PROMPT = `
ã‚ãªãŸã¯ç¾å®¹å®¤ã®æ¥å®¢ä¼šè©±ã‚’åˆ†æã™ã‚‹å°‚é–€å®¶ã§ã™ã€‚
ä»¥ä¸‹ã®ä¼šè©±ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’åˆ†æã—ã€7ã¤ã®æŒ‡æ¨™ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚

## åˆ†ææŒ‡æ¨™
1. ãƒˆãƒ¼ã‚¯æ¯”ç‡ï¼ˆç¾å®¹å¸«:ãŠå®¢æ§˜ = 40:60ãŒç†æƒ³ï¼‰
2. è³ªå•ã®è³ªï¼ˆã‚ªãƒ¼ãƒ—ãƒ³è³ªå•ã®å‰²åˆï¼‰
3. æ„Ÿæƒ…åˆ†æï¼ˆãƒã‚¸ãƒ†ã‚£ãƒ–è¡¨ç¾ã®å‰²åˆï¼‰
4. æ‚©ã¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¹¾ç‡¥ã€ãƒ‘ã‚µã¤ãã€åºƒãŒã‚‹ç­‰ï¼‰
5. ææ¡ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆæ‚©ã¿æ¤œå‡ºã‹ã‚‰ææ¡ˆã¾ã§ã®æ™‚é–“ï¼‰
6. ææ¡ˆã®è³ªï¼ˆæ‚©ã¿ã«å¯¾å¿œã—ãŸå•†å“ææ¡ˆï¼‰
7. æˆç´„æœ‰ç„¡

## å‡ºåŠ›å½¢å¼
JSONå½¢å¼ã§ä»¥ä¸‹ã®æ§‹é€ ã§å‡ºåŠ›ã—ã¦ãã ã•ã„:
{
  "overallScore": number, // 0-100
  "metrics": {
    "talkRatio": { "score": number, "stylistRatio": number, "details": string },
    "questionQuality": { "score": number, "openRatio": number, "details": string },
    ...
  },
  "improvements": string[],
  "highlights": string[]
}
`;
```

### 3. æˆåŠŸäº‹ä¾‹ãƒãƒƒãƒãƒ³ã‚°

```typescript
// ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼ˆpgvectorï¼‰
const searchSuccessCases = async (concernKeywords: string[], limit = 5) => {
  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’çµåˆã—ã¦embeddingç”Ÿæˆ
  const queryText = concernKeywords.join(' ');
  const embedding = await generateEmbedding(queryText);
  
  // ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã§æ¤œç´¢
  const { data } = await supabase.rpc('search_success_cases', {
    query_embedding: embedding,
    match_threshold: 0.7,
    match_count: limit,
  });
  
  return data;
};
```

### 4. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥

```typescript
// Supabase Realtimeã§ã‚¹ã‚³ã‚¢æ›´æ–°ã‚’é…ä¿¡
const channel = supabase.channel(`session:${sessionId}`);

channel.on('broadcast', { event: 'score_update' }, (payload) => {
  setCurrentScore(payload.score);
});

channel.on('broadcast', { event: 'proposal_timing' }, (payload) => {
  showProposalNotification(payload.suggestion);
});

channel.subscribe();
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

> **ğŸ“Œ æ­£æœ¬**: `supabase/migrations/00000000000000_initial_schema.sql`
> **ğŸ“Œ è©³ç´°**: `docs/è©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.md`

### åº—èˆ—ãƒ»ã‚¹ã‚¿ãƒƒãƒ•

```sql
-- åº—èˆ—
CREATE TABLE salons (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  plan TEXT NOT NULL DEFAULT 'free' CHECK (plan IN ('free', 'standard', 'premium', 'enterprise')),
  settings JSONB NOT NULL DEFAULT '{}'::jsonb,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆid = auth.users(id) ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
CREATE TABLE staffs (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  salon_id UUID NOT NULL REFERENCES salons(id) ON DELETE CASCADE,
  email TEXT NOT NULL,
  name TEXT NOT NULL,
  role TEXT NOT NULL DEFAULT 'stylist' CHECK (role IN ('stylist', 'manager', 'owner', 'admin')),
  is_active BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»åˆ†æ

```sql
-- ã‚»ãƒƒã‚·ãƒ§ãƒ³
CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  salon_id UUID NOT NULL REFERENCES salons(id) ON DELETE CASCADE,
  stylist_id UUID NOT NULL REFERENCES staffs(id) ON DELETE CASCADE,
  status TEXT NOT NULL DEFAULT 'recording' CHECK (status IN ('recording', 'processing', 'analyzing', 'completed', 'error')),
  customer_info JSONB DEFAULT '{}'::jsonb,
  started_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  ended_at TIMESTAMPTZ,
  total_duration_ms INTEGER,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- è©±è€…ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆãƒŸãƒªç§’å˜ä½ï¼‰
CREATE TABLE speaker_segments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id UUID NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
  chunk_index INTEGER NOT NULL,
  speaker TEXT NOT NULL CHECK (speaker IN ('stylist', 'customer', 'unknown')),
  text TEXT NOT NULL,
  start_time_ms INTEGER NOT NULL,  -- ãƒŸãƒªç§’
  end_time_ms INTEGER NOT NULL,    -- ãƒŸãƒªç§’
  confidence REAL DEFAULT 1.0,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- åˆ†æçµæœï¼ˆæ­£è¦åŒ–æ§‹é€ ï¼‰
CREATE TABLE session_analyses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id UUID NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
  chunk_index INTEGER NOT NULL,
  indicator_type TEXT NOT NULL CHECK (indicator_type IN (
    'talk_ratio', 'question_analysis', 'emotion_analysis',
    'concern_keywords', 'proposal_timing', 'proposal_quality', 'conversion'
  )),
  value NUMERIC(10, 4) NOT NULL,
  score INTEGER NOT NULL CHECK (score >= 0 AND score <= 100),
  details JSONB,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  CONSTRAINT session_analyses_unique UNIQUE (session_id, chunk_index, indicator_type)
);
```

### æˆåŠŸäº‹ä¾‹ï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼‰

```sql
-- pgvectoræ‹¡å¼µã®æœ‰åŠ¹åŒ–
CREATE EXTENSION IF NOT EXISTS vector;

-- æˆåŠŸäº‹ä¾‹
CREATE TABLE success_cases (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  salon_id UUID REFERENCES salons(id),
  concern_keywords TEXT[] NOT NULL,
  approach_text TEXT NOT NULL,
  result TEXT NOT NULL,
  conversion_rate REAL,
  embedding VECTOR(1536), -- OpenAI text-embedding-3-small
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX ON success_cases 
  USING ivfflat (embedding vector_cosine_ops)
  WITH (lists = 100);

-- é¡ä¼¼æ¤œç´¢é–¢æ•°
CREATE OR REPLACE FUNCTION search_success_cases(
  query_embedding VECTOR(1536),
  match_threshold FLOAT,
  match_count INT
)
RETURNS TABLE (
  id UUID,
  concern_keywords TEXT[],
  approach_text TEXT,
  result TEXT,
  similarity FLOAT
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    sc.id,
    sc.concern_keywords,
    sc.approach_text,
    sc.result,
    1 - (sc.embedding <=> query_embedding) AS similarity
  FROM success_cases sc
  WHERE 1 - (sc.embedding <=> query_embedding) > match_threshold
  ORDER BY sc.embedding <=> query_embedding
  LIMIT match_count;
END;
$$;
```

---

## APIè¨­è¨ˆ

### Edge Functionsä¸€è¦§

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---------------|---------|------|
| `/create-session` | POST | ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ |
| `/end-session` | POST | ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† |
| `/process-transcription` | POST | æ–‡å­—èµ·ã“ã—ãƒãƒ£ãƒ³ã‚¯å‡¦ç† |
| `/diarization-callback` | POST | pyannoteã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| `/analyze-conversation` | POST | ä¼šè©±åˆ†æå®Ÿè¡Œ |
| `/generate-report` | POST | ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ |
| `/search-success-cases` | POST | æˆåŠŸäº‹ä¾‹æ¤œç´¢ |

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

> **ğŸ“Œ å…¨ã¦ snake_case ã‚’ä½¿ç”¨ï¼ˆ2025-12-05 çµ±ä¸€ï¼‰**

```typescript
// ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
// POST /create-session
interface CreateSessionRequest {
  stylist_id: string;
  customer_info?: {
    age_group?: '10s' | '20s' | '30s' | '40s' | '50s' | '60s';
    gender?: 'male' | 'female' | 'other';
    visit_type?: 'new' | 'repeat';
  };
}

interface CreateSessionResponse {
  session_id: string;
  status: 'recording';
  realtime_channel: string;
  started_at: string;
}

// ä¼šè©±åˆ†æ
// POST /analyze-conversation
interface AnalyzeConversationRequest {
  session_id: string;
  chunk_index: number;
  segments: SpeakerSegment[];
}

interface AnalyzeConversationResponse {
  overall_score: number;
  metrics: {
    talk_ratio: MetricResult;
    question_quality: MetricResult;
    emotion: MetricResult;
    concern_keywords: MetricResult;
    proposal_timing: MetricResult;
    proposal_quality: MetricResult;
    conversion: MetricResult;
  };
  suggestions: string[];
  matched_success_cases: SuccessCase[];
}
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### Row Level Security (RLS)

```sql
-- åº—èˆ—: æ‰€å±ã‚¹ã‚¿ãƒƒãƒ•ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
ALTER TABLE salons ENABLE ROW LEVEL SECURITY;

CREATE POLICY "salons_access" ON salons
  USING (
    id IN (
      SELECT salon_id FROM staffs WHERE id = auth.uid()
    )
  );

-- ã‚»ãƒƒã‚·ãƒ§ãƒ³: åŒä¸€åº—èˆ—ã®ã‚¹ã‚¿ãƒƒãƒ•ã®ã¿
ALTER TABLE sessions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "sessions_access" ON sessions
  USING (
    salon_id IN (
      SELECT salon_id FROM staffs WHERE id = auth.uid()
    )
  );
```

### èªè¨¼ãƒ•ãƒ­ãƒ¼

1. Supabase Authï¼ˆãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
2. JWTãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
3. RLSã§åº—èˆ—å˜ä½ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
4. Edge Functionsã§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å¯¾ç­–

- éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã¯å‡¦ç†å¾Œ24æ™‚é–“ã§è‡ªå‹•å‰Šé™¤
- ãŠå®¢æ§˜ã¸ã®äº‹å‰åŒæ„å–å¾—ï¼ˆã‚¢ãƒ—ãƒªå†…ã§åŒæ„ãƒ•ãƒ­ãƒ¼ï¼‰
- å›½å†…ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆTokyoï¼‰ã§ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- ä¼šè©±ãƒ†ã‚­ã‚¹ãƒˆã®æš—å·åŒ–ä¿å­˜

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

#### TypeScript

> **ğŸ“Œ 2025-12-05: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆå‹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã¯ snake_case ã«çµ±ä¸€**

```typescript
// å‘½åè¦å‰‡
const sessionId: string;              // ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°: camelCase å¯
const MAX_CHUNK_DURATION = 60;        // å®šæ•°: UPPER_SNAKE_CASE
function createSession() {}           // é–¢æ•°: camelCase

// ğŸ”´ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆå‹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰: snake_case å¿…é ˆ
interface SessionData {
  session_id: string;        // âœ… snake_case
  started_at: string;        // âœ… snake_case
  customer_info: object;     // âœ… snake_case
}

// ãƒ•ã‚¡ã‚¤ãƒ«å
// components/SessionCard.tsx          # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase
// utils/format-date.ts                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: kebab-case
// hooks/use-session.ts                # ãƒ•ãƒƒã‚¯: kebab-case

// ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åº
import React from 'react';              // 1. React
import { useQuery } from 'swr';         // 2. å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
import { supabase } from '@/lib/supabase'; // 3. å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆçµ¶å¯¾ãƒ‘ã‚¹ï¼‰
import { Button } from '../components'; // 4. ç›¸å¯¾ãƒ‘ã‚¹
import type { Session } from '@/types'; // 5. å‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```

#### SQL

```sql
-- ãƒ†ãƒ¼ãƒ–ãƒ«å: snake_caseï¼ˆè¤‡æ•°å½¢ï¼‰
CREATE TABLE speaker_segments (...);

-- ã‚«ãƒ©ãƒ å: snake_case
started_at TIMESTAMPTZ

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å: idx_{table}_{columns}
CREATE INDEX idx_sessions_salon_id ON sessions(salon_id);

-- åˆ¶ç´„å: {table}_{constraint_type}_{description}
CONSTRAINT sessions_fk_salon FOREIGN KEY (salon_id) REFERENCES salons(id)
```

### Gitè¦ç´„

```
# ãƒ–ãƒ©ãƒ³ãƒå‘½å
feature/add-session-recording
fix/audio-chunk-error
refactor/analysis-service

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆConventional Commitsï¼‰
feat(session): add real-time score display
fix(audio): resolve chunk upload timeout
docs(readme): update installation guide
refactor(analysis): extract metric calculators
test(session): add integration tests
```

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

```
ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚        E2E Tests          â”‚  10%
  â”‚     (Playwright/Detox)    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚    Integration Tests      â”‚  20%
  â”‚    (Supabase + Jest)      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚       Unit Tests          â”‚  70%
  â”‚    (Jest/Vitest)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- Unit Tests: 80%
- Integration Tests: ä¸»è¦ãƒ•ãƒ­ãƒ¼å…¨ã¦
- E2E Tests: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹

---

## é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åˆæœŸç‰ˆé–‹ç™ºï¼ˆ3ãƒ¶æœˆï¼‰

**ç›®æ¨™**: åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…ã€Prestoã‚°ãƒ«ãƒ¼ãƒ—3åº—èˆ—ã§Î²ãƒ†ã‚¹ãƒˆ

| é€± | ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ |
|----|--------------|
| 1-2 | é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ã€CI/CDè¨­å®š |
| 3-4 | éŸ³å£°å‡¦ç†ï¼ˆSpeechAnalyzerçµ±åˆï¼‰ |
| 5-6 | è©±è€…åˆ†é›¢ï¼ˆpyannoteã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰ï¼‰ |
| 7-8 | AIåˆ†æï¼ˆClaudeçµ±åˆã€åŸºæœ¬åˆ†æï¼‰ |
| 9-10 | iPad UIï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»é¢ï¼‰ |
| 11-12 | Î²ãƒ†ã‚¹ãƒˆã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›† |

**æˆæœç‰©**:
- iPadã‚¢ãƒ—ãƒª v0.1
- ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v0.1
- pyannoteã‚µãƒ¼ãƒãƒ¼

### Phase 2: AIåˆ†æå¼·åŒ–ï¼ˆ6ãƒ¶æœˆï¼‰

**ç›®æ¨™**: AIåˆ†æç²¾åº¦å‘ä¸Šã€10åº—èˆ—ã«æ‹¡å¤§

- æˆåŠŸäº‹ä¾‹DBæ§‹ç¯‰ï¼ˆpgvectorï¼‰
- é¡ä¼¼äº‹ä¾‹æ¤œç´¢æ©Ÿèƒ½
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚·ã‚¹ãƒˆï¼ˆææ¡ˆé€šçŸ¥ï¼‰
- ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°æ”¹å–„

### Phase 3: æ•™è‚²æ©Ÿèƒ½è¿½åŠ ï¼ˆ9ãƒ¶æœˆï¼‰

**ç›®æ¨™**: æ•™è‚²æ©Ÿèƒ½è¿½åŠ ã€æ­£å¼ãƒ­ãƒ¼ãƒ³ãƒ

- AIãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½
- ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒãƒƒã‚¸ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼‰
- è¤‡æ•°åº—èˆ—çµ±åˆåˆ†æ

---

## ç’°å¢ƒå¤‰æ•°

```env
# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=eyJ...
SUPABASE_SERVICE_ROLE_KEY=eyJ...

# Anthropic
ANTHROPIC_API_KEY=sk-ant-xxx

# OpenAI
OPENAI_API_KEY=sk-xxx

# pyannote
PYANNOTE_SERVER_URL=http://xxx:8000
PYANNOTE_API_KEY=xxx
PYANNOTE_CALLBACK_SECRET=xxx
HUGGINGFACE_TOKEN=hf_xxx

# App
APP_ENV=development|staging|production
LOG_LEVEL=debug|info|warn|error
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å‡¦ |
|--------|------|------|
| `AUTH_001` | èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ | å†ãƒ­ã‚°ã‚¤ãƒ³ |
| `SES_004` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ | æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº† |
| `AI_001` | Claude APIã‚¨ãƒ©ãƒ¼ | ãƒªãƒˆãƒ©ã‚¤ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç¢ºèª |
| `DIA_001` | pyannoteã‚¨ãƒ©ãƒ¼ | ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèªã€ãƒªãƒˆãƒ©ã‚¤ |
| `NET_001` | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¨ãƒ©ãƒ¼ | æ¥ç¶šç¢ºèª |

### æ€§èƒ½ç›®æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¤ |
|------|--------|
| åŒæ™‚ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•° | 100ã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| APIå¿œç­”æ™‚é–“ï¼ˆP95ï¼‰ | 500msä»¥ä¸‹ |
| è©±è€…åˆ†é›¢å‡¦ç†æ™‚é–“ | 1åˆ†éŸ³å£° â†’ 1.5åˆ†ä»¥å†… |
| AIåˆ†æå‡¦ç†æ™‚é–“ | 1åˆ†ãƒãƒ£ãƒ³ã‚¯ â†’ 10ç§’ä»¥å†… |
| ã‚¨ãƒ©ãƒ¼ç‡ | 0.1%ä»¥ä¸‹ |

---

## å‚è€ƒãƒªãƒ³ã‚¯

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Supabase Documentation](https://supabase.com/docs)
- [React Native](https://reactnative.dev)
- [Expo](https://docs.expo.dev)
- [Next.js](https://nextjs.org/docs)
- [Anthropic Claude API](https://docs.anthropic.com)
- [OpenAI API](https://platform.openai.com/docs)
- [pyannote.audio](https://github.com/pyannote/pyannote-audio)
- [pgvector](https://github.com/pgvector/pgvector)

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­è¨ˆæ›¸ï¼ˆå®Ÿè£…æ™‚ã¯å¿…ãšå‚ç…§ï¼‰

> **ğŸ“Œ å®Ÿè£…ã§è¿·ã£ãŸã‚‰ã€ã¾ãšã“ã‚Œã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„**

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | ä¸»ãªå†…å®¹ |
|-------------|---------|---------|
| ä¼ç”»æ›¸ | `docs/ä¼ç”»æ›¸/README.md` | ãƒ“ã‚¸ãƒã‚¹ç›®æ¨™ã€å¸‚å ´åˆ†æã€ROIè¨ˆç®—ã€ç«¶åˆæ¯”è¼ƒ |
| è¦ä»¶å®šç¾©æ›¸ | `docs/è¦ä»¶å®šç¾©æ›¸/README.md` | æ©Ÿèƒ½è¦ä»¶ä¸€è¦§(FR-101ã€œ)ã€éæ©Ÿèƒ½è¦ä»¶ã€å—ã‘å…¥ã‚ŒåŸºæº– |
| åŸºæœ¬è¨­è¨ˆæ›¸ | `docs/åŸºæœ¬è¨­è¨ˆæ›¸/README.md` | ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã€ç”»é¢é·ç§»ã€APIä»•æ§˜ã€ERå›³ |
| è©³ç´°è¨­è¨ˆæ›¸ | `docs/è©³ç´°è¨­è¨ˆæ›¸/README.md` | TypeScriptã‚¯ãƒ©ã‚¹è¨­è¨ˆã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã€Claudeãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ãƒ†ã‚¹ãƒˆä»•æ§˜ |

---

## AIé–‹ç™ºè€…ï¼ˆClaude Code / Cursorï¼‰å‘ã‘æ³¨æ„äº‹é …

### âš ï¸ æœ€é‡è¦: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ãƒ«ãƒ¼ãƒ«

**å®Ÿè£…ã‚’å§‹ã‚ã‚‹å‰ã«ã€å¿…ãšé–¢é€£ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š**

```
å®Ÿè£…ã‚¿ã‚¹ã‚¯åˆ¥ã®å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:

â”œâ”€â”€ æ–°æ©Ÿèƒ½ã®å®Ÿè£…
â”‚   â”œâ”€â”€ ã¾ãš â†’ è¦ä»¶å®šç¾©æ›¸ï¼ˆFR-xxx ã§æ©Ÿèƒ½è¦ä»¶ã‚’ç¢ºèªï¼‰
â”‚   â”œâ”€â”€ æ¬¡ã« â†’ åŸºæœ¬è¨­è¨ˆæ›¸ï¼ˆç”»é¢è¨­è¨ˆã€APIè¨­è¨ˆã‚’ç¢ºèªï¼‰
â”‚   â””â”€â”€ æœ€å¾Œ â†’ è©³ç´°è¨­è¨ˆæ›¸ï¼ˆã‚¯ãƒ©ã‚¹è¨­è¨ˆã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ç¢ºèªï¼‰
â”‚
â”œâ”€â”€ API/Edge Functions ã®å®Ÿè£…
â”‚   â”œâ”€â”€ åŸºæœ¬è¨­è¨ˆæ›¸ â†’ APIä»•æ§˜ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
â”‚   â””â”€â”€ è©³ç´°è¨­è¨ˆæ›¸ â†’ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚
â”œâ”€â”€ UI/ç”»é¢ã®å®Ÿè£…
â”‚   â”œâ”€â”€ åŸºæœ¬è¨­è¨ˆæ›¸ â†’ ç”»é¢é·ç§»å›³ã€ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â””â”€â”€ è©³ç´°è¨­è¨ˆæ›¸ â†’ ç”»é¢é …ç›®è©³ç´°å®šç¾©
â”‚
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
â”‚   â”œâ”€â”€ åŸºæœ¬è¨­è¨ˆæ›¸ â†’ ERå›³ã€ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
â”‚   â””â”€â”€ è©³ç´°è¨­è¨ˆæ›¸ â†’ ç‰©ç†è¨­è¨ˆã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€RLS
â”‚
â”œâ”€â”€ AIåˆ†æãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ è¦ä»¶å®šç¾©æ›¸ â†’ 7æŒ‡æ¨™ã®å®šç¾©ã€ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–
â”‚   â””â”€â”€ è©³ç´°è¨­è¨ˆæ›¸ â†’ Claudeãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°
â”‚
â””â”€â”€ ãƒ†ã‚¹ãƒˆä½œæˆ
    â”œâ”€â”€ è¦ä»¶å®šç¾©æ›¸ â†’ å—ã‘å…¥ã‚ŒåŸºæº–
    â””â”€â”€ è©³ç´°è¨­è¨ˆæ›¸ â†’ ãƒ†ã‚¹ãƒˆä»•æ§˜ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
```

**ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ã€æ¨æ¸¬ã›ãšã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**

### å®Ÿè£…æ™‚ã®å„ªå…ˆé †ä½

1. **å‹å®‰å…¨æ€§**: TypeScriptã®å³æ ¼ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã€`any`ã¯ç¦æ­¢
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å…¨ã¦ã®APIã‚³ãƒ¼ãƒ«ã«try-catchã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
3. **ãƒ­ã‚°å‡ºåŠ›**: é‡è¦ãªå‡¦ç†ãƒã‚¤ãƒ³ãƒˆã§ãƒ­ã‚°å‡ºåŠ›ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡ï¼‰
4. **ãƒ†ã‚¹ãƒˆ**: æ–°æ©Ÿèƒ½ã«ã¯å¿…ãšãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 

### ã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ã®æ³¨æ„

```typescript
// âŒ é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³
const data: any = await response.json();

// âœ… æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
interface ApiResponse<T> {
  data: T | null;
  error: ApiError | null;
}

const response = await supabase.functions.invoke<Session>('create-session', {
  body: params,
});

if (response.error) {
  throw new AppError(response.error.code, response.error.message);
}

return response.data;
```

### Supabase Edge Functions ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```typescript
// supabase/functions/[function-name]/index.ts
import { serve } from 'https://deno.land/std@0.177.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
import { corsHeaders } from '../_shared/cors.ts';

serve(async (req: Request) => {
  // CORSãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆ
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    // èªè¨¼ãƒã‚§ãƒƒã‚¯
    const authHeader = req.headers.get('Authorization');
    if (!authHeader) {
      throw new Error('No authorization header');
    }

    const supabase = createClient(
      Deno.env.get('SUPABASE_URL')!,
      Deno.env.get('SUPABASE_ANON_KEY')!,
      {
        global: { headers: { Authorization: authHeader } },
      }
    );

    const { data: { user }, error: authError } = await supabase.auth.getUser();
    if (authError || !user) {
      throw new Error('Unauthorized');
    }

    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£å–å¾—
    const body = await req.json();

    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    // ...

    return new Response(
      JSON.stringify({ data: result }),
      {
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        status: 200,
      }
    );
  } catch (error) {
    return new Response(
      JSON.stringify({ error: { message: error.message } }),
      {
        headers: { ...corsHeaders, 'Content-Type': 'application/json' },
        status: 400,
      }
    );
  }
});
```

### React Native ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```tsx
// apps/mobile/src/components/session/SessionCard.tsx
import React from 'react';
import { View, Text, Pressable } from 'react-native';
import type { Session } from '@/types';

interface SessionCardProps {
  session: Session;
  onPress?: () => void;
}

export const SessionCard: React.FC<SessionCardProps> = ({ session, onPress }) => {
  return (
    <Pressable
      onPress={onPress}
      className="bg-white rounded-lg p-4 shadow-sm"
      testID="session-card"
    >
      <View className="flex-row justify-between items-center">
        <Text className="text-lg font-semibold">{session.customerInfo?.name ?? 'é¡§å®¢æƒ…å ±ãªã—'}</Text>
        <Text className="text-sm text-gray-500">{formatDate(session.startedAt)}</Text>
      </View>
      <View className="mt-2">
        <Text className="text-2xl font-bold text-blue-600">{session.overallScore ?? '--'}</Text>
        <Text className="text-sm text-gray-500">ç·åˆã‚¹ã‚³ã‚¢</Text>
      </View>
    </Pressable>
  );
};
```

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|---------|
| 1.2 | 2025-12-05 | **snake_case çµ±ä¸€è¦å‰‡ã‚’è¿½åŠ **ï¼ˆå…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ snake_case ä½¿ç”¨ã‚’å¿…é ˆåŒ–ï¼‰ |
| 1.1 | 2025-12-05 | å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ  |
| 1.0 | 2025-12-04 | åˆç‰ˆä½œæˆ |

---

## ğŸ”´ snake_case çµ±ä¸€è¦å‰‡ï¼ˆæœ€é‡è¦ï¼‰

> **âš ï¸ 2025-12-05 æ±ºå®š: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ snake_case ã‚’ä½¿ç”¨**
>
> ä¼ç”»ãƒ»è¨­è¨ˆãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»APIãƒ»UIãƒ»Edge Functions ç­‰ã€å…¨ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãŠã„ã¦ **snake_case ã®ã¿** ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### ãªãœ snake_case ã«çµ±ä¸€ã™ã‚‹ã®ã‹

1. **å˜ä¸€ã‚½ãƒ¼ã‚¹ã®åŸå‰‡**: Supabase ç”Ÿæˆå‹ï¼ˆPostgreSQLï¼‰ã‚’å”¯ä¸€ã®å‹å®šç¾©ã‚½ãƒ¼ã‚¹ã¨ã™ã‚‹
2. **å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯æ’é™¤**: camelCase â†” snake_case ã®å¤‰æ›ãŒä¸è¦ã«ãªã‚Šãƒã‚°ã‚’å‰Šæ¸›
3. **ä¸€è²«æ€§**: DB â†’ API â†’ UI ã®å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§åŒä¸€ã®å‘½åè¦å‰‡

### é©ç”¨ç¯„å›²

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ä¾‹ | å‚™è€ƒ |
|---------|-----|------|
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | `session_id`, `started_at`, `customer_info` | PostgreSQL æ¨™æº– |
| **Edge Functions** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ã¦ snake_case | `{ session_id, chunk_index }` |
| **API å‹å®šç¾©** | `interface CreateSessionRequest { stylist_id: string }` | |
| **UI çŠ¶æ…‹** | `session.started_at`, `report.overall_score` | å†…éƒ¨ state ã‚‚ snake_case |
| **è¨­è¨ˆæ›¸** | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¯ snake_case ã§è¨˜è¼‰ | |

### âŒ ç¦æ­¢ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ camelCase ã¯ä½¿ç”¨ã—ãªã„
interface Session {
  sessionId: string;      // âŒ
  startedAt: string;      // âŒ
  customerInfo: object;   // âŒ
}

// âŒ å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã¯æ›¸ã‹ãªã„
const session = {
  id: response.session_id,        // âŒ ãƒãƒƒãƒ”ãƒ³ã‚°ä¸è¦
  startedAt: response.started_at, // âŒ
};
```

### âœ… æ­£ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âœ… snake_case ã‚’ãã®ã¾ã¾ä½¿ç”¨
interface Session {
  session_id: string;
  started_at: string;
  customer_info: object;
}

// âœ… API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãã®ã¾ã¾ä½¿ç”¨
const session = response; // ãƒãƒƒãƒ”ãƒ³ã‚°ä¸è¦

// âœ… JSX ã§ã‚‚ snake_case
<Text>{session.started_at}</Text>
<Text>{report.overall_score}</Text>
```

### ä¾‹å¤–

| é …ç›® | è¦å‰‡ | ç†ç”± |
|------|------|------|
| **ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°** | camelCase å¯ | `const sessionId = params.id` |
| **é–¢æ•°å** | camelCase | JavaScript æ¨™æº– `createSession()` |
| **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå** | PascalCase | React æ¨™æº– `<SessionCard />` |
| **å®šæ•°** | UPPER_SNAKE_CASE | `const MAX_DURATION = 60` |

### Supabase ç”Ÿæˆå‹ã®ä½¿ç”¨æ–¹æ³•

```typescript
// âœ… æ¨å¥¨: Supabase ç”Ÿæˆå‹ã‚’ç›´æ¥ä½¿ç”¨
import type { Database } from '@/types/database';

type Session = Database['public']['Tables']['sessions']['Row'];
type Staff = Database['public']['Tables']['staffs']['Row'];

// âŒ éæ¨å¥¨: æ¦‚å¿µãƒ¢ãƒ‡ãƒ«ï¼ˆpackages/shared/domain/entitiesï¼‰ã¯å®Ÿè£…ã§ä½¿ç”¨ã—ãªã„
import { Session } from '@salontalk/shared'; // â† ä½¿ç”¨ç¦æ­¢
```

---

## ğŸ”´ å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«ï¼ˆé‡è¦ï¼‰

> **âš ï¸ å¤‰æ›´ã‚’è¡Œã†éš›ã¯ã€å¿…ãšä»¥ä¸‹ã®å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä¸€è²«æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„**

### å¯¾è±¡ãƒ¬ã‚¤ãƒ¤ãƒ¼

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|----------|------|
| **è¨­è¨ˆæ›¸** | `docs/è¦ä»¶å®šç¾©æ›¸/`, `docs/è©³ç´°è¨­è¨ˆæ›¸/` | ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã€ç‰©ç†è¨­è¨ˆ |
| **DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** | `supabase/migrations/` | ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã€åˆ¶ç´„ |
| **å‹å®šç¾©ï¼ˆapps/webï¼‰** | `apps/web/src/types/database.ts` | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹ |
| **å‹å®šç¾©ï¼ˆsharedï¼‰** | `packages/shared/src/infrastructure/supabase/types.ts` | å…±æœ‰å‹ |
| **Edge Functions** | `supabase/functions/` | ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ |
| **UI** | `apps/web/src/`, `apps/mobile/src/` | ç”»é¢å®Ÿè£… |

### çµ±ä¸€ãƒ«ãƒ¼ãƒ«

#### 1. æ™‚é–“ã‚«ãƒ©ãƒ ã®å‘½å

```
âœ… æ­£ã—ã„: start_time_ms, end_time_ms (INTEGER, ãƒŸãƒªç§’)
âŒ é–“é•ã„: start_time, end_time (ç§’å˜ä½ã€NUMERIC)
```

- å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§ `_ms` ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨
- å‹ã¯ `INTEGER`ï¼ˆãƒŸãƒªç§’å˜ä½ï¼‰
- å¯¾è±¡: `transcripts`, `speaker_segments`, `session_reports.proposal_timing_ms`

#### 2. speaker_segments.speaker ã®å€¤

```
âœ… æ­£ã—ã„: 'stylist' | 'customer' | 'unknown'
âŒ é–“é•ã„: 'stylist' | 'customer' ã®ã¿
```

- `unknown` ã¯è©±è€…è­˜åˆ¥ä¸å¯æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### 3. training_scenarios ã®ã‚«ãƒ©ãƒ å

```
âœ… æ­£ã—ã„: title, difficulty
âŒ é–“é•ã„: name, level
```

#### 4. roleplay_sessions ã®ã‚«ãƒ©ãƒ å

```
âœ… æ­£ã—ã„: messages, ended_at
âŒ é–“é•ã„: conversation_history, completed_at
```

#### 5. staffs ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

```
âœ… æ­£ã—ã„:
  - id = auth.users(id) ãƒ‘ã‚¿ãƒ¼ãƒ³
  - role: 'stylist' | 'manager' | 'owner' | 'admin'

âŒ é–“é•ã„:
  - åˆ¥é€” auth_user_id ã‚’æŒã¤
  - role ã« 'assistant' ã‚’å«ã‚€
```

#### 6. ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«

```
âœ… æ­£ã—ã„: session_reports ã®ã¿
âŒ é–“é•ã„: reports ãƒ†ãƒ¼ãƒ–ãƒ«ãŒåˆ¥é€”å­˜åœ¨
```

#### 7. åˆ†æãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

```
âœ… æ­£ã—ã„: session_analysesï¼ˆæ­£è¦åŒ–æ§‹é€ ï¼‰
  - indicator_type: 'talk_ratio' | 'question_analysis' | ... | 'conversion'
  - value: number
  - score: number (0-100)
  - details: JSONB

âŒ é–“é•ã„:
  - analysis_results ãƒ†ãƒ¼ãƒ–ãƒ«
  - éæ­£è¦åŒ–ï¼ˆtalk_ratio_score, question_score... ã‚’åˆ¥ã‚«ãƒ©ãƒ ã«æŒã¤ï¼‰
```

### å¤‰æ›´æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```
â–¡ è¨­è¨ˆæ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ.mdï¼‰ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
â–¡ è¨­è¨ˆæ›¸ï¼ˆè©³ç´°è¨­è¨ˆæ›¸/07-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ.mdï¼‰ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
â–¡ DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆsupabase/migrations/ï¼‰ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
â–¡ apps/web/src/types/database.ts ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
â–¡ packages/shared/.../types.ts ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
â–¡ Edge Functions ã§è©²å½“ã‚«ãƒ©ãƒ ã‚’å‚ç…§ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
â–¡ UIã§è©²å½“ã‚«ãƒ©ãƒ ã‚’å‚ç…§ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’æ›´æ–°ã—ãŸã‹ï¼Ÿ
```

### ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ï¼š

```typescript
/**
 * ä¸€è²«æ€§ãƒ«ãƒ¼ãƒ«:
 * - æ™‚é–“ã‚«ãƒ©ãƒ : start_time_ms / end_time_ms (INTEGER, ãƒŸãƒªç§’)
 * - speakerå€¤: 'stylist' | 'customer' | 'unknown'
 * - training: title / difficulty (NOT name / level)
 * - roleplay: messages / ended_at (NOT conversation_history / completed_at)
 * - ãƒ¬ãƒãƒ¼ãƒˆ: session_reports ã®ã¿ (reports ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å­˜åœ¨ã—ãªã„)
 * - åˆ†æ: session_analyses (æ­£è¦åŒ–æ§‹é€ : indicator_type, value, score, details)
 */
```

### ä¸€è²«æ€§é•åãŒèµ·ãã‚„ã™ã„ã‚·ãƒŠãƒªã‚ª

1. **æ–°ã—ã„ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ã¨ã** â†’ å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§è¿½åŠ 
2. **ã‚«ãƒ©ãƒ åã‚’å¤‰æ›´ã™ã‚‹ã¨ã** â†’ å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å¤‰æ›´
3. **å‹å®šç¾©ã‚’è‡ªå‹•ç”Ÿæˆã—ãŸã¨ã** â†’ æ‰‹å‹•ã§ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚åŒæœŸ
4. **è¨­è¨ˆæ›¸ã‚’æ›´æ–°ã—ãŸã¨ã** â†’ å®Ÿè£…ã‚‚åŒæ™‚ã«æ›´æ–°

---

**Â© 2025 Revol Corporation. All Rights Reserved.**
